nhn.qrcode_layer=$Class({bOpenQrLayerId:null,bExpandContent:!1,$init:function(t){this._htOption=t,this._sBaseUrl=this._htOption.sBaseUrl,this._nSvcCode=this._htOption.nSvcCode,this._sQrCodeUrl=this._htOption.sQrCodeUrl,this._elContent=this._htOption.elContent,this._fQrLayer=this._htOption.fQrLayer,this._sNoImageUrl=this._htOption.noImageUrl,this._hTimeout=null},_show:function(t,e){if(this._sId=t,this._sUrl=e,this._elImageDiv=$$.getSingle("._qrCode_thumb",$(this._sId)),this._welImage=$Element($$.getSingle("._img",this._elImageDiv)),this.bOpenQrLayerId){if(this._sId===this.bOpenQrLayerId)return void this._hide();this._hide()}this._showLayer(this._sId),this._searchQrCode(),this._attachEvent()},_showLayer:function(t){$Element(t).css("display","inline")},_searchQrCode:function(){this._bResponse=null;var t=this._sBaseUrl,e=encodeURI(this._sUrl);new $Ajax(t,{type:"jsonp",method:"get",onload:$Fn(this._callBackRequest,this).bind()}).request({svcCode:this._nSvcCode,url:e});null!==this._hTimeout&&(clearTimeout(this._hTimeout),this._hTimeout=null),this._hTimeout=setTimeout($Fn(function(){null===this._bResponse&&(this._callBackResponse(),this._bResponse=null)},this).bind(),400)},_callBackResponse:function(){this._resizeContent(this._sId),this.bOpenQrLayerId=this._sId},_callBackRequest:function(t){this._bResponse=t;var e=t.json(),s=e.result,i=(e.code,"%22"+encodeURI(s.url)+"%22"),n=this._getParam(this._sQrCodeUrl,i);this._oTmpImg=new Image,this._oTmpImg.src=n,this._oTmpImg.onerror=$Fn(this._imgError,this).bind(),this._oTmpImg.onload=$Fn(this._onload,this).bind(),this._oTmpImg.complete&&this._welImage.attr("src",this._oTmpImg.src),this._callBackResponse()},_imgError:function(){this._callBackResponse()},_onload:function(){this._welImage.attr("src",this._oTmpImg.src)},_hide:function(){$Element(this.bOpenQrLayerId).css("display","none"),this._welImage.attr("src",this._sNoImageUrl),this.bExpandContent&&(this._elContent.css("height",""),bExpandContent=!1),this.bOpenQrLayerId=null},_attachEvent:function(){$Fn(function(t){var e=t.element,s=$Element(this._sId).parent();!$Element(e).isChildOf(s)&&this.bOpenQrLayerId&&this._hide()},this).attach(document,"click")},_getParam:function(t,e){var s=[];return s.push(t),s.push("src="+e),s.push("&size=Q"),s.push("&cmd=4"),s.push("&res_format=png"),s.push("&ver=20"),s.push("&only=y"),s.push("&refresh=1"),s.join("")},_resizeContent:function(t){var e=this._elContent,s=document.body.scrollHeight,i=$Element("footer").height(),n=s-i-e.offset().top,h=$Element(t).height()+$Element(t).offset().top-e.offset().top,o=h+10;h>n&&(e.css("height",o+"px"),window.scrollTo(0,document.body.scrollHeight),this.bExpandContent=!0)}});