var P_ID = "NHN"; var BP_ID = ""; var SelMode = 0; var ImgPath = "http://movie-img.yes24.com/NHN/"; var PosterPath = "http://movie-img.yes24.com/Resize/NYes24/MOVIE/"; var TLogoPath = "http://movie-img.yes24.com/NYes24/THEATER/"; var curStep = 0; var theaterSearchHintListCnt = 0; var objMovieData = null; var objMovie = null; var objSelMovie = null; var preSelMovie; var MListMode; var MovieList = ""; var sel_nhn_poster = ""; var sel_nhn_point = ""; var sel_nhn_point_type = ""; var sel_price_txt = ""; var sel_m_poster = ""; var sel_m_point_ave = ""; var sel_m_point_ave_width = ""; var objTheaterData = null; var objMyTheaterData = null; var objTheater; var objSelTheater; var ReserveTList = ""; var preSelTheater; var SelTheaterImg = ""; var SelTheaterEnterTime = ""; var t_logo_url = ""; var objAddMyTheater = ""; var objDelMyTheater = ""; var TListMode; var TListModeType = "0"; var RecentTheaterList = new Array(); var TheaterList = new Array(); var TheaterCnt = new Array(); var select_area = ""; var select_t_area = ""; var select_area_all = "N"; var areaMode = 1; var area_flag = "area"; var dt = new Date(); var curYear = dt.getFullYear(); var curMonth = dt.getMonth() + 1; var curDate = dt.getDate(); var todayDate = curYear + "-" + ((curMonth < 10) ? ("0" + curMonth) : curMonth) + "-" + (((curDate) < 10) ? ("0" + (curDate)) : (curDate)); var select_playDate = ""; var playDateObj = null; var playTimeObj = null; var objPrice = null; var sel_playTimeInfoObj = null; var str_play_time = ""; var str_play_end_time = ""; var tt_playDateObj = null; var tt_playtimeObj = null; var sel_tt_playTimeInfoObj = null; var tt_NT_ID = ""; var fee_amt = 500; var seat_yn = false; var max_cnt = 0; var tot_cnt = 0; var tot_price = 0; var result_str_price = ""; var result_total_price = ""; var dis_price = 0; var pay_price = 0; var adu_quan = 0; var adu_price = 0; var stu_quan = 0; var stu_price = 0; var etc_quan = 0; var etc_price = 0; var pt_price_id_str = ""; var seat_info = ""; var seat_grd = ""; var price_cd_info = ""; var t_price_info = ""; var price_cnt = ""; var selPrice_ = ""; var playtime_ = ""; var FlagInit = "0"; var MParamSet = "N"; var TParamSet = "N"; var PParamSet = "N"; var PTParamSet = "N"; var NBParamSet = "N"; var setTimeCnt = 0; var scrboxMovie = null; var scrboxTheater = null; var scrboxSchedule = null; var rolloverMovie; var oScrollBarMovie; var oScrollBarTheater; var oScrollBarSchedule; var obj_t_menu = null; var area0_t_cnt = 0; var area1_t_cnt = 0; var area2_t_cnt = 0; var area3_t_cnt = 0; var area4_t_cnt = 0; var area5_t_cnt = 0; var area6_t_cnt = 0; var re_tk_kind = ""; var clip = null; $(document).ready(function () { select_area = area_code; select_t_area = select_area; var m_id = request.getParameter("m_id"); var t_id = request.getParameter("t_id"); var playdate = request.getParameter("playdate"); var ts_id = request.getParameter("ts_id"); var playtime = request.getParameter("playtime"); var cnt = request.getParameter("cnt"); var nt_id = request.getParameter("nt_id"); m_tab = request.getParameter("m_tab"); t_tab = request.getParameter("t_tab"); re_tk_kind = request.getParameter("tk_kind"); if (m_tab == "") { m_tab = 0 } if (t_tab == "") { t_tab = 0 } if (m_id != "" || t_id != "" || playdate != "" || playtime != "" || cnt != "" || t_tab != "") { if (m_id != "") { MParamSet = "Y" } if (t_id != "") { TParamSet = "Y" } if (playdate != "") { PParamSet = "Y" } if (playtime != "") { PTParamSet = "Y" } if (m_id != "" && t_id != "" && playdate != "" && playtime != "" && cnt != "") { NBParamSet = "Y" } InitParamSet(m_id, t_id, playdate, ts_id, playtime, cnt, m_tab, t_tab, nt_id) } else { m_id = $("#M_ID").val(); t_id = $("#T_ID").val(); playdate = $("#PLAY_DT").val(); ts_id = $("#TS_ID").val(); playtime = $("#PLAYTIME").val(); cnt = $("#CNT").val(); nt_id = $("#NT_ID").val(); m_tab = $("#M_TAB").val(); t_tab = $("#T_TAB").val(); if (m_tab == "") { m_tab = 0 } if (t_tab == "") { t_tab = 0 } if (m_id != "" || t_id != "" || playdate != "" || playtime != "" || cnt != "" || t_tab != "") { if (m_id != "") { MParamSet = "Y" } if (t_id != "") { TParamSet = "Y" } if (playdate != "") { PParamSet = "Y" } if (playtime != "") { PTParamSet = "Y" } if (m_id != "" && t_id != "" && playdate != "" && playtime != "" && cnt != "") { NBParamSet = "Y" } InitParamSet(m_id, t_id, playdate, ts_id, playtime, cnt, m_tab, t_tab, nt_id) } else { Init() } } Inputinit(); var elOpenEvent_dimg = document.getElementById("ly_notice_mega_dimg"); var elOpenEvent = document.getElementById("ly_notice_evt"); var btype = request.getParameter("btype"); var cookie = $Cookie(); if (cookie.get("ly_notice_evt" + cookie_sub) == "n") { elOpenEvent_dimg.style.display = "none"; elOpenEvent.style.display = "none" } else { if (cookie_sub >= "20140530" && cookie_sub < "20140614") { elOpenEvent_dimg.style.display = ""; elOpenEvent.style.display = "" } } }); function Init() { inputReset(); sHtmlinit(); GetSelectInit(); GetTimeInit(); GetPriceInit(); if (IsLogin == "True") { GetMyTheaterData2() } MListMode = "0"; objMovieData = objMovieData1; MakeMovieList(objMovieData1); TListMode = "0"; objTheaterData = objTheaterData1; TheaterDataList(); GetAreaTheaterCnt(); if (select_area != "") { SelArea(select_area, "", "1") } playDateObj = playDateObj1; $("#calendar").html(DrawCalendar(curYear, curMonth, playDateObj, "0")); SetPayUseChkCookie() } function InitParamSet(m_id, t_id, playdate, ts_id, playtime, cnt, m_tab, t_tab, nt_id) { var tmp_select_area = ""; if (nt_id != "") { $("#NT_ID").val(nt_id); $("#FILTER_NT_ID").val(nt_id) } if (m_id != "") { $("#M_ID").val(m_id) } if (t_id != "") { $("#T_ID").val(t_id); tmp_select_area = request.getParameter("select_area"); select_area = tmp_select_area; select_t_area = select_area; if (tmp_select_area == "all") { select_area_all = "Y" } } if (playdate != "") { $("#PLAY_DT").val(playdate) } if (playtime != "") { $("#TS_ID").val(ts_id); $("#PLAYTIME").val(playtime); str_play_time = playtime } sHtmlinit(); GetSelectInit(); GetTimeInit(); GetPriceInit(); MListMode = m_tab; $("#m_tab_menu a").attr("class", ""); $("#m_tab_menu li:eq(" + MListMode + ") a").attr("class", "on"); TListMode = t_tab; if (rMovieChk == "Y") { objMovie = objMovie1 } objMovieData = objMovieData1; MakeMovieList(objMovieData); objTheater = objTheater1; if (objTheater != null) { GetReserveTList() } objTheaterData = objTheaterData1; if (t_id != "") { TheaterDataList() } GetAreaTheaterCnt(); if (tmp_select_area != "") { SelArea(tmp_select_area, "", "1") } playDateObj = playDateObj1; $("#calendar").html(DrawCalendar(curYear, curMonth, playDateObj, "0")); if (IsLogin == "True") { if (TListMode == "3") { FlagInit = "0"; GetMyTheaterData() } else { if (IsLogin == "True") { GetMyTheaterData2() } if (TListMode == 2) { $("#FILTER_NT_ID").val(nt_id) } TabTheaterMode("0", TListMode) } } else { if (IsLogin == "True") { GetMyTheaterData2() } if (t_tab == 3) { TListMode = 0 } else { if (TListMode == 2) { $("#FILTER_NT_ID").val(nt_id) } } TabTheaterMode("0", TListMode) } if (t_id != "") { SetTheaterList(t_id) } if (playdate != "") { SelPlayDate($("#PLAY_DT").val(), "0", "1") } if (cnt != "") { selParamPrice(cnt) } SetPayUseChkCookie() } var setTimePayUseChkCnt = 0; function SetPayUseChkCookie() { if (payUseChk == "N") { var btype = request.getParameter("btype"); if (btype != "re") { } } if (browserType == "BROWSER_TYPE_IPAD_OVER_iOS_4_2" || browserType == "BROWSER_TYPE_ANDROID_WEBKIT_PAD") { if (setTimePayUseChkCnt > 0 && $("#select_m_nm").html() != "" && $("#mlist li").length > 0 && $("#calendar tbody td").length > 0 && $("#price_lst li").length > 0) { if (confirm("PC버전에서는 예매 결제가 어렵습니다.\r\n모바일버전 네이버 영화에서 예매를 진행해보세요.")) { if ($("#M_ID").val() != "" && $("#T_ID").val() != "" && $("#PLAY_DT").val() != "" && $("#TS_ID").val() != "" && $("#PLAYTIME").val() != "") { if (ServiceFlag == "1") { location.href = "http://m.ticket.movie.naver.com/Ticket/selectPrice.aspx?step=1&mid=" + $("#M_ID").val() + "&tid=" + $("#T_ID").val() + "&playdate=" + $("#PLAY_DT").val() + "&tsid=" + $("#TS_ID").val() + "&playtime=" + $("#PLAYTIME").val() + "&bookingType=t" } else { location.href = "http://m.dev.ticket.movie.naver.com/Ticket/selectPrice.aspx?step=1&mid=" + $("#M_ID").val() + "&tid=" + $("#T_ID").val() + "&playdate=" + $("#PLAY_DT").val() + "&tsid=" + $("#TS_ID").val() + "&playtime=" + $("#PLAYTIME").val() + "&bookingType=t" } } else if ($("#M_ID").val() != "") { if (ServiceFlag == "1") { location.href = "http://m.movie.naver.com/m/endpage/MovieConvertor.nhn?cpType=2&cpMovieCode=" + $("#M_ID").val() } else { location.href = "http://m.alpha.movie.naver.com/m/endpage/MovieConvertor.nhn?cpType=2&cpMovieCode=" + $("#M_ID").val() } } else { if (ServiceFlag == "1") { location.href = "http://m.movie.naver.com/m/category/theater/AroundGroup.nhn" } else { location.href = "http://m.alpha.movie.naver.com/m/category/theater/AroundGroup.nhn" } } } } else { setTimePayUseChkCnt = parseInt(setTimePayUseChkCnt) + 1; setTimeout("SetPayUseChkCookie()", 1000); return } } else if (navigator.userAgent.indexOf("Mac__") != -1) { if (setTimePayUseChkCnt > 0 && $("#select_m_nm").html() != "" && $("#mlist li").length > 0 && $("#calendar tbody td").length > 0 && $("#price_lst li").length > 0) { alert("MAC OS에서는 휴대폰 결제만 가능합니다.\r\n다른 결제수단 사용하시려면 Windows OS를 이용부탁드립니다.") } else { setTimePayUseChkCnt = parseInt(setTimePayUseChkCnt) + 1; setTimeout("SetPayUseChkCookie()", 1000); return } } else { if (1 == 0 && navigator.userAgent.indexOf("MSIE") == -1 && navigator.userAgent.indexOf("Trident") == -1) { if (setTimePayUseChkCnt > 0 && $("#select_m_nm").html() != "" && $("#mlist li").length > 0 && $("#calendar tbody td").length > 0 && $("#price_lst li").length > 0) { alert("신용카드,계좌이체 결제는 IE에서만 가능합니다. IE브라우저를 이용 부탁드립니다.") } else { setTimePayUseChkCnt = parseInt(setTimePayUseChkCnt) + 1; setTimeout("SetPayUseChkCookie()", 1000); return } } } } var setTimeCnt2 = 0; function SetTheaterList(t_id) { if (objMyTheaterData != null && $("#area_tlist li").length > 0 || setTimeCnt2 > 3) { setTimeCnt2 = 0; SearchSelTheaterYN = "Y"; SelTheaterList(t_id, "1") } else { setTimeCnt2 = parseInt(setTimeCnt2) + 1; setTimeout("SetTheaterList('" + t_id + "')", 1000); return } } function inputReset() { $("#Cmd").val(""); $("#PT_ID").val(""); $("#PLAY_CL").val(""); $("#PAY_PRICE").val("0"); $("#O_ID").val(""); $("#M_ID").val(""); $("#M_NM").val(""); $("#M_GRADE").val(""); $("#M_POINT").val(""); $("#GRPM_ID").val(""); $("#NT_ID").val(""); $("#FILTER_NT_ID").val(""); $("#T_ID").val(""); $("#T_NM").val(""); $("#TS_ID").val(""); $("#TS_NM").val(""); $("#PLAY_DT").val(""); $("#PLAYTIME").val(""); $("#SEAT_STR").val(""); $("#TICKET_CNT").val(""); $("#CNT").val(""); $("#FEE_SUM").val("0") } function sHtmlinit() { $("#btn_initReserve").html("<a title=\"예매 다시하기\" class=\"reset\"><span class=\"blind\">예매 다시하기</span></a>"); $("#btn_copyurl").html("<a title=\"주소복사\" class=\"copy\"><div id=\"d_clip_button\" width=\"60\" height=\"23\"><span class=\"blind\">주소복사</span></div></a>"); SelectAreaInit(); $("#select_area_nm").html("<a href=\"javascript:moreArea();\">전체</a>"); $("#btn_Reserve1").css("visibility", "hidden"); $("#checkout_using").css("display", "none"); $("#btn_area").css("display", "block"); $("#section_select").css("display", "block"); $("#section_select2").css("display", "block"); $("#btn_area2").css("display", "none"); $("#select_place_txt").html("-"); $("#select_date_txt").html("-"); $("#select_price_txt").html("-"); $("#select_seat_txt").html("-"); $("#select_totalprice_txt").html("<strong>0</strong>"); if (re_tk_kind != null && re_tk_kind != "") { if (re_tk_kind == "1") { $("#tk_using").css("display", "block") } } chk_seat_yn = ""; HideTheaterAC() } function InitOnResultBtn() { $("#btn_initReserve").html("<a href=\"javascript:InitReserve();\" onclick=\"nclk(this, 'rst.reset', '', 1);\" title=\"예매 다시하기\" class=\"reset\"><span class=\"blind\">예매 다시하기</span></a>"); $("#btn_copyurl").html("<a href=\"javascript:openCopyUrl();\" onclick=\"nclk(this, 'rst.copy', '', 1);\" title=\"주소복사\" class=\"copy\"><div id=\"d_clip_button\" width=\"60\" height=\"23\"><span class=\"blind\">주소복사</span></div></a>"); $("#btn_reserve").attr("class", "btn_reserve b_on"); if (browserType != "BROWSER_TYPE_IPAD_OVER_iOS_4_2" && browserType != "BROWSER_TYPE_ANDROID_WEBKIT_PAD") { if (clip == null) { $("#d_clip_button").css("width", "60px"); $("#d_clip_button").css("height", "23px"); clip = new ZeroClipboard.Client(); clip.setHandCursor(true); clip.addEventListener("mouseOver", my_mouse_over); clip.addEventListener("mouseout", my_mouse_out); clip.addEventListener("mouseup", openCopyUrl); clip.glue("d_clip_button") } } } function Inputinit() { if (jQuery.browser.mozilla == true) { function pressed(e) { TxtTheaterKeyUp2(e) } window.captureEvents(Event.KEYDOWN); window.onkeydown = pressed; $("#txtTheater").click(function () { searchTheatertime() }) } else { $("#txtTheater").keyup(function (event) { TxtTheaterKeyUp(event) }) } } var chk_autoSearchTheater = "0"; var chantime_p = null; var txtTheater_db = ""; function searchTheatertime() { chk_autoSearchTheater = "0"; txtTheater_db = ""; timebar_p() } function TxtTheaterKeyUp2(e) { chk_autoSearchTheater = "0"; if (e.keyCode == 27) { chk_autoSearchTheater = "1"; $("#PRE_T_ID").val(""); HideTheaterAC(); return } if ($.trim($("#txtTheater").attr("value")) != "") { if (e.keyCode == 40) { chk_autoSearchTheater = "1"; SearchACUpDownTheater(true); return } if (e.keyCode == 38) { chk_autoSearchTheater = "1"; SearchACUpDownTheater(false); return } if (e.keyCode == 13) { chk_autoSearchTheater = "1"; SearchTheaterList(); SearchSelTheaterList($("#PRE_T_ID").attr("value")); return } } else { $("#PRE_T_ID").val(""); $("#TheaterSearchHintList").css("display", "none") } } function timebar_p() { if (txtTheater_db != $("#txtTheater").val()) { if (chk_autoSearchTheater == "0") { $("#PRE_T_ID").val(""); SearchTheater($.trim($("#txtTheater").attr("value"))); txtTheater_db = $("#txtTheater").val() } } else { txtTheater_db = "" } chantime_p = setTimeout("timebar_p()", 100) } function cleartime() { chk_autoSearchTheater = "0"; if (chantime_p != null) { clearTimeout(chantime_p) } chantime_p = null } function GetSelectInit() { $("#select_m_thumb").html("<span class=\"thumb_tail\"></span>"); $("#select_m_nm").html("영화를 선택하세요."); SetMovieGrade("none", "", ""); $("#select_playdate_txt").html("<strong>관람날짜를 선택하세요</strong>") } function GetTimeInit() { var rtn = ""; var sh_t_info = ""; sh_t_info += "<ul style=\"display:none\">"; if (IsPersonalAgree == "1") { sh_t_info += "<li><a href=\"#\">MY극장 삭제</a></li>" } sh_t_info += "<li><a href=\"#\">극장시간표</a></li>"; sh_t_info += "<li><a href=\"#\">극장정보</a></li>"; sh_t_info += "</ul>"; $("#sh_t_logo").html(""); $("#sh_t_nm").html("<strong>극장명</strong>"); $("#sh_t_info").html(sh_t_info); rtn += "<div class=\"time \">"; rtn += "<dl class=\"num_time\">"; rtn += "<dt>- 관</dt>"; rtn += "<dd>"; rtn += "<ul class=\"lst_schedule\">"; for (var i = 0; i < 10; i++) { rtn += "<li class=\"dimmed\">00:00</li>" } rtn += "</ul>"; rtn += "</dd></dl></div>"; $("#timelist").html(rtn); if (scrboxSchedule == null) { scrboxSchedule = new jindo.ScrollBox("scrboxSchedule", { bAdjustThumbSize: true, sOverflowX: "auto", sOverflowY: "scroll" }); oScrollBarSchedule = new jindo.ScrollBar("scrboxSchedule", { htCustomEventHandler: { scroll: function (oCustomEvent) { } } }) } else { if (scrboxSchedule != null) { scrboxSchedule.setSize(568, 91); scrboxSchedule.setContentSize(568, Number.POSITIVE_INFINITY); scrboxSchedule.reset() } if (oScrollBarSchedule != null) { oScrollBarSchedule.reset() } } } function GetPriceInit() { var rtn = ""; if ($("#M_ID").val() == "" || $("#T_ID").val() == "" || $("#PLAY_DT").val() == "") { $("#select_people").attr("class", "default") } else if ($("#M_ID").val() != "" && $("#T_ID").val() != "" && $("#PLAY_DT").val() != "") { $("#select_people").attr("class", "p") } else { $("#select_people").attr("class", "default") } $("#price_lst_area").attr("class", "use"); rtn += "<dl class=\"ticket\">"; rtn += "<dt>성인<em>1매/0원</em></dt>"; rtn += "<dd><ul>"; for (var i = 0; i < 9; i++) { rtn += "<li class=\"dimmed\">" + i + "</li>" } rtn += "</ul></dd></dl>"; rtn += "<dl class=\"ticket\">"; rtn += "<dt>학생<em>1매/0원</em></dt>"; rtn += "<dd><ul>"; for (var j = 0; j < 9; j++) { rtn += "<li class=\"dimmed\">" + j + "</li>" } rtn += "</ul></dd></dl>"; $("#price_lst").html(rtn); $("#select_price_txt").html("-") } function SelectAreaInit() { $("#select_area").css("display", "none"); $("#select_area2").css("display", "none") } function SearchTheaterLiMouseOver(obj, value) { if ($(obj).attr("class") != "on") { $("#TheaterSearchHintList li").attr("class", ""); $(obj).attr("class", value) } } function LiMouseOver(obj, value) { if ($(obj).attr("class") == "") { $(obj).attr("class", "over") } else if ($(obj).attr("class") != "on") { $(obj).attr("class", value) } } function LiMouseOut(obj, value) { if ($(obj).attr("class") == "over") { $(obj).attr("class", "") } else if ($(obj).attr("class") != "on") { $(obj).attr("class", value) } } function TLiMouseOver(obj, value, idx) { if ($(obj).attr("class") == "") { $(obj).attr("class", "over") } else if ($(obj).attr("class") != "on") { $(obj).attr("class", value) } } function TLiMouseOut(obj, value, idx) { if ($(obj).attr("class") == "over") { $(obj).attr("class", "") } else if ($(obj).attr("class") != "on") { $(obj).attr("class", value) } } function TdMouseOver(obj) { if ($(obj).attr("class") != "selected") { if ($(obj).attr("class") == "ableDay") $(obj).addClass("ableDay_hover"); else if ($(obj).attr("class") == "ableDayAm") $(obj).addClass("ableDayAm_hover") } } function TdMouseOut(obj) { if ($(obj).attr("class") != "selected") { if ($(obj).attr("class") == "ableDay ableDay_hover") $(obj).removeClass("ableDay_hover"); else if ($(obj).attr("class") == "ableDayAm ableDayAm_hover") $(obj).removeClass("ableDayAm_hover") } } var obj_t_seat_tool = null; function TSeatMouseOver(obj, size_num, num, num_len, num_s, num_e, region_len) { if (obj_t_seat_tool != obj) { var pos = $(obj).offset(); var top = pos.top - 102; var left = parseInt(6 * parseInt(num)) + parseInt(num_len) - (parseInt(num_s) * 2) + parseInt(num_e); if (size_num == "5") { if (num_s != "0") { left = left - parseInt(num) + parseInt(num_len) - (parseInt(num_s) * 2) + 1 } else { left = left - parseInt(num) + parseInt(num_len) - 1 } } var m = !window.XMLHttpRequest; if (!!m) { top = parseInt(top) - 4 } $("#t_seat_tool").css("top", top + "px"); $("#t_seat_tool").css("left", left + "px") } $("#t_seat_tool").css("display", "block"); obj_t_seat_tool = obj } function TSeatMouseOut() { $("#t_seat_tool").css("display", "none") } var obj_t_menu_tool = null; function TMenuMouseOver(obj) { if (obj_t_menu_tool != obj) { var pos = $(obj).offset(); var top = pos.top - 102; var m = !window.XMLHttpRequest; if (!!m) { top = parseInt(top) - 4 } $("#t_menu_tool").css("top", top + "px") } $("#t_menu_tool").css("display", "block"); obj_t_menu_tool = obj } function TMenuMouseOut() { $("#t_menu_tool").css("display", "none") } var obj_EndTime = null; function EndTimeMouseOver(obj, val, num) { if (obj_EndTime != obj) { var pos = $(obj).offset(); var top = parseInt(pos.top) - 520; var left = 3 + parseInt(parseInt(num) * 43); var m = !window.XMLHttpRequest; if (!!m) { top = parseInt(top) - 4 } $("#EndTime").css("left", left + "px"); $("#EndTime").css("top", top + "px"); $("#endTime_txt").text(val) } $("#EndTime").css("display", "block"); obj_EndTime = obj } function EndTimeMouseOut(obj, val) { $("#EndTime").css("display", "none") } var obj_tt_EndTime = null; function TT_EndTimeMouseOver(obj, val, num) { if (obj_tt_EndTime != obj) { var pos = $(obj).offset(); var top = parseInt(pos.top) - 236; var left = 487 + parseInt(parseInt(num) * 43); var m = !window.XMLHttpRequest; if (!!m) { left = parseInt(left) + 3; top = parseInt(top) - 4 } $("#tt_EndTime").css("left", left + "px"); $("#tt_EndTime").css("top", top + "px"); $("#tt_endTime_txt").text(val) } $("#tt_EndTime").css("display", "block"); obj_tt_EndTime = obj } function TT_EndTimeMouseOut(obj, val) { $("#tt_EndTime").css("display", "none") } function InitReserve() { sel_nhn_poster = ""; sel_nhn_point_type = ""; inputReset(); BP_ID = request.getParameter("BP_ID"); if (BP_ID == "LGT") { CardCode = "신한카드(구.LG카드):CCLG" } sHtmlinit(); MListMode = 0; $("#m_tab_menu a").attr("class", ""); $("#m_tab_menu li:eq(" + MListMode + ") a").attr("class", "on"); objMovie = null; objSelMovie = null; MakeMovieList(objMovieData); TListModeType = "0"; TListMode = "0"; objTheater = null; ReserveTList = ""; objSelTheater = null; select_area = area_code; select_t_area = select_area; TheaterDataList(); GetAreaTheaterCnt(); if (select_area != "") { SelArea(select_area, "", "1") } $("#t_menu").css("display", "none"); if (obj_t_menu != null) { $(obj_t_menu).attr("class", "btn") } $("#ly_map").css("display", "none"); $("#t_chain").css("display", "none"); GetSelectInit(); GetPlayDate("", ""); $("#btn_Reserve1").css("visibility", "hidden"); $("#checkout_using").css("display", "none"); $("#section_info_result").attr("class", "default"); SetTimeView("0"); $("#section_select").css("display", "block"); $("#section_select2").css("display", "block"); $("#btn_area").css("display", "block"); $("#ly_map").css("display", "none"); $("#btn_area2").css("display", "none"); $("#btn_Reserve1").css("visibility", "visible") } function selParamPlayTime(t_id) { var pt_id = ""; if (playTimeObj != null) { for (var ii = 0; ii < playTimeObj.length; ii++) { if (playTimeObj[ii][1] == $("#M_ID").val() && playTimeObj[ii][4] == t_id && playTimeObj[ii][9] == $("#PLAY_DT").val() && playTimeObj[ii][7] == $("#TS_ID").val() && playTimeObj[ii][11] == $("#PLAYTIME").val()) { pt_id = playTimeObj[ii][0]; break } } if (pt_id != "") { SelTime(pt_id) } else { PTParamSet = "N"; $("#TS_ID").val(""); $("#PLAYTIME").val("") } } else { setTimeout("selParamPlayTime('" + t_id + "')", 1000); return } } function selParamPrice(cnt) { if (objPrice != null) { if (cnt.indexOf("|") == -1) { var tmpCntArray = cnt.split(":"); if (tmpCntArray[0] != null) { var obj = $("#price_type" + tmpCntArray[0] + " li:eq(" + tmpCntArray[1] + ")").attr("id"); if (obj != null && setTimeCnt != 1) { setTimeCnt = 0; SelPrice(tmpCntArray[0], tmpCntArray[1]) } else { setTimeout("selParamPrice('" + cnt + "')", 1000); setTimeCnt = 1; return } } } else { var tmpCntArray1 = cnt.split("|"); if (tmpCntArray1.length > 0) { for (var k = 0; k < tmpCntArray1.length; k++) { var tmpCntArray2 = tmpCntArray1[k].split(":"); var ob2j = $("#price_type" + tmpCntArray2[0] + " li:eq(" + tmpCntArray2[1] + ")").attr("id"); if (ob2j != null && setTimeCnt != 1) { setTimeCnt = 0; SelPrice(tmpCntArray2[0], tmpCntArray2[1]) } else { setTimeout("selParamPrice('" + cnt + "')", 1000); setTimeCnt = 1; return } } } } } else { setTimeout("selParamPrice('" + cnt + "')", 1000); return } } function NextBtn() { if (IsLogin != "True") { gotoLoginChk("1"); return } if (IsPersonalAgree == 1 && isValidViewGrade() == false) { return } var notice_d = new Date(); var notice_hour = notice_d.getHours(); var notice_min = notice_d.getMinutes(); if ($("#NT_ID").val() == "MEGABOX") { if (notice_date == "20140306") { if (notice_hour >= 1 && notice_hour < 6) { alert("메가박스 극장 서비스 점검 중입니다.\r\n점검 시간 동안 예매/취소 불가능 합니다.\r\n\r\n시간 : 2014-03-06(목) 01시 ~ 06시 (5시간)\r\n다른 극장을 선택해주세요."); return } } } if ($("#NT_ID").val() == "LOTTEC") { var datestr = notice_date + (notice_hour < 10 ? "0" + notice_hour : notice_hour) + (notice_min < 10 ? "0" + notice_min : notice_min); if (parseInt(datestr) >= 201412082230 && parseInt(datestr) < 201412090630) { alert("롯데시네마 극장 서비스 점검 중입니다.\r\n점검 시간 동안 예매/취소 불가능 합니다.\r\n\r\n점검 시간 : 2014-12-08(월) 22:30 ~ 2014-12-09(화) 06:30 (8시간)\r\n취소 및 환불 문의 : m-time@yes24.com"); return } } var person1 = adu_quan + "|" + stu_quan + "|0|0|" + etc_quan; GetRestSeat_Ajax(person1, $("#PT_ID").val()) } function GetRestSeat_Ajax(person, pt_id) { $.ajax({ type: "POST", url: "/DataService/DataService.aspx", data: "PERSON=" + person + "&PT_ID=" + pt_id + "&FLAG=RESTSEAT", cache: false, success: GetRestSeatCallback, dataType: "text" }) } function GetRestSeatCallback(res) { var xmlDoc = null; if (window.DOMParser) { parser = new DOMParser(); xmlDoc = parser.parseFromString(res, "text/xml") } else { xmlDoc = new ActiveXObject("Microsoft.XMLDOM"); xmlDoc.async = "false"; xmlDoc.loadXML(res) } if (xmlDoc != null) { $(xmlDoc).find("RESTSEAT").each(function () { var arrTemp = $(this).find("INFO").text().split("|"); if (arrTemp[0] == "E0000") { if (TListMode == 1 && select_area_all == "Y") { select_area = "all" } var goReservePro = ""; if (re_tk_kind == "1" && TicketUseCancelYN == "0") { goReservePro = RootUrl_re + "/Ticket/ReservePro.aspx?m_id=" + $("#M_ID").val() + "&t_id=" + $("#T_ID").val() + "&playdate=" + $("#PLAY_DT").val() + "&playtime=" + $("#PLAYTIME").val() + "&ts_id=" + $("#TS_ID").val() + "&m_tab=" + MListMode + "&t_tab=" + TListMode + "&cnt=" + escape(selPrice_) + "&seat_info=" + escape(seat_info) + "&select_area=" + select_t_area + "&m_point=" + $("#M_POINT").val() + "&tk_kind=" + re_tk_kind } else { goReservePro = RootUrl_re + "/Ticket/ReservePro.aspx?m_id=" + $("#M_ID").val() + "&t_id=" + $("#T_ID").val() + "&playdate=" + $("#PLAY_DT").val() + "&playtime=" + $("#PLAYTIME").val() + "&ts_id=" + $("#TS_ID").val() + "&m_tab=" + MListMode + "&t_tab=" + TListMode + "&cnt=" + escape(selPrice_) + "&seat_info=" + escape(seat_info) + "&select_area=" + select_t_area + "&m_point=" + $("#M_POINT").val() } if (urlType == "pcweb") { location.href = goReservePro + "&pcweb" } else { location.href = goReservePro } } else { alert("잔여 좌석이 부족합니다.\r\n다른 시간대나 타극장을 선택해주시면 감사하겠습니다") } }) } } function isValidViewGrade() { var gradeAge = $("#M_GRADE").val(); if (gradeAge == "") { alert("관람등급을 확인할 수 없어 예매 불가능 합니다."); return false } else { if (parseInt(gradeAge) > 0 && (userAge == "" || userAge == "0" || userManAge == "" || userManAge == "0")) { alert("사용자 나이를 확인할 수 없어 예매 불가능 합니다."); return false } if (parseInt(gradeAge) >= 18 && parseInt(userAge) < 20) { alert("청소년 관람불가 영화이므로 예매할 수 없습니다."); return false } if (parseInt(gradeAge) > parseInt(userManAge)) { alert("만 " + gradeAge + "세 이상 관람 가능한 영화이므로 예매할 수 없습니다."); return false } } return true } function SetParam(param) { onGetParam = true; getParam = param } function TabMovieMode(mode) { $("#m_tab_menu a").attr("class", ""); $("#m_tab_menu li:eq(" + mode + ") a").attr("class", "on"); MListMode = mode; MakeMovieList(objMovieData); SelectAreaInit() } var SelMovie_css = ""; function SelMovieList(m_id, idx, mode, css_) { var obj = null; var tmp_chk = 0; str_play_time = ""; SelectAreaInit(); $("#t_menu").css("display", "none"); if (parseInt(idx) < 0) { for (var i = 0; i < $("#mlist li").length; i++) { if ($("#mlist li:eq(" + i + ")").attr("Id").substring(0, 10) == m_id) { obj = $("#mlist li:eq(" + i + ")"); break } } } else { obj = $("#mlist li:eq(" + idx + ")") } if (mode == "0" && MParamSet == "N" && $(obj).attr("class") == "on") { } else if (obj != null) { if ($("#T_ID").val() == "" && mode != "1" && MParamSet == "N" && TListModeType != "1") { TListMode = 1; $("#t_chain").css("display", "none") } SetM_ID(m_id); $("#M_NM").val($(obj).attr("title")); if (objSelMovie != null) { $(objSelMovie).attr("class", SelMovie_css); $(objSelMovie).css("cursor", "hand") } objSelMovie = obj; SelMovie_css = css_; var m_nm = $(obj).attr("title"); var m_info = $(obj).attr("Id").split("|"); $("#M_GRADE").val(m_info[3]); $("#GRPM_ID").val(m_info[4]); var m_poster = ""; var m_point_ave = m_info[2]; $("#M_POINT").val(m_info[2]); var m_point_ave_width = m_point_ave * 10; sel_m_point_ave = m_info[2]; sel_m_point_ave_width = m_point_ave * 10; if (rEventMovieList.indexOf($("#GRPM_ID").val()) != -1 || rEventMovieList.indexOf($("#M_ID").val()) != -1) { $("#evt_tx_ing_area").css("display", "block") } else { $("#evt_tx_ing_area").css("display", "none") } if (m_info[1] != "" && m_info[1] != "//") { m_poster = PosterPath + m_info[1] + "?W164,H235"; sel_m_poster = PosterPath + m_info[1] } else { m_poster = "http://movie-img.yes24.com/NHN/img/default_movie.png"; sel_m_poster = "" } GetNHNPoster(m_id); if (PTParamSet == "N") { $("#PLAYTIME").val("") } if (css_ == "end" || css_ == "e_over") { $("#T_ID").val(""); $("#T_NM").val(""); $("#NT_ID").val(""); $("#PLAY_DT").val(""); $("#select_place_txt").html("-"); $("#select_date_txt").html("-"); objMovie = null; $("#mlist li").attr("class", "") } if ($("#T_ID").val() == "" && $("#PLAY_DT").val() == "") { $("#mlist li").attr("class", ""); if ($("#rankline") != null) { $("#rankline").attr("class", "line") } } $(obj).attr("class", "on"); $(obj).css("cursor", ""); if (mode == "0") { SelMovie() } $("#select_price_txt").html("-"); $("#select_seat_txt").html("-"); if (chk_seat_yn == "0") { $("#select_seat_txt").html("해당 극장 자동 배정") } if ($("#PLAY_DT").val() == "") { $("#select_playdate_txt").html("<strong>관람날짜를 선택하세요</strong>") } $("#select_totalprice_txt").html("<strong>0</strong>"); $("#section_info_result").attr("class", ""); InitOnResultBtn(); SetTimeView("1"); HideTheaterAC(); if (MParamSet != "N") { var focusListId = $(obj).attr("Id"); if (oScrollBarMovie != null) { oScrollBarMovie.setScrollTop(document.getElementById(focusListId).offsetTop) } } } MParamSet = "N" } function ResetSelMovieList(type) { $("#select_m_thumb").html("<span class=\"thumb_tail\"></span>"); $("#select_m_nm").html("영화를 선택하세요."); SetMovieGrade("none", "", ""); $("#select_price_txt").html("-"); $("#select_seat_txt").html("-"); if (chk_seat_yn == "0") { $("#select_seat_txt").html("해당 극장 자동 배정") } $("#select_totalprice_txt").html("<strong>0</strong>"); $("#section_info_result").attr("class", ""); $("#M_ID").val(""); $("#M_NM").val(""); $("#M_GRADE").val(""); $("#M_POINT").val(""); $("#GRPM_ID").val(""); if ($("#T_ID").val() == "" && $("#PLAY_DT").val() == "") { objMovie = null; $("#section_info_result").attr("class", "default"); $("#btn_initReserve").html("<a title=\"예매 다시하기\" class=\"reset\"><span class=\"blind\">예매 다시하기</span></a>"); $("#btn_copyurl").html("<a title=\"주소복사\" class=\"copy\"><div id=\"d_clip_button\" width=\"60\" height=\"23\"><span class=\"blind\">주소복사</span></div></a>") } MakeMovieList(objMovieData); $("#evt_tx_ing_area").css("display", "none"); if ($("#M_ID").val() == "" && $("#PLAY_DT").val() == "" && TListModeType == "0") { TListMode = "0"; objTheater = null; ReserveTList = ""; SearchSelTheaterYN = "Y"; MakeTheaterList(objTheaterData) } else if ($("#T_ID").val() == "" && $("#PLAY_DT").val() == "" && TListModeType == "0") { TListMode = "0"; objTheater = null; ReserveTList = ""; MakeTheaterList(objTheaterData) } else { GetTheater($("#M_ID").val(), $("#PLAY_DT").val(), "") } GetPlayDate($("#M_ID").val(), $("#T_ID").val()); SetTimeView("0"); HideTheaterAC(); if (type == "0") { MovieListFocusTop() } } function MovieListFocusTop() { var fm_obj = null; fm_obj = $("#mlist li:eq(0)"); var focusListId = $(fm_obj).attr("Id"); if (oScrollBarMovie != null) { oScrollBarMovie.setScrollTop(document.getElementById(focusListId).offsetTop) } } function TheaterListFocusTop() { var fm_obj = null; if (TListMode == 1 || TListMode == 3) { fm_obj = $("#area_tlist ul:eq(0)") } else { fm_obj = $("#area_tlist dl:eq(0)") } var focusListId = null; if (fm_obj != null) { focusListId = $(fm_obj).attr("Id") } if (focusListId != null && focusListId != "") { if (oScrollBarTheater != null) { oScrollBarTheater.setScrollTop(document.getElementById(focusListId).offsetTop) } } } function ResetSelTheaterList(type) { TListModeType = "1"; SelTheaterEnterTime = ""; $("#area_tlist li").attr("class", ""); $("#T_ID").val(""); $("#NT_ID").val(""); $("#T_NM").val(""); $("#select_place_txt").html("-"); if ($("#M_ID").val() == "" && $("#PLAY_DT").val() == "") { $("#section_info_result").attr("class", "default"); $("#btn_initReserve").html("<a title=\"예매 다시하기\" class=\"reset\"><span class=\"blind\">예매 다시하기</span></a>"); $("#btn_copyurl").html("<a title=\"주소복사\" class=\"copy\"><div id=\"d_clip_button\" width=\"60\" height=\"23\"><span class=\"blind\">주소복사</span></div></a>") } GetMovieList($("#T_ID").val(), $("#PLAY_DT").val()); GetPlayDate($("#M_ID").val(), $("#T_ID").val()); if (TListMode == 3) { MakeTheaterList(objMyTheaterData) } else { MakeTheaterList(objTheaterData) } SetTimeView("1"); HideTheaterAC(); closeTheaterInfo(); if (type == "0") { TheaterListFocusTop() } } function GetNHNPoster(m_id) { $.ajax({ type: "POST", url: "/AsyncRequest/GetMovie.aspx", data: "CMD=NHN_POSTER&M_ID=" + m_id, cache: false, success: GetNHNPosterCallback, dataType: "text" }) } function GetNHNPosterCallback(res) { var nhn_m_info = ""; var tmpArray; if (res != "") { nhn_m_info = res } else { nhn_m_info = "" } sel_nhn_point_type = ""; sel_nhn_poster = ""; sel_nhn_point = ""; if (nhn_m_info != "") { tmpArray = nhn_m_info.split("|"); sel_nhn_poster = (tmpArray[3] && tmpArray[3] != "") ? tmpArray[0] : ""; sel_nhn_point_type = tmpArray[2]; if (tmpArray[1].substring(0, 2) == "10") { sel_nhn_point = tmpArray[1].substring(0, 4) } else { sel_nhn_point = tmpArray[1].substring(0, 3) } } if (sel_nhn_poster != "") { sel_m_poster = sel_nhn_poster } else { sel_m_poster = "http://movie-img.yes24.com/NHN/img/default_movie.png" } if (sel_nhn_point != "" && sel_nhn_point != "NaN") { sel_m_point_ave = sel_nhn_point; sel_m_point_ave_width = sel_nhn_point * 10 } else { sel_m_point_ave = "0.0"; sel_m_point_ave_width = 0 } var m_nm = $("#M_NM").val(); if (m_nm.length > 20) { m_nm = m_nm.cut(34) } if (sel_nhn_point_type == "" && sel_nhn_point == "" && sel_nhn_poster == "") { $("#select_m_thumb").html("<a onclick=\"javascript:;\" title=\"" + $("#M_NM").val() + "\"><img src=\"" + sel_m_poster + "?type=w164\" width=\"164\" alt=\"" + $("#M_NM").val() + "\"><span class=\"mask\"><em class=\"mask_tail\"></em></span></a><span class=\"thumb_tail\"></span>"); $("#select_m_nm").html("<a onclick=\"javascript:;\" title=\"" + $("#M_NM").val() + "\">" + m_nm + "</a>") } else if (sel_nhn_poster != "") { $("#select_m_thumb").html("<a href=\"http://movie.naver.com/movie/api/yes24/movieLink.nhn?M_CODE=" + $("#M_ID").val() + "\" onclick=\"nclk(this, 'rst.poster', '', 1);\" target=\"_blank\" title=\"" + $("#M_NM").val() + "\"><img src=\"" + sel_m_poster + "?type=w164\" width=\"164\" alt=\"" + $("#M_NM").val() + "\"><span class=\"mask\"><em class=\"mask_tail\"></em></span></a><span class=\"thumb_tail\"></span>"); $("#select_m_nm").html("<a href=\"http://movie.naver.com/movie/api/yes24/movieLink.nhn?M_CODE=" + $("#M_ID").val() + "\" onclick=\"nclk(this, 'rst.movie', '', 1);\" target=\"_blank\" title=\"" + $("#M_NM").val() + "\">" + m_nm + "</a>") } else { $("#select_m_thumb").html("<a onclick=\"nclk(this, 'rst.poster', '', 1);\" title=\"" + $("#M_NM").val() + "\"><img src=\"" + sel_m_poster + "?type=w164\" width=\"164\" alt=\"" + $("#M_NM").val() + "\"><span class=\"mask\"><em class=\"mask_tail\"></em></span></a><span class=\"thumb_tail\"></span>"); $("#select_m_nm").html("<a onclick=\"nclk(this, 'rst.movie', '', 1);\" title=\"" + $("#M_NM").val() + "\">" + m_nm + "</a>") } SetMovieGrade(sel_nhn_point_type, sel_m_point_ave_width, sel_m_point_ave) } function SelMovie() { GetPlayDate($("#M_ID").val(), $("#T_ID").val()); GetTheater($("#M_ID").val(), $("#PLAY_DT").val(), ""); if ($("#M_ID").val() != "" && $("#T_ID").val() != "" && $("#PLAY_DT").val() != "") { if (PTParamSet == "N") { GetPlayTime($("#M_ID").val(), $("#T_ID").val(), $("#PLAY_DT").val()) } } else if ($("#T_ID").val() != "") { if (TParamSet == "N") { setTheatertimelist($("#T_ID").val()) } } else { SetTimeView("0") } } function TabTheaterMode(type, mode) { TListMode = mode; TListModeType = type; SelectAreaInit(); $("#t_tab_menu a").attr("class", ""); $("#t_tab_menu li:eq(" + mode + ") a").attr("class", "on"); $("#select_area").css("top", "80px"); if (mode == 0) { $("#t_chain").css("display", "none"); $("#tab_location").css("display", "block"); $("#area_tlist").css("display", "block"); $("#t_area_tlist").attr("class", "location_area"); select_area_all = "N"; if (TParamSet == "N") { MakeTheaterList(objTheaterData) } GetAreaTheaterCnt(); SelArea(select_area, "", "1"); if ($("#T_ID").val() != "" && objSelTheater != null) { var focusListId = $(objSelTheater).attr("Id"); if (focusListId != null && focusListId != "") { var tmpArray = focusListId.split(":"); if (select_area == tmpArray[6]) { if (oScrollBarTheater != null) { oScrollBarTheater.setScrollTop(document.getElementById(focusListId).offsetTop) } } } } } else if (mode == 1) { $("#t_chain").css("display", "none"); $("#tab_location").css("display", "block"); $("#t_area_tlist").attr("class", "location_area"); $("#select_area2").css("top", "80px"); if ($("#M_ID").val() != "" || $("#PLAY_DT").val() != "") { if (TParamSet == "N") { GetTheater($("#M_ID").val(), $("#PLAY_DT").val(), "") } } else { $("#area_tlist").html(""); $("#scrboxTheater").css("display", "none"); $("#tab_location").css("display", "none"); $("#area_tlist").css("display", "none"); $("#t_area_tlist").css("display", "none"); $("#t_area_tlist3").css("display", "none"); $("#t_area_tlist2").css("display", "block"); GetAreaTheaterCnt() } SelArea(select_area, "", "1") } else if (mode == 2) { $("#tab_location").css("display", "block"); $("#select_area").css("top", "120px"); $("#t_chain").css("display", "block"); $("#area_tlist").css("display", "block"); $("#t_area_tlist").attr("class", "chain_area"); select_area_all = "N"; if ($("#NT_ID").val() == "LOTTEC" || $("#NT_ID").val() == "CINUS" || $("#NT_ID").val() == "MEGABOX" | $("#NT_ID").val() == "PRIMUS") { $("#FILTER_NT_ID").val($("#NT_ID").val()); SelMultiplex($("#FILTER_NT_ID").val()); if ($("#T_ID").val() != "" && objSelTheater != null) { var focusListId = $(objSelTheater).attr("Id"); var tmpArray2 = focusListId.split(":"); if (focusListId != null && focusListId != "" && select_area == tmpArray2[6]) { if (oScrollBarTheater != null) { oScrollBarTheater.setScrollTop(document.getElementById(focusListId).offsetTop) } } } } else { $("#FILTER_NT_ID").val("LOTTEC"); SelMultiplex("LOTTEC") } } else if (mode == 3) { $("#t_chain").css("display", "none"); $("#tab_location").css("display", "none"); $("#t_area_tlist").attr("class", "location_area2"); $("#area_tlist").html(""); FlagInit = "1"; select_area_all = "N"; if (IsLogin == "True") { GetMyTheaterData() } else { $("#scrboxTheater").css("display", "none"); $("#tab_location").css("display", "none"); $("#area_tlist").css("display", "none"); $("#t_area_tlist").css("display", "none"); $("#t_area_tlist2").css("display", "none"); $("#t_area_tlist3").css("display", "block"); $("#t_my_msg").html("<p class=\"login\"><strong><em><a href=\"javascript:gotoLoginChk('2')\">로그인</a></em> 해주세요.</strong><br>로그인 후 MY극장 정보를<br>보실 수 있습니다.</p>") } } HideTheaterAC(); closeTheaterInfo() } function SelMultiplex(nt_id) { var idx = 0; switch (nt_id) { case "LOTTEC": idx = 0; break; case "MEGABOX": idx = 1; break; case "PRIMUS": idx = 2; break; case "CGV": idx = 0; break } $("#t_chain li a").attr("class", ""); $("#t_chain li:eq(" + idx + ") a").attr("class", "on"); SetFILTER_NT_ID(nt_id); if (TParamSet == "N") { MakeTheaterList(objTheaterData) } GetAreaTheaterCnt(); SelArea(select_area, "", "1"); HideTheaterAC(); closeTheaterInfo() } function TabTheaterListClick(idx) { if ($("#tList0" + idx).css("display") == "none") { for (var i = 0; i < 6; i++) { $("#tList0" + (i + 1)).css("display", (idx == (i + 1) ? "block" : "none")); $("#tabArea0" + (i + 1)).css("cursor", (idx == (i + 1) ? "default" : "pointer")); $("#tabArea0" + (i + 1)).css("background", "url(http://movie-img.yes24.com/reserve/bg_Tab" + (idx == (i + 1) ? "Open" : "Fold") + ".gif) left top repeat-x") } } } var selTheaterArea = ""; function SelTheaterList(t_id, mode) { var idx; var Obj = null; var tmpArray; str_play_time = ""; SelMovie_css = ""; SelectAreaInit(); chk_seat_yn = ""; if (t_id != $("#T_ID").val() && $("#t_menu").css("display") == "block") { $("#t_menu").css("display", "none") } if ($("#area_tlist li").length > 0) { for (var i = 0; i < $("#area_tlist li").length; i++) { if ($("#area_tlist li:eq(" + i + ")").attr("Id").substring(0, 5) == t_id) { Obj = $("#area_tlist li:eq(" + i + ")"); idx = i; break } } } if (objSelTheater != null) { if ($("#area_tlist li").length > 0) { for (var i = 0; i < $("#area_tlist li").length; i++) { if ($("#area_tlist li:eq(" + i + ")").attr("class") == "on") { objSelTheater = $("#area_tlist li:eq(" + i + ")"); break } } } } if (TParamSet == "N" && SearchSelTheaterYN == "N" && $(Obj).attr("class") == "on") { } else if (Obj != null) { if (objSelTheater != null) { $(objSelTheater).attr("class", "") } objSelTheater = Obj; tmpArray = $(Obj).attr("Id").split(":"); t_nm = tmpArray[1]; chk_seat_yn = tmpArray[3]; $("#T_ID").val(t_id); $("#T_NM").val(t_nm); $("#NT_ID").val(tmpArray[4]); SelTheaterImg = tmpArray[5]; SelTheaterEnterTime = tmpArray[7]; selTheaterArea = select_area; select_t_area = select_area; $("#select_place_txt").html("<strong><a href=\"javascript:TheaterDetail('" + $("#T_ID").val() + "')\" onclick=\"nclk(this, 'rst.theater', '', 1);\">" + $("#T_NM").val() + "</a></strong>"); if ($(Obj).attr("class") == "end" || $(Obj).attr("class") == "e_over") { objTheater = null; ReserveTList = ""; $("#area_tlist li").attr("class", ""); $("#M_ID").val(""); $("#M_NM").val(""); $("#PLAY_DT").val(""); if (objSelMovie != null) { $(objSelMovie).attr("class", "") } objSelMovie = null; GetMovieList($("#T_ID").val(), $("#PLAY_DT").val()); GetPlayDate($("#M_ID").val(), $("#T_ID").val()); setTheatertimelist($("#T_ID").val()); GetSelectInit(); $("#select_date_txt").html("-"); $("#select_totalprice_txt").html("<strong>0</strong>"); $("#select_seat_txt").html("-"); if (chk_seat_yn == "0") { $("#select_seat_txt").html("해당 극장 자동 배정") } } else { SelTheater() } $(Obj).attr("class", "on"); $(Obj).css("cursor", ""); if (objSelMovie != null) { $("#section_info_result").attr("class", "") } else { $("#section_info_result").attr("class", "default") } InitOnResultBtn(); HideTheaterAC(); if (mode == "1") { var focusListId = $(Obj).attr("Id"); if (focusListId != null) { if (oScrollBarTheater != null) { oScrollBarTheater.setScrollTop(document.getElementById(focusListId).offsetTop) } } if (TListMode == 3) { MakeTheaterList(objMyTheaterData) } else { MakeTheaterList(objTheaterData) } } SetTimeView("1") } TParamSet = "N"; SearchSelTheaterYN = "N" } var SearchSelTheaterYN = "N"; function SearchSelTheaterList(t_id) { var rtn = ""; var ul_str = ""; var li_str = ""; var t_nm = ""; var tarObjElement = objTheaterData; var searchIndex = ""; var searchWord = $.trim($("#txtTheater").attr("value")); searchWord = searchWord.replace("*", ""); searchWord = RegSC(searchWord); searchWord = searchWord.toUpperCase(); var searchWord_txt = $.trim($("#txtTheater").attr("value")); if (searchWord_txt.chkCharCodeAt() == "1") { if (searchWord_txt.length > 9) { searchWord_txt = searchWord_txt.cut(18) } } else { if (searchWord_txt.length > 12) { searchWord_txt = searchWord_txt.cut(12) } } $("#txtSearchTheater").html("" + searchWord_txt + ""); if (t_id != "") { if ($("#T_ID").val() != "") { $("#T_ID").val("") } $("#T_ID").val(t_id); TListMode = "0"; SearchSelTheaterYN = "Y"; objSelTheater = null; if (objTheaterData != null) { if (objTheaterData.length > 0) { for (var i = 0; i < objTheaterData.length; i++) { if (objTheaterData[i][0] == t_id) { select_area = objTheaterData[i][10]; select_t_area = select_area; SelArea(select_area, "", "1"); chk_seat_yn = objTheaterData[i][7]; break } } } } $("#t_tab_menu a").attr("class", ""); $("#t_tab_menu li:eq(0) a").attr("class", "on"); $("#select_area").css("top", "80px"); $("#t_chain").css("display", "none"); $("#tab_location").css("display", "block"); $("#area_tlist").css("display", "block"); $("#t_area_tlist").attr("class", "location_area"); SelTheaterList(t_id, "1"); closeSearchReseult() } else { searchWord = searchWord.replace("-", ""); searchWord = searchWord.replaceAll(" ", ""); for (var j = 0; j < tarObjElement.length; j++) { var tlistWord = tarObjElement[j][1].replace("-", ""); tlistWord = tlistWord.replaceAll(" ", ""); searchIndex = tlistWord.toUpperCase().search(searchWord); if (searchIndex >= 0) { li_str += "<li id=\"" + tarObjElement[j][0] + "\" title=\"" + tarObjElement[j][1] + "\" onmouseover=\"javascript:LiMouseOver('on');\"><a href=\"javascript:SearchSelTheaterList('" + tarObjElement[j][0] + "');\">" + tarObjElement[j][1] + "</a></li>" } } if (li_str.length > 0) { ul_str = "<ul id=\"t_srch_lst_result\" class=\"lst_result\">" + li_str + "</ul>"; $("#TheaterSearchResultList").html(ul_str) } else { var searchWord_chk = $.trim($("#txtTheater").attr("value")).toLowerCase(); if (searchWord_chk.indexOf("cgv") != -1) { rtn += "<p class=\"notice\">CGV 체인은 영화예매를 지원하지 않습니다.</p>" } else { rtn += "<p class=\"notice\"><strong>검색된 극장이 없습니다.</strong><br/>"; rtn += "<span class=\"ico\">극장명이 정확한지 확인해 주세요.</span><br/>"; rtn += "<span class=\"ico\">다른 극장으로 검색해 보세요.</span></p>" } $("#TheaterSearchResultList").html(rtn); $("#SearchResult").css("display", "block"); $("#TheaterSearchResultList").css("display", "block") } } HideTheaterAC() } function SelTheater() { if (TParamSet == "N") { GetMovieList($("#T_ID").val(), $("#PLAY_DT").val()); GetPlayDate($("#M_ID").val(), $("#T_ID").val()) } if ($("#M_ID").val() != "" && $("#T_ID").val() != "" && $("#PLAY_DT").val() != "") { if (PTParamSet == "N") { GetPlayTime($("#M_ID").val(), $("#T_ID").val(), $("#PLAY_DT").val()) } else { GetPlayTime($("#M_ID").val(), $("#T_ID").val(), $("#PLAY_DT").val()); selParamPlayTime($("#T_ID").val()) } } else if ($("#T_ID").val() != "") { setTheatertimelist($("#T_ID").val()) } $("#select_price_txt").html("-"); $("#select_seat_txt").html("-"); if (chk_seat_yn == "0") { $("#select_seat_txt").html("해당 극장 자동 배정") } $("#select_totalprice_txt").html("<strong>0</strong>") } function setTheatertimelist(t_id) { var rtn = ""; var t_nm = $("#T_NM").val(); var chk_my_t = IsCheckMyTheater(t_id); var nt_id = $("#NT_ID").val(); var photo_url = SelTheaterImg; var sh_t_logo = ""; var sh_t_nm = ""; var sh_t_info = ""; if (nt_id == "LOTTEC") { photo_url = "http://movie-img.yes24.com/NHN/img/th_lotte_logo_s.png" } else if (nt_id == "MEGABOX") { if (t_id == "T0443" || t_id == "T0442" || t_id == "T0522") { if (photo_url != "") { photo_url = "http://movie-img.yes24.com/NYes24/THEATER/" + photo_url } else { photo_url = "http://movie-img.yes24.com/NHN/img/tmp_theaterImg.PNG" } } else { photo_url = "http://movie-img.yes24.com/NHN/img/th_Nmegabox_logo_s.png" } } else if (nt_id == "PRIMUS") { photo_url = "http://movie-img.yes24.com/NHN/img/th_primus_logo_s.png" } else if (nt_id == "CGV") { photo_url = "http://movie-img.yes24.com/NHN/img/th_cgv_logo.png" } else { if (photo_url != "") { photo_url = "http://movie-img.yes24.com/NYes24/THEATER/" + photo_url } else { photo_url = "http://movie-img.yes24.com/NHN/img/tmp_theaterImg.PNG" } } sh_t_logo = "<a href=\"http://movie.naver.com/movie/api/yes24/theaterLink.nhn?T_CODE=" + t_id + "\" onclick=\"nclk(this, 'tbl.theater', '', 1);\" target=\"_blank\"><img src=\"" + photo_url + "\" width=\"56\" height=\"41\" onclick=\"nclk(this, 'tbl.thumb', '', 1);\" alt=\"\"></a>"; sh_t_nm = "<a href=\"http://movie.naver.com/movie/api/yes24/theaterLink.nhn?T_CODE=" + t_id + "\" onclick=\"nclk(this, 'tbl.theater', '', 1);\" target=\"_blank\"><strong>" + t_nm + "</strong></a>"; if (chk_my_t == "1") { if (IsPersonalAgree == "1") { sh_t_nm += "<em class=\"my\" title=\"MY극장\"><span class=\"blind\">MY극장</span></em>" } } if (chk_seat_yn == "1") { sh_t_nm += "<em class=\"seat\">좌석선택가능</em>" } if (t_id == "T0879") sh_t_nm += "<span style=\"padding-left:7px;color:#fa413c\">* 티켓 시간 " + SelTheaterEnterTime + "분 뒤 상영시작, 상영 후 입장이 제한 됩니다</span>"; else if (t_id == "T0599" || t_id == "T0523" || t_id == "T0568") sh_t_nm += "<span style=\"padding-left:7px;color:#fa413c\">* 정시상영 / 상영 후 " + SelTheaterEnterTime + "분 뒤 입장 제한</span>"; else if (SelTheaterEnterTime != "" && SelTheaterEnterTime != "0") sh_t_nm += "<span style=\"padding-left:7px;color:#fa413c\">* 해당 극장은 상영 " + SelTheaterEnterTime + "분 후 입장 제한됩니다.</span>"; else sh_t_nm += ""; sh_t_info = "<ul>"; if (IsPersonalAgree == "1") { if (chk_my_t == "1") { sh_t_info += "<li><a href=\"javascript:DeleteMyTheater('" + t_id + "')\" onclick=\"nclk(this, 'tbl.my', '', 1);\">MY극장 삭제</a></li>" } else { sh_t_info += "<li><a href=\"javascript:AddMyTheater('" + t_id + "')\" onclick=\"nclk(this, 'tbl.my', '', 1);\">MY극장 추가</a></li>" } } sh_t_info += "<li><a href=\"javascript:GetTheaterSchedule('" + t_id + "');\" onclick=\"nclk(this, 'tbl.layer', '', 1);\">극장시간표</a></li>"; sh_t_info += "<li><a href=\"javascript:viewTheaterMap('" + t_id + "');\" onclick=\"nclk(this, 'tbl.map', '', 1);\">극장정보</a></li>"; sh_t_info += "</ul>"; $("#sh_t_logo").html(sh_t_logo); $("#sh_t_nm").html(sh_t_nm); $("#sh_t_info").html(sh_t_info); rtn += "<div class=\"time \">"; rtn += "<dl class=\"num_time\">"; rtn += "<dt>- 관</dt>"; rtn += "<dd>"; rtn += "<ul class=\"lst_schedule\">"; for (var i = 0; i < 10; i++) { rtn += "<li class=\"dimmed\">00:00</li>" } rtn += "</ul>"; rtn += "</dd></dl></div>"; $("#timelist").html(rtn); if (scrboxSchedule == null) { scrboxSchedule = new jindo.ScrollBox("scrboxSchedule", { bAdjustThumbSize: true, sOverflowX: Number.POSITIVE_INFINITY, sOverflowY: "scroll" }); oScrollBarSchedule = new jindo.ScrollBar("scrboxSchedule", { htCustomEventHandler: { scroll: function (oCustomEvent) { } } }) } else { if (scrboxSchedule != null) { scrboxSchedule.setSize(568, 91); scrboxSchedule.setContentSize(568, Number.POSITIVE_INFINITY); scrboxSchedule.reset() } if (oScrollBarSchedule != null) { oScrollBarSchedule.reset() } } } function DelSelTheater(obj) { var i = 0; var t_nm = ""; var chk_my_t = "0"; var tmpArray = $(obj).attr("Id").split(":"); t_nm = tmpArray[1]; chk_seat_yn = tmpArray[3]; GetMovieList($("#T_ID").val(), $("#PLAY_DT").val()); GetPlayDate($("#M_ID").val(), $("#T_ID").val()); if ($("#M_ID").val() != "" && $("#T_ID").val() != "" && $("#PLAY_DT").val() != "") { if (PTParamSet == "N") { GetPlayTime($("#M_ID").val(), $("#T_ID").val(), $("#PLAY_DT").val()) } } else if ($("#T_ID").val() != "") { setTheatertimelist($("#T_ID").val()) } else { SetTimeView("0") } } function DelTimeTheater(t_id) { var idx; var Obj; var chkObj; if ($("#area_tlist li").length > 0) { for (i = 0; i < $("#area_tlist li").length; i++) { if ($("#area_tlist li:eq(" + i + ")").attr("Id").substring(0, 5) == t_id) { Obj = $("#area_tlist li:eq(" + i + ")"); chkObj = $("#area_tlist input:eq(" + i + ")"); idx = i; break } } } $(Obj).attr("class", ""); $(chkObj).attr("class", ""); $(chkObj).attr("checked", false); DelSelTheater(Obj) } var tt_paly_dt = ""; function GetTheaterSchedule(t_id) { $("#t_menu").css("display", "none"); if (obj_t_menu != null) { $(obj_t_menu).attr("class", "btn") } $("#TT_ID").val(t_id); var str = ""; var play_dt = todayDate; if ($("#PLAY_DT").val() != "") { play_dt = $("#PLAY_DT").val() } tt_paly_dt = play_dt; GetTheaterInfo(t_id); $("#ly_section").css("display", "block") } function MakeTTPlayDate(t_id, play_dt) { var PrevDate = ""; var NextDate = ""; var tmp_yy = play_dt.substring(0, 4); var tmp_mm = play_dt.substring(5, 7); var tmp_dd = play_dt.substring(8, 10); PrevDate = getNextWeek(play_dt, -1); NextDate = getNextWeek(play_dt, 1); str = ""; str += "<a href=\"javascript:TT_ViewPrevDate('" + t_id + "', '" + PrevDate + "');\" title=\"이전\" class=\"pre\"><span class=\"blind\">이전</span></a>"; str += " <em class=\"m" + play_dt.substring(0, 1) + "\"><span class=\"blind\">" + play_dt.substring(0, 1) + "</span></em>"; str += " <em class=\"m" + play_dt.substring(1, 2) + "\"><span class=\"blind\">" + play_dt.substring(1, 2) + "</span></em>"; str += " <em class=\"m" + play_dt.substring(2, 3) + "\"><span class=\"blind\">" + play_dt.substring(2, 3) + "</span></em>"; str += " <em class=\"m" + play_dt.substring(3, 4) + "\"><span class=\"blind\">" + play_dt.substring(3, 4) + "</span></em>"; str += " <em class=\"dot\"><span class=\"blind\">.</span></em>"; str += " <em class=\"m" + play_dt.substring(5, 6) + "\"><span class=\"blind\">" + play_dt.substring(5, 6) + "</span></em>"; str += " <em class=\"m" + play_dt.substring(6, 7) + "\"><span class=\"blind\">" + play_dt.substring(6, 7) + "</span></em>"; str += " <em class=\"dot\"><span class=\"blind\">.</span></em>"; str += " <em class=\"m" + play_dt.substring(8, 9) + "\"><span class=\"blind\">" + play_dt.substring(8, 9) + "</span></em>"; str += " <em class=\"m" + play_dt.substring(9, 10) + "\"><span class=\"blind\">" + play_dt.substring(9, 10) + "</span></em>"; str += " <span class=\"blind\">" + play_dt.substring(0, 4) + "." + play_dt.substring(5, 7) + "." + play_dt.substring(8, 10) + "</span>"; str += " <a href=\"javascript:TT_ViewNextDate('" + t_id + "', '" + NextDate + "');\" title=\"다음\" class=\"next\"><span class=\"blind\">다음</span></a>"; str += " <a href=\"javascript:OpenTTCalendar('" + t_id + "');\" title=\"달력\" class=\"calendar\"><span class=\"blind\">달력</span></a>"; str += " <a href=\"javascript:TT_ViewToday('" + t_id + "', '" + todayDate + "');\" title=\"오늘\" class=\"today\"><span class=\"blind\">오늘</span></a>"; $("#tt_date").html(str); GetPlayDateForTime(t_id, ""); GetPlayTimeByArea(t_id, play_dt) } function getNextWeek(v, t) { var str = new Array(); var b = v.split("-"); var c = new Date(b[0], b[1] - 1, b[2]); var d = c.valueOf() + 1000 * 60 * 60 * 24 * t; var e = new Date(d); var tmp_y = e.getFullYear(); var tmp_m = e.getMonth() + 1; var tmp_d = e.getDate(); str[str.length] = tmp_y; str[str.length] = ((tmp_m < 10) ? ("0" + tmp_m) : tmp_m); str[str.length] = ((tmp_d < 10) ? ("0" + tmp_d) : tmp_d); return str.join("-") } function OpenTTCalendar() { TT_Calendar(todayDate); $("#tt_playdate").css("display", "block") } function TT_ViewPrevDate(t_id, PrevDate) { if (PrevDate >= todayDate) { MakeTTPlayDate(t_id, PrevDate); $("#tt_playdate").css("display", "none"); sel_tt_playTimeInfoObj = null; TT_Calendar(PrevDate) } else { alert("과거 날짜는 예매가 불가능합니다.") } } function TT_ViewNextDate(t_id, NextDate) { var tmp_NextDate = ""; if (tt_playDateObj != null) { if (tt_playDateObj.length > 0) { tmp_NextDate = tt_playDateObj[tt_playDateObj.length - 1] } } if (tmp_NextDate != "" && NextDate > tmp_NextDate) { alert("이후 날짜부터는 상영 스케쥴이 없습니다.") } else { MakeTTPlayDate(t_id, NextDate); $("#tt_playdate").css("display", "none"); sel_tt_playTimeInfoObj = null; TT_Calendar(NextDate) } } function TT_ViewToday(t_id, play_dt) { sel_tt_playTimeInfoObj = null; MakeTTPlayDate(t_id, play_dt); GetPlayTimeByArea(t_id, play_dt); $("#tt_playdate").css("display", "none"); TT_Calendar(play_dt) } var ttYear; var ttMonth; function TT_Calendar(play_dt) { ttYear = play_dt.substring(0, 4); ttMonth = play_dt.substring(5, 7); if (ttMonth.length > 1) { if (ttMonth.substring(0, 1) == "0") { ttMonth = ttMonth.substring(1, 2) } } $("#tt_calendar").html(DrawCalendar(ttYear, ttMonth, tt_playDateObj, "1")) } function CloseTheaterSchedule() { tt_NT_ID = ""; tt_paly_dt = ""; $("#TT_ID").val(""); $("#tt_info").html(""); $("#tt_date").html(""); $("#tt_timelist").html(""); $("#tt_playdate").css("display", "none"); $("#ly_section").css("display", "none") } function SelPlayDate(date, weekday, mode) { SelMovie_css = ""; SelectAreaInit(); $("#t_menu").css("display", "none"); if ($("#T_ID").val() == "" && mode != "1" && PParamSet == "N" && TListModeType != "1") { TListMode = 1; $("#t_chain").css("display", "none") } SetPLAY_DT(date); if (curMonth.length > 1) { if (curMonth.substring(0, 1) == "0") { curMonth = curMonth.substring(1, 2) } } $("#calendar").html(DrawCalendar(curYear, curMonth, playDateObj, "0")); SelPlayDataInit(date, ""); $("#select_price_txt").html("-"); $("#select_seat_txt").html("-"); if (chk_seat_yn == "0") { $("#select_seat_txt").html("해당 극장 자동 배정") } $("#select_totalprice_txt").html("<strong>0</strong>"); if (objSelMovie != null) { $("#section_info_result").attr("class", "") } else { $("#section_info_result").attr("class", "default") } InitOnResultBtn(); if (PParamSet == "Y") { PParamSet = "N"; GetPlayDate($("#M_ID").val(), $("#T_ID").val()) } else { if (mode == "0") { if ($("#M_ID").val() != "" && $("#T_ID").val() != "") { if (PTParamSet == "N") { GetPlayTime($("#M_ID").val(), $("#T_ID").val(), $("#PLAY_DT").val()) } } GetMovieList($("#T_ID").val(), $("#PLAY_DT").val()); GetTheater($("#M_ID").val(), $("#PLAY_DT").val(), ""); SetTimeView("0") } } if (mode == "0") { GetPriceInit() } } function SelPlayDataInit(date, playtime) { var select_playDate = ""; var playDate_mm = date.substring(5, 7); var playDate_dd = date.substring(8, 10); if (playDate_mm.substring(0, 1) == "0") { playDate_mm = playDate_mm.substring(1, 2) } if (playDate_dd.substring(0, 1) == "0") { playDate_dd = playDate_dd.substring(1, 2) } var oDt = new Date(date.substring(0, 4), playDate_mm - 1, playDate_dd); var nVDay = oDt.getDay(); select_playDate = date.substring(0, 4) + "." + playDate_mm + "." + playDate_dd + " (" + GetWeekDay(nVDay) + ")"; var play_time = ""; if (playtime != "") { play_time = playtime.substring(0, 2) + ":" + playtime.substring(2, 4) } if (playtime != "") { play_time = GetPlayTimeText($("#NT_ID").val(), play_time); str_play_time = play_time; $("#select_date_txt").html("<strong>" + select_playDate + ", " + play_time + "</strong>") } else { $("#select_date_txt").html("<strong>" + select_playDate + "</strong>"); str_play_time = ""; $("#select_playdate_txt").html("<strong class=\"on\">" + date.substring(0, 4) + "년 " + playDate_mm + "월 " + playDate_dd + "일 <span>(</span>" + GetWeekDay(nVDay) + "요일<span>)</span></strong>") } } function TT_SelPlayDate(date, weekday) { var t_id = ""; var chk_tmp = "0"; if ($("#TT_ID").val() != "") { t_id = $("#TT_ID").val() } var playDate_mm = date.substring(5, 7); var playDate_dd = date.substring(8, 10); if (playDate_mm.substring(0, 1) == "0") { playDate_mm = playDate_mm.substring(1, 2) } if (playDate_dd.substring(0, 1) == "0") { playDate_dd = playDate_dd.substring(1, 2) } var oDt = new Date(date.substring(0, 4), playDate_mm - 1, playDate_dd); var nVDay = oDt.getDay(); var select_playDate = date.substring(0, 4) + "." + playDate_mm + "." + playDate_dd + " (" + GetWeekDay(nVDay) + ")"; $("#select_date_txt").html("<strong>" + select_playDate + "</strong>"); $("#select_playdate_txt").html("<strong class=\"on\">" + date.substring(0, 4) + "년 " + playDate_mm + "월 " + playDate_dd + "일 <span>(</span>" + GetWeekDay(nVDay) + "요일<span>)</span></strong>"); SetPLAY_DT(date); $("#PLAY_DT").val(date); MakeTTPlayDate(t_id, date); GetPlayTimeByArea(t_id, date) } function SetTimeView(type) { $("#select_time").attr("class", "default"); GetPriceInit(); if ($("#M_ID").val() != "" && $("#T_ID").val() != "" && $("#PLAY_DT").val() != "") { $("#select_time").attr("class", "") } else { if ($("#M_ID").val() != "" && $("#T_ID").val() != "") { if (type == "0") { SelTheater() } $("#select_time").attr("class", "mt") } else if ($("#T_ID").val() != "" && $("#PLAY_DT").val() != "") { if (type == "0") { SelTheater() } $("#select_time").attr("class", "td") } else if ($("#M_ID").val() != "" && $("#PLAY_DT").val() != "") { $("#select_time").attr("class", "md"); GetTimeInit() } else if ($("#M_ID").val() != "") { $("#select_time").attr("class", "m"); GetTimeInit() } else if ($("#T_ID").val() != "") { $("#select_time").attr("class", "t") } else if ($("#PLAY_DT").val() != "") { $("#select_time").attr("class", "d"); GetTimeInit() } else { $("#select_time").attr("class", "default"); GetTimeInit() } } } function SelTime(pt_id) { if (playTimeObj != null) { selPrice_ = ""; MakeTimeList(playTimeObj, pt_id); var IdObj = sel_playTimeInfoObj; if (IdObj == null) { setTimeout("SelTime('" + pt_id + "')", 1000); return } var tmpArray = IdObj.split("@"); SetPT_ID(tmpArray[0]); $("#PT_ID").val(pt_id); $("#T_ID").val(tmpArray[1]); $("#T_NM").val(tmpArray[2]); $("#TS_ID").val(tmpArray[3]); $("#TS_NM").val(tmpArray[4]); $("#PLAYTIME").val(tmpArray[5]); str_play_end_time = tmpArray[7]; SelPlayDataInit($("#PLAY_DT").val(), tmpArray[5]); $("#select_place_txt").html("<strong><a href=\"javascript:TheaterDetail('" + $("#T_ID").val() + "')\" onclick=\"nclk(this, 'rst.theater', '', 1);\">" + $("#T_NM").val() + "</a>" + $("#TS_NM").val() + "</strong>"); $("#select_price_txt").html("-"); $("#select_seat_txt").html("-"); if (chk_seat_yn == "0") { $("#select_seat_txt").html("해당 극장 자동 배정") } $("#select_totalprice_txt").html("<strong>0</strong>"); GetPrice($("#PT_ID").val(), $("#M_ID").val(), $("#T_ID").val(), $("#PLAY_DT").val()); setTheaterInfo(tmpArray[1]); PTParamSet = "N" } else { setTimeout("SelTime('" + pt_id + "')", 1000); return } } function TT_SelTimeChk(pt_id) { MakeTimeTableArea(tt_playtimeObj, pt_id) } function setTheaterInfo(t_id) { var tmp_value; if (objTheaterData != null) { if (objTheaterData.length > 0) { for (i = 0; i < objTheaterData.length; i++) { if (objTheaterData[i][0] == t_id) { max_cnt = parseInt(objTheaterData[i][6]); if (max_cnt > 8) { max_cnt = 8 } t_logo_url = TLogoPath + objTheaterData[i][9].replace("--", "/"); SelTheaterImg = objTheaterData[i][9].replace("--", "/"); SetNT_ID(objTheaterData[i][8]); seat_yn = (objTheaterData[i][7] == "1" ? true : false); break } } } } else { setTimeout("setTheaterInfo('" + t_id + "')", 1000); return } } var TT_SelTime_chk = "N"; function TT_SelTime() { var play_time = ""; if (sel_tt_playTimeInfoObj == null) { alert("상영시간을 선택해주세요."); return } else { var tmpArray = sel_tt_playTimeInfoObj.split("@"); SetPT_ID(tmpArray[0]); $("#PT_ID").val(tmpArray[0]); $("#T_ID").val(tmpArray[1]); $("#T_NM").val(tmpArray[2]); $("#TS_ID").val(tmpArray[3]); $("#TS_NM").val(tmpArray[4]); $("#PLAYTIME").val(tmpArray[5]); $("#PLAY_CL").val(tmpArray[6]); $("#PLAY_DT").val(tmpArray[7]); $("#M_ID").val(tmpArray[8]); $("#M_NM").val(tmpArray[9]); $("#M_GRADE").val(tmpArray[10]); $("#GRPM_ID").val(tmpArray[12]); setTheaterInfo(tmpArray[1]); curYear = tmpArray[7].substring(0, 4); curMonth = tmpArray[7].substring(5, 7); if (curMonth.length > 1) { if (curMonth.substring(0, 1) == "0") { curMonth = curMonth.substring(1, 2) } } playtime_ = ""; str_play_time = ""; str_play_end_time = ""; play_time = tmpArray[5]; playtime_ = tmpArray[5]; play_time = play_time.substring(0, 2) + ":" + play_time.substring(2, 4); play_time = GetPlayTimeText(tt_NT_ID, play_time); str_play_time = play_time; str_play_end_time = tmpArray[11]; SelPlayDataInit($("#PLAY_DT").val(), tmpArray[5]); $("#select_place_txt").html("<strong><a href=\"javascript:TheaterDetail('" + $("#T_ID").val() + "')\" onclick=\"nclk(this, 'rst.theater', '', 1);\">" + $("#T_NM").val() + "</a>" + $("#TS_NM").val() + "</strong>"); GetMovieList($("#T_ID").val(), $("#PLAY_DT").val()); TT_SelTime_chk = "Y"; GetTheater($("#M_ID").val(), $("#PLAY_DT").val(), ""); GetPlayDate($("#M_ID").val(), $("#T_ID").val()); GetPlayTime2($("#M_ID").val(), $("#T_ID").val(), $("#PLAY_DT").val()); SelMovieList($("#M_ID").val(), -1, "1", ""); SelPlayDate($("#PLAY_DT").val(), "0", "1"); SelTime(tmpArray[0]); CloseTheaterSchedule() } } var str_price1 = ""; var str_price2 = ""; var str_price3 = ""; function SelPrice(idx, num) { var obj = $("#price_type" + idx + " li:eq(" + num + ")"); $("#price_type" + idx + " li").attr("class", ""); obj.attr("class", "on"); var tmpArray = $("#price_type" + idx + " li:eq(" + num + ")").attr("id").split("@"); var price = parseInt(tmpArray[1]); var price_cd = tmpArray[2]; var grade = GetGrade(price_cd); var lg_thanks_yn = tmpArray[9]; var cnt = tmpArray[10]; $("#LG_THANKS_YN").val(lg_thanks_yn); $("#tk_thanks_yn").val(lg_thanks_yn); if (grade == 0) { adu_quan = parseInt(cnt); adu_price = price } else if (grade == 1) { stu_quan = parseInt(cnt); stu_price = price } else { etc_quan = parseInt(cnt); etc_price = price } tot_cnt = parseInt(adu_quan) + parseInt(stu_quan) + parseInt(etc_quan); tot_price = (adu_quan * adu_price) + (stu_quan * stu_price) + (etc_quan * etc_price); $("#TICKET_CNT").val(tot_cnt.toString()); SetRemainSelSeat(); if (adu_quan > 0) { str_price1 = "성인 " + adu_quan } else { str_price1 = "" } if (stu_quan > 0) { if (str_price1 != "") { str_price2 = ",학생 " + stu_quan } else { str_price2 = "학생 " + stu_quan } } else { str_price2 = "" } if (etc_quan > 0) { if (grade == 2) { if (tmpArray[0] != "어린이" && tmpArray[0] != "아동") { if (str_price1 != "" || str_price2 != "") { str_price3 = "," + tmpArray[0] + " " + etc_quan } else { str_price3 = tmpArray[0] + etc_quan } } else { if (str_price1 != "" || str_price2 != "") { str_price3 = ",아동 " + etc_quan } else { str_price3 = "아동 " + etc_quan } } } } else { str_price3 = "" } var tmp_price_chk = "0"; if (selPrice_ != "") { var tmpArray = selPrice_.split("|"); var tmp_selPrice_ = selPrice_; selPrice_ = ""; for (var ii = 0; ii < tmpArray.length; ii++) { var tmpArray2 = tmpArray[ii].split(":"); if (tmpArray2[0] == idx) { if (selPrice_ != "") { selPrice_ += "|" + idx + ":" + num } else { selPrice_ = idx + ":" + num } tmp_price_chk = "1" } else { if (selPrice_ != "") { selPrice_ += "|" + tmpArray[ii] } else { selPrice_ = tmpArray[ii] } } } if (tmp_price_chk == "0") { if (selPrice_ != "") { selPrice_ += "|" + idx + ":" + num } else { selPrice_ = idx + ":" + num } } } else { selPrice_ = idx + ":" + num } $("#CNT").val(selPrice_); var str_price = ""; if (str_price1 != "" || str_price2 != "" || str_price3 != "") { str_price = str_price1 + " " + str_price2 + " " + str_price3 } var str_fee = fee_amt * parseInt(tot_cnt); var str_r_price1 = ""; var str_r_price2 = ""; var str_r_price3 = ""; if (str_price1 != "") { str_r_price1 = str_price1 + "명(" + changePriceStr(adu_price) + "원X" + adu_quan + ")" } if (str_price2 != "") { str_r_price2 = str_price2 + "명(" + changePriceStr(stu_price) + "원X" + stu_quan + ")" } if (str_price3 != "") { str_r_price3 = str_price3 + "명(" + changePriceStr(etc_price) + "원X" + etc_quan + ")" } var str_result_price = ""; str_result_price = str_r_price1; if (str_r_price2 != "") { if (str_result_price != "") { str_result_price += ", " + str_r_price2 } else { str_result_price = str_r_price2 } } if (str_r_price3 != "") { if (str_result_price != "") { str_result_price += ", " + str_r_price3 } else { str_result_price = str_r_price3 } } result_str_price = ""; result_total_price = ""; result_str_price = changePriceStr(tot_price) + "원 " + str_result_price + ", 수수료(" + changePriceStr(str_fee) + "원)"; result_total_price = changePriceStr(tot_price + str_fee); $("#select_totalprice_txt").html("<strong>" + changePriceStr(tot_price + str_fee) + "</strong> <em>(수수료 <span>" + changePriceStr(str_fee) + "</span>원 포함)</em>"); if (str_price == "") { sel_price_txt = ""; $("#select_price_txt").html("-") } else { sel_price_txt = str_price; $("#select_price_txt").html("<strong>" + str_price + "</strong>") } SetPayInfo(); if (NBParamSet == "Y") { $("#btn_Reserve1").css("visibility", "visible"); setTimeout("nbReset()", 1000) } } function nbReset() { NBParamSet = "N" } function GetGrade(price_cd) { var grade = 0; switch (price_cd) { case "THPRICE100": case "THPRICE100": case "THPRICE300": case "THPRICE500": case "THPRICE700": case "THPRICE110": case "THPRICE1001": case "THPRICE1100": case "THPRICE1300": case "THPRICE130": grade = 0; break; case "THPRICE200": case "THPRICE400": case "THPRICE600": case "THPRICE800": case "THPRICE120": grade = 1; break; default: grade = 2; break } return grade } function SetRemainSelSeat() { var remain_cnt = parseInt(max_cnt) - parseInt(tot_cnt); var rtn = ""; var selIdx = 0; var obj = null; var personInfo = ""; for (var i = 0; i < objPrice.length; i++) { rtn = ""; selIdx = 0; for (var k = 0; k < 9; k++) { if ($("#price_type" + i + " li:eq(" + k + ")").attr("class") == "on") { obj = $("#price_type" + i + " li:eq(" + k + ")"); if (tot_cnt == 0) { $("#SEAT_INFO").val(""); $("#PRICE_CNT").val(""); $("#PRICE_CD").val(""); $("#T_PRICE").val(""); $("#SEAT_GRD").val(""); $("#SEAT_STR").val("") } else { var tmpArray = obj.attr("id").split("@"); if (personInfo == "") { personInfo = tmpArray[0] + " " + tmpArray[10] + "명"; price_cnt = tmpArray[10]; pt_price_id_str = tmpArray[4] + ":" + tmpArray[10]; price_cd_info = tmpArray[2]; t_price_info = tmpArray[1]; seat_grd = tmpArray[3]; seat_info = tmpArray[0] + ":" + (parseInt(tmpArray[1]) * parseInt(tmpArray[10])) + ":" + tmpArray[2] + ":" + tmpArray[5] + ":" + tmpArray[6] + ":" + tmpArray[10] + ":" + tmpArray[8] } else { personInfo += " | " + tmpArray[0] + " " + tmpArray[10] + "명"; price_cnt += "|" + tmpArray[10]; pt_price_id_str += "|" + tmpArray[4] + ":" + tmpArray[10]; price_cd_info += "|" + tmpArray[2]; t_price_info += "|" + tmpArray[1]; seat_grd += "|" + tmpArray[3]; seat_info += "|" + tmpArray[0] + ":" + (parseInt(tmpArray[1]) * parseInt(tmpArray[10])) + ":" + tmpArray[2] + ":" + tmpArray[5] + ":" + tmpArray[6] + ":" + tmpArray[10] + ":" + tmpArray[8] } $("#PRICE_CD").val(price_cd_info); $("#T_PRICE").val(t_price_info); $("#SEAT_INFO").val(seat_info); $("#PRICE_CNT").val(price_cnt); $("#SEAT_GRD").val(seat_grd); $("#SEAT_STR").val(personInfo) } selIdx = k } } if (selIdx != 0) { for (var j = 0; j < selIdx + 1; j++) { if (selIdx == j) { rtn += "<li id=\"" + objPrice[i] + "@" + j + "\" class=\"on\">" + j + "</li>" } else { rtn += "<li id=\"" + objPrice[i] + "@" + j + "\"><a href=\"javascript:SelPrice(" + i + ", " + j + ");\" onclick=\"nclk(this, 'peo.select', '', 1);\">" + j + "</a></li>" } } for (var m = selIdx + 1; m < (selIdx + remain_cnt + 1); m++) { rtn += "<li id=\"" + objPrice[i] + "@" + m + "\"><a href=\"javascript:SelPrice(" + i + ", " + m + ");\" onclick=\"nclk(this, 'peo.select', '', 1);\">" + m + "</a></li>" } } else { for (var n = selIdx; n < (selIdx + remain_cnt + 1); n++) { rtn += "<li id=\"" + objPrice[i] + "@" + n + "\"><a href=\"javascript:SelPrice(" + i + ", " + n + ");\" onclick=\"nclk(this, 'peo.select', '', 1);\">" + n + "</a></li>" } } for (var re_n = (selIdx + remain_cnt + 1); re_n < 9; re_n++) { rtn += "<li class=\"dimmed\">" + re_n + "</li>" } $("#price_type" + i).html(rtn) } } function SetM_ID(m_id) { if (m_id.substring(0, 1) == "_") m_id = m_id.substring(1); $("#M_ID").val(m_id) } function SetT_ID(t_id) { if (t_id.substring(0, 1) == "_") t_id = t_id.substring(1); $("#T_ID").val(t_id) } function SetNT_ID(nt_id) { $("#NT_ID").val(nt_id) } function SetFILTER_NT_ID(nt_id) { $("#FILTER_NT_ID").val(nt_id) } function SetPLAY_DT(play_dt) { $("#PLAY_DT").val(play_dt) } function SetPT_ID(pt_id) { $("#PT_ID").val(pt_id) } function SortByNum(x, y) { return x.m1 - y.m1 } function SortByM_NM(x, y) { return ((x.m3 == y.m3) ? 0 : (((x.m11 == y.m11) ? 0 : ((x.m3 > y.m3) ? 1 : -1)))) } function SortByNHN_RANK(x, y) { return x.m9 - y.m9 } function GetMovieList(t_id, play_dt) { $.ajax({ type: "POST", url: "/AsyncRequest/GetMovie.aspx", data: "CMD=MLIST&FLAG=" + MListMode + "&T_ID=" + t_id + "&PLAY_DT=" + play_dt + "&FE_FLAG=0", cache: false, success: GetMovieListCallback, dataType: "text" }) } function GetMovieListCallback(res) { var obj; if (res != "") { obj = JSON.parse(res); objMovie = obj; MakeMovieList(objMovieData) } } function MakeMovieList(obj) { $("#M_TAB").val(MListMode); if (MListMode == 0) { obj.sort(SortByNum) } else if (MListMode == 1) { obj.sort(SortByNum); obj.sort(SortByM_NM) } else { obj.sort(SortByNum); obj.sort(SortByNHN_RANK) } objMovieData = obj; var rtn = ""; var rtn1 = ""; var cnt = 0; var sel_idx = -1; var m_grade = ""; var m_grade_str = ""; var tmp_m_rank = ""; var m_rank_str = ""; var m_rank_line = ""; var aTempHTML = []; $("#select_price").attr("class", "ticket off"); var tmp_grpm_id = ""; var tmp_m_id = ""; if (objMovie != null) { if (MListMode == 0) { objMovie.sort(SortByNum) } else if (MListMode == 1) { objMovie.sort(SortByNum); objMovie.sort(SortByM_NM) } else { objMovie.sort(SortByNum); objMovie.sort(SortByNHN_RANK) } var tmp_m_nm = ""; var tmp_m_nm_len = 32; MovieList = ""; if (objMovie.length > 0) { for (var ii = 0; ii < objMovie.length; ii++) { tmp_m_nm_len = 32; m_grade = ""; m_grade_str = ""; if (MovieList == "") { MovieList = objMovie[ii].m2 + "" } else { MovieList += "|" + objMovie[ii].m2 } m_grade = GetMovieGrade(objMovie[ii].m4); m_grade_str = GetMovieGradeNM(objMovie[ii].m4); if ($("#M_ID").val() == objMovie[ii].m2) { tmp_grpm_id = objMovie[ii].m11; tmp_m_id = objMovie[ii].m2; aTempHTML.push("<li id=\"" + objMovie[ii].m2 + "|" + objMovie[ii].m5 + "|" + objMovie[ii].m6 + "|" + objMovie[ii].m4 + "|" + objMovie[ii].m11 + "\" title=\"" + objMovie[ii].m3 + "\" class=\"on\" onclick=\"javascript:SelMovieList('" + objMovie[ii].m2 + "', '" + cnt + "', '0', '');nclk(this, 'mov.list', '" + objMovie[ii].m2 + "', '" + cnt + "');\">"); sel_idx = cnt } else { aTempHTML.push("<li id=\"" + objMovie[ii].m2 + "|" + objMovie[ii].m5 + "|" + objMovie[ii].m6 + "|" + objMovie[ii].m4 + "|" + objMovie[ii].m11 + "\" title=\"" + objMovie[ii].m3 + "\" onmouseover=\"LiMouseOver(this,'over');\" onmouseout=\"LiMouseOut(this,'');\" onclick=\"javascript:SelMovieList('" + objMovie[ii].m2 + "', '" + cnt + "', '0', '');nclk(this, 'mov.list', '" + objMovie[ii].m2 + "', '" + cnt + "');\" style=\"cursor:pointer;cursor:hand\">") } m_rank_str = ""; tmp_m_rank = ""; if (MListMode == 2) { tmp_m_rank = objMovie[ii].m9 } else { tmp_m_rank = objMovie[ii].m7 } if (tmp_m_rank != "999") { if (tmp_m_rank != "") { m_rank_str = "<strong>"; for (var kk = 0; kk < tmp_m_rank.length; kk++) { m_rank_str += "<span class=\"r" + tmp_m_rank.substring(kk, kk + 1) + "\"><span class=\"blind\">" + tmp_m_rank.substring(kk, kk + 1) + "</span></span>" } m_rank_str += "</strong>" } } tmp_m_nm_len = 36; aTempHTML.push("<em class=\"" + m_grade + "\"><span class=\"blind\">" + m_grade_str + "</span></em>"); tmp_m_nm = objMovie[ii].m3; if (tmp_m_nm.length > 19) { tmp_m_nm = tmp_m_nm.cut(tmp_m_nm_len) } aTempHTML.push(tmp_m_nm); aTempHTML.push("</li>"); cnt++ } } var tmpChk = 0; if (obj.length > 0) { aTempHTML.unshift("<ul class=\"lst_movie\">"); for (var i = 0; i < obj.length; i++) { tmp_m_nm_len = 36; tmpChk = 0; if (MovieList.indexOf(obj[i].m2) != -1) { tmpChk = 1 } m_grade = ""; m_grade_str = ""; m_grade = GetMovieGrade(obj[i].m4); m_grade_str = GetMovieGradeNM(obj[i].m4); if (tmpChk == 0) { if ($("#M_ID").val() == obj[i].m2 && tmpChk == 1) { tmp_grpm_id = objMovie[ii].m11; tmp_m_id = objMovie[ii].m2; aTempHTML.push("<li id=\"" + obj[i].m2 + "|" + obj[i].m5 + "|" + obj[i].m6 + "|" + obj[i].m4 + "|" + obj[i].m11 + "\" title=\"" + obj[i].m3 + "\" onmouseover=\"LiMouseOver(this, 'e_over');\" onmouseout=\"LiMouseOut(this, 'end');\" class=\"on\" onclick=\"javascript:SelMovieList('" + obj[i].m2 + "', '" + cnt + "', '0', '');nclk(this, 'mov.list', '" + obj[i].m2 + "', '" + cnt + "');\">"); sel_idx = cnt } else { aTempHTML.push("<li id=\"" + obj[i].m2 + "|" + obj[i].m5 + "|" + obj[i].m6 + "|" + obj[i].m4 + "|" + obj[i].m11 + "\" title=\"" + obj[i].m3 + "\" onmouseover=\"LiMouseOver(this, 'e_over');\" onmouseout=\"LiMouseOut(this, 'end');\" class=\"end\" onclick=\"javascript:SelMovieList('" + obj[i].m2 + "', '" + cnt + "','0', 'end');nclk(this, 'mov.list', '" + obj[i].m2 + "', '" + cnt + "');\" style=\"cursor:pointer;cursor:hand\">") } m_rank_str = ""; tmp_m_rank = ""; if (MListMode == 2) { tmp_m_rank = obj[i].m9 } else { tmp_m_rank = obj[i].m7 } if (tmp_m_rank != "999") { if (tmp_m_rank != "") { m_rank_str = "<strong>"; for (var mm = 0; mm < tmp_m_rank.length; mm++) { m_rank_str += "<span class=\"r" + tmp_m_rank.substring(mm, mm + 1) + "\"><span class=\"blind\">" + tmp_m_rank.substring(mm, mm + 1) + "</span></span>" } m_rank_str += "</strong>" } } tmp_m_nm_len = 38; aTempHTML.push("<em class=\"" + m_grade + "\"><span class=\"blind\">" + m_grade_str + "</span></em>"); tmp_m_nm = obj[i].m3; if (tmp_m_nm.length > 21) { tmp_m_nm = tmp_m_nm.cut(tmp_m_nm_len) } aTempHTML.push(tmp_m_nm); aTempHTML.push("</li>"); cnt++ } } aTempHTML.push("</ul>") } else { aTempHTML.push("<ul class=\"lst_movie\"><li>상영중인 영화가 없습니다</li></ul>") } } else { if (obj.length > 0) { aTempHTML.push("<ul class=\"lst_movie\">"); for (var j = 0; j < obj.length; j++) { tmp_m_nm_len = 32; m_grade = ""; m_grade_str = ""; m_grade = GetMovieGrade(obj[j].m4); m_grade_str = GetMovieGradeNM(obj[j].m4); m_rank_str = ""; tmp_m_rank = ""; if (MListMode == 2) { if (obj[j].m9 == "999" && m_rank_line != "1") { m_rank_line = "1"; cnt = cnt + 1; aTempHTML.push("<li id=\"rankline\" class=\"line\"></li>") } tmp_m_rank = obj[j].m9 } else { tmp_m_rank = obj[j].m7 } if ($("#M_ID").val() == obj[j].m2) { tmp_grpm_id = obj[j].m11; tmp_m_id = obj[j].m2; aTempHTML.push("<li id=\"" + obj[j].m2 + "|" + obj[j].m5 + "|" + obj[j].m6 + "|" + obj[j].m4 + "|" + obj[j].m11 + "\" title=\"" + obj[j].m3 + "\" class=\"on\" onclick=\"javascript:SelMovieList('" + obj[j].m2 + "', '" + cnt + "','0', '');nclk(this, 'mov.list', '" + obj[j].m2 + "', '" + cnt + "');\">"); sel_idx = cnt } else { aTempHTML.push("<li id=\"" + obj[j].m2 + "|" + obj[j].m5 + "|" + obj[j].m6 + "|" + obj[j].m4 + "|" + obj[j].m11 + "\" title=\"" + obj[j].m3 + "\" onmouseover=\"LiMouseOver(this,'over');\" onmouseout=\"LiMouseOut(this,'');\" onclick=\"javascript:SelMovieList('" + obj[j].m2 + "', '" + cnt + "','0', '');nclk(this, 'mov.list', '" + obj[j].m2 + "', '" + cnt + "');\" style=\"cursor:pointer;cursor:hand\">") } if (tmp_m_rank != "999") { if (tmp_m_rank != "") { m_rank_str = "<strong>"; for (var n = 0; n < tmp_m_rank.length; n++) { m_rank_str += "<span class=\"r" + tmp_m_rank.substring(n, n + 1) + "\"><span class=\"blind\">" + tmp_m_rank.substring(n, n + 1) + "</span></span>" } m_rank_str += "</strong>" } } tmp_m_nm_len = 36; aTempHTML.push("<em class=\"" + m_grade + "\"><span class=\"blind\">" + m_grade_str + "</span></em>"); tmp_m_nm = obj[j].m3; if (tmp_m_nm.length > 19) { tmp_m_nm = tmp_m_nm.cut(tmp_m_nm_len) } aTempHTML.push(tmp_m_nm); aTempHTML.push("</li>"); cnt++ } aTempHTML.push("</ul>") } else { aTempHTML.push("<ul class=\"lst_movie\"><li>상영중인 영화가 없습니다</li></ul>") } } $("#mlist").html(aTempHTML.join('')); if (scrboxMovie == null) { scrboxMovie = new jindo.ScrollBox("scrboxMovie", { bAdjustThumbSize: true, sOverflowX: "auto", sOverflowY: "scroll" }); oScrollBarMovie = new jindo.ScrollBar("scrboxMovie", { htCustomEventHandler: { scroll: function (oCustomEvent) { } } }) } if (sel_idx != -1) { objSelMovie = $("#mlist li:eq(" + sel_idx + ")") } if (MParamSet == "Y") { SelMovieList($("#M_ID").val(), sel_idx, "1", "") } if (objSelMovie != null) { var focusListId; if (parseInt(sel_idx) < 13) { MovieListFocusTop() } else if (parseInt(sel_idx) >= 13) { focusListId = $("#mlist li:eq(" + (sel_idx - 6) + ")").attr("Id"); oScrollBarMovie.setScrollTop(document.getElementById(focusListId).offsetTop) } else { focusListId = $(objSelMovie).attr("Id"); oScrollBarMovie.setScrollTop(document.getElementById(focusListId).offsetTop) } if (rEventMovieList.indexOf(tmp_grpm_id) != -1 || rEventMovieList.indexOf(tmp_m_id) != -1) { $("#evt_tx_ing_area").css("display", "block") } else { $("#evt_tx_ing_area").css("display", "none") } } else { $("#evt_tx_ing_area").css("display", "none"); MovieListFocusTop() } } function GetMovieGrade(grade) { var grade_img = ""; if (grade == "NAN") { grade_img = "all" } else if (grade == "00") { grade_img = "all" } else if (grade == "12") { grade_img = "g12" } else if (grade == "15") { grade_img = "g15" } else if (grade == "18") { grade_img = "g18" } return grade_img } function GetMovieGradeNM(grade) { var gradenm = ""; if (grade == "NAN") { gradenm = "관람등급 미정" } else if (grade == "00") { gradenm = "전체 관람가" } else if (grade == "12") { gradenm = "12세 이상 관람가" } else if (grade == "15") { gradenm = "15세 이상 관람가" } else if (grade == "18") { gradenm = "<span>청소년 관람불가</span>" } return gradenm } function GetMyTheaterData2() { $.ajax({ type: "POST", url: "/AsyncRequest/GetTheater.aspx", data: "CMD=MYTLIST", cache: false, success: GetMyTheaterDataCallback2, dataType: "text" }) } function GetMyTheaterDataCallback2(res) { if (res != "") { obj = JSON.parse(res); objMyTheaterData = obj } else { objMyTheaterData = null } } function GetMyTheaterData() { $.ajax({ type: "POST", url: "/AsyncRequest/GetTheater.aspx", data: "CMD=MYTLIST", cache: false, success: GetMyTheaterDataCallback, dataType: "text" }) } function GetMyTheaterDataCallback(res) { $("#t_tab_menu a").attr("class", ""); $("#t_tab_menu li:eq(" + TListMode + ") a").attr("class", "on"); var obj; if (FlagInit == "0" && res == "") { TListMode = 0 } else if (FlagInit == "0" && res == "") { TListMode = 0 } else if (res == "") { if (IsLogin != "True") { $("#scrboxTheater").css("display", "none"); $("#area_tlist").css("display", "none"); $("#t_area_tlist").css("display", "none"); $("#t_area_tlist2").css("display", "none"); $("#t_area_tlist3").css("display", "block"); $("#t_my_msg").html("<p class=\"login\"><strong><em><a href=\"javascript:gotoLoginChk('2')\">로그인</a></em> 해주세요.</strong><br>로그인 후 MY극장 정보를<br>보실 수 있습니다.</p>") } else { $("#scrboxTheater").css("display", "none"); $("#area_tlist").css("display", "none"); $("#t_area_tlist").css("display", "none"); $("#t_area_tlist2").css("display", "none"); $("#t_area_tlist3").css("display", "block"); $("#t_my_msg").html("<p class=\"login\"><strong>추가된 MY극장이 없습니다.</strong><br>자주가는 극장을 My극장으로 추가해 주세요.</p>") } } else { TListMode = "3"; obj = JSON.parse(res); objMyTheaterData = obj; if (objMyTheaterData != null && setTimeCnt < 4) { setTimeCnt = 0; if (FlagInit == "0") { MakeTheaterList(objMyTheaterData) } else { if (objMyTheaterData != null) { MakeTheaterList(objMyTheaterData) } } } else { if (setTimeCnt < 4) { setTimeCnt = parseInt(setTimeCnt) + 1; setTimeout("GetMyTheaterDataCallback('" + res + "')", 500); return } } } } function TheaterDataList() { if (TParamSet != "N" && $("#T_ID").val() != "" && select_area == "") { if (objTheaterData != null) { if (objTheaterData.length > 0) { for (var i = 0; i < objTheaterData.length; i++) { if (objTheaterData[i][0] == $("#T_ID").val()) { select_area = objTheaterData[i][10]; break } } } } SelArea(select_area, "", "1") } $("#t_tab_menu a").attr("class", ""); $("#t_tab_menu li:eq(" + TListMode + ") a").attr("class", "on"); $("#tab_location").css("display", "block"); $("#area_tlist").css("display", "block"); if (TParamSet == "N") { MakeTheaterList(objTheaterData) } else { if (IsLogin == "True") { if (TListMode == "3") { FlagInit = "0" } else { MakeTheaterList(objTheaterData) } } else { MakeTheaterList(objTheaterData) } } } function GetTheater(m_id, play_dt, nt_id) { $.ajax({ type: "POST", url: "/AsyncRequest/GetTheater.aspx", data: "CMD=TLIST&M_ID=" + m_id + "&PLAY_DT=" + play_dt + "&NT_ID=" + nt_id, cache: false, success: GetTheaterCallback, dataType: "text" }) } function GetTheaterCallback(res) { var obj = JSON.parse(res); objTheater = obj; if (objTheater != null) { GetReserveTList() } else { if (TParamSet == "N") { if (TListMode == "3") { MakeTheaterList(objMyTheaterData) } else { MakeTheaterList(objTheaterData) } } } GetAreaTheaterCnt() } function GetReserveTList() { ReserveTList = ""; if (objTheater != null) { for (var n1 = 0; n1 < objTheater.length; n1++) { ReserveTList += objTheater[n1][0] + "|" } } if (TParamSet == "N") { if (TListMode == "3") { MakeTheaterList(objMyTheaterData) } else { MakeTheaterList(objTheaterData) } } } var AddMyTheaterType = "0"; function AddMyTheater(t_id) { if (IsLogin != "True") { gotoLoginChk("1") } else { $.ajax({ type: "POST", url: "/AsyncRequest/GetTheater.aspx", data: "CMD=ADDMYTHEATER&T_ID=" + t_id, cache: false, success: AddMyTheaterCallback, dataType: "text" }) } } function AddMyTheaterCallback(res) { var resArray = res.split("|"); if (resArray[0] == "success") { if (AddMyTheaterType == "0") { alert("My극장에 추가되었습니다.") } objAddMyTheater += resArray[1] + "|"; objDelMyTheater = ""; AddMyTheaterType = "0"; var t_id = resArray[1]; if ($("#t_menu").css("display") == "block") { var t_menu_layer = ""; if (IsPersonalAgree == "1") { t_menu_layer = "<ul>"; t_menu_layer += "<li><a href=\"javascript:DeleteMyTheater('" + t_id + "')\">MY극장 삭제</a></li>" } else { t_menu_layer = "<ul class=\"short\">" } t_menu_layer += "<li><a href=\"javascript:GetTheaterSchedule('" + t_id + "');\">극장시간표</a></li>"; t_menu_layer += "<li><a href=\"javascript:viewTheaterMap('" + t_id + "');\">극장정보</a></li>"; t_menu_layer += "</ul>"; $("#t_menu_layer").html(t_menu_layer); $("#t_menu").css("display", "none"); if (obj_t_menu != null) { $(obj_t_menu).attr("class", "btn") } } if ($("#T_ID").val() != "" && $("#T_ID").val() == t_id) { var sh_t_info = ""; sh_t_info = "<ul>"; if (IsPersonalAgree == "1") { sh_t_info += "<li><a href=\"javascript:DeleteMyTheater('" + t_id + "')\" onclick=\"nclk(this, 'tbl.my', '', 1);\">MY극장 삭제</a></li>" } sh_t_info += "<li><a href=\"javascript:GetTheaterSchedule('" + t_id + "');\" onclick=\"nclk(this, 'tbl.layer', '', 1);\">극장시간표</a></li>"; sh_t_info += "<li><a href=\"javascript:viewTheaterMap('" + t_id + "');\" onclick=\"nclk(this, 'tbl.map', '', 1);\">극장정보</a></li>"; sh_t_info += "</ul>"; $("#sh_t_info").html(sh_t_info); var sh_t_nm = ""; sh_t_nm = "<a href=\"http://movie.naver.com/movie/api/yes24/theaterLink.nhn?T_CODE=" + t_id + "\"  onclick=\"nclk(this, 'tbl.theater', '', 1);\" target=\"_blank\"><strong>" + $("#T_NM").val() + "</strong></a>"; if (IsPersonalAgree == "1") { sh_t_nm += "<em class=\"my\" title=\"MY극장\"><span class=\"blind\">MY극장</span></em>" } if (chk_seat_yn == "1") { sh_t_nm += "<em class=\"seat\">좌석선택가능</em>" } if (SelTheaterEnterTime != "" && SelTheaterEnterTime != "0") { sh_t_nm += "<span style=\"padding-left:7px;color:#fa413c\">* 해당 극장은 상영 " + SelTheaterEnterTime + "분 후 입장 제한됩니다.</span>" } $("#sh_t_nm").html(sh_t_nm) } if (TListMode == 3) { GetMyTheaterData() } } else { alert("극장 정보 준비 중인 극장입니다.\n현재는 MY극장으로 추가할 수 없습니다.") } } function DeleteMyTheater(t_id) { $.ajax({ type: "POST", url: "/AsyncRequest/GetTheater.aspx", data: "CMD=DELMYTHEATER&T_ID=" + t_id, cache: false, success: DeleteMyTheaterCallback, dataType: "text" }) } function DeleteMyTheaterCallback(res) { var resArray = res.split("|"); if (resArray[0] == "success") { alert("My극장에 삭제되었습니다."); objAddMyTheater = ""; objDelMyTheater += resArray[1] + "|"; GetMyTheaterData2(); var t_id = resArray[1]; if ($("#t_menu").css("display") == "block") { var t_menu_layer = ""; if (IsPersonalAgree == "1") { t_menu_layer = "<ul>"; t_menu_layer += "<li><a href=\"javascript:AddMyTheater('" + t_id + "')\">MY극장 추가</a></li>" } else { t_menu_layer = "<ul class=\"short\">" } t_menu_layer += "<li><a href=\"javascript:GetTheaterSchedule('" + t_id + "');\">극장시간표</a></li>"; t_menu_layer += "<li><a href=\"javascript:viewTheaterMap('" + t_id + "');\">극장정보</a></li>"; t_menu_layer += "</ul>"; $("#t_menu_layer").html(t_menu_layer); $("#t_menu").css("display", "none"); if (obj_t_menu != null) { $(obj_t_menu).attr("class", "btn") } } if ($("#T_ID").val() != "" && $("#T_ID").val() == t_id) { var sh_t_info = ""; sh_t_info = "<ul>"; if (IsPersonalAgree == "1") { sh_t_info += "<li><a href=\"javascript:AddMyTheater('" + t_id + "')\" onclick=\"nclk(this, 'tbl.my', '', 1);\">MY극장 추가</a></li>" } sh_t_info += "<li><a href=\"javascript:GetTheaterSchedule('" + t_id + "');\" onclick=\"nclk(this, 'tbl.layer', '', 1);\">극장시간표</a></li>"; sh_t_info += "<li><a href=\"javascript:viewTheaterMap('" + t_id + "');\" onclick=\"nclk(this, 'tbl.map', '', 1);\">극장정보</a></li>"; sh_t_info += "</ul>"; $("#sh_t_info").html(sh_t_info); var sh_t_nm = ""; sh_t_nm = "<a href=\"http://movie.naver.com/movie/api/yes24/theaterLink.nhn?T_CODE=" + t_id + "\" onclick=\"nclk(this, 'tbl.theater', '', 1);\" target=\"_blank\"><strong>" + $("#T_NM").val() + "</strong></a>"; if (chk_seat_yn == "1") { sh_t_nm += "<em class=\"seat\">좌석선택가능</em>" } if (SelTheaterEnterTime != "" && SelTheaterEnterTime != "0") { sh_t_nm += "<span style=\"padding-left:7px;color:#fa413c\">* 해당 극장은 상영 " + SelTheaterEnterTime + "분 후 입장 제한됩니다.</span>" } $("#sh_t_nm").html(sh_t_nm) } if (TListMode == 3) { MakeTheaterList(objMyTheaterData); closeTheaterInfo() } } else { alert("My극장 삭제 오류 : 다시 시도해주세요.") } } function MakeTheaterList(obj) { $("#T_TAB").val(TListMode); $("#select_price").attr("class", "ticket off"); var city_cd = ""; var prev_city_cd = ""; var area_nm = ""; var prev_area_nm = ""; var prev_area_cd = ""; var chk_my_t = ""; var chk_list_t = "0"; var chk_list_first = 0; var reserve_yn = "0"; var myRowCnt = 0; var onRowCnt = 0; var t_RowCnt = 0; var idx = 0; var idx2 = 0; var area_idx = 0; var t_name = ""; var t_num; var t_num_space; var t_num_etc; var t_size; var rtn = ""; var rtn2 = ""; var focusListId2 = null; var aMakeTheaterHTML = []; if (obj != null) { for (var i = 0; i < obj.length; i++) { reserve_yn = "0"; chk_my_t = "1"; chk_list_t = "0"; if (TListMode == 3) { chk_list_t = "1"; chk_my_t = IsCheckMyTheater(obj[i][0]) } else { if (select_area_all == "Y") { chk_list_t = IsCheckTheaterList(obj[i][8], "", obj[i][4]) } else { chk_list_t = IsCheckTheaterList(obj[i][8], obj[i][10], obj[i][4]) } } t_size = 6; if (TListMode == 1 || TListMode == 3) { if (i == 0) { if (select_area_all != "Y") { aMakeTheaterHTML.push("<ul class=\"lst_theater2\">") } } if (chk_my_t != "0" && chk_list_t == "1") { if (objTheater != null) { if (ReserveTList.indexOf(obj[i][0]) != -1) { reserve_yn = "1" } } else { reserve_yn = "1" } if ((TListMode == 1 && reserve_yn == "1") || TListMode == 3) { myRowCnt = myRowCnt + 1; t_name = obj[i][1]; area_nm = obj[i][5]; if (select_area_all == "Y") { if (myRowCnt > 1) { t_RowCnt = parseInt(t_RowCnt) + 1 } if (myRowCnt > 1 && area_nm != prev_area_nm) { rtn = "<dl id=\"Area" + prev_area_cd.replace("-", "") + "\"><dt>" + prev_area_nm + "<span>(</span>" + t_RowCnt + "<span>)</span></dt><dd><ul class=\"lst_theater2\">"; t_RowCnt = 0; idx2 = parseInt(idx2) + 1; if (select_region == obj[i - 1][4]) { area_idx = parseInt(idx2) - 1 } aMakeTheaterHTML.push(rtn + rtn2 + "</ul></dd></dl>"); rtn2 = "" } } else { aMakeTheaterHTML.push(rtn2); rtn2 = "" } rtn2 += "<li id=\"" + obj[i][0] + ":" + obj[i][1] + ":" + obj[i][6] + ":" + obj[i][7] + ":" + obj[i][8] + ":" + obj[i][9] + ":" + obj[i][10] + ":" + obj[i][12] + "\""; if ($("#T_ID").val() == obj[i][0]) { idx = myRowCnt - 1; focusListId2 = obj[i][0] + ":" + obj[i][1] + ":" + obj[i][6] + ":" + obj[i][7] + ":" + obj[i][8] + ":" + obj[i][9] + ":" + obj[i][10] + ":" + obj[i][12]; onRowCnt = parseInt(onRowCnt) + 1; rtn2 += " onmouseover=\"javascript:TLiMouseOver(this,'over', '" + i + "');\" class=\"on\">" } else { if (reserve_yn == "0") { t_size = 5; rtn2 += " onmouseover=\"javascript:TLiMouseOver(this,'e_over', '" + i + "');\" onmouseout=\"javascript:TLiMouseOut(this, 'end', '" + i + "');\" class=\"end\" style=\"cursor:pointer;cursor:hand\">" } else { onRowCnt = parseInt(onRowCnt) + 1; rtn2 += " onmouseover=\"javascript:TLiMouseOver(this,'over', '" + i + "');\" onmouseout=\"javascript:TLiMouseOut(this, '', '" + i + "');\" style=\"cursor:pointer;cursor:hand\">" } } rtn2 += "<em onclick=\"javascript:SelTheaterList('" + obj[i][0] + "', '');nclk(this, 'the.list','" + obj[i][0] + "', '" + myRowCnt + "');\">"; if (t_size == "5") { if (t_name.length > 15) { t_name = t_name.cut(24) } } else { if (t_name.length > 13) { t_name = t_name.cut(21) } } if (obj[i][7] == "1") { t_num = t_name.bytes(); t_num_space = 0; t_num_etc = 0; var region_len = obj[i][5].length; var regSpecialChar = /^[A-Z]/; for (var t_len = t_name.length - 1; t_len >= 0; t_len--) { if (t_name.charAt(t_len) == " " || t_name.charAt(t_len) == "(") t_num_space = parseInt(t_num_space) + 1; if (regSpecialChar.test(t_name.charAt(t_len)) && t_name.charAt(t_len) != "I") t_num_etc = parseInt(t_num_etc) + 2; if (t_name.charAt(t_len) == "I") { if (t_size == 5) { t_num_etc = parseInt(t_num_etc) - 4 } else { t_num_etc = parseInt(t_num_etc) - 2 } } } if (t_size == 5) { t_num_etc = parseInt(t_num_etc) - 2 } t_num_etc = parseInt(t_num_etc) + (parseInt(region_len) * 11) + parseInt(region_len) + 13 } rtn2 += "<span class=\"location\">[<strong><strong>" + obj[i][5] + "</strong></strong>]</span>"; rtn2 += t_name; if (obj[i][7] == "1") { rtn2 += "<span class=\"seat\" onmouseover=\"javascript:TSeatMouseOver(this, '" + t_size + "', '" + t_num + "', '" + t_name.length + "', '" + t_num_space + "', '" + t_num_etc + "', '" + region_len + "');\" onmouseout=\"javascript:TSeatMouseOut();\">좌석선택가능</span>" } rtn2 += "</em>"; rtn2 += "<a onclick=\"javascript:moreTheaterInfo(this,'" + obj[i][0] + "');nclk(this, 'the.more', '', 1);\" class=\"btn\" onmouseover=\"javascript:TMenuMouseOver(this);\" onmouseout=\"javascript:TMenuMouseOut();\">메뉴 더보기</a>"; rtn2 += "</li>"; prev_area_nm = area_nm; prev_area_cd = obj[i][4] } } if (i == obj.length - 1) { if (select_area_all == "Y") { t_RowCnt = parseInt(t_RowCnt) + 1; rtn = "<dl id=\"Area" + prev_area_cd.replace("-", "") + "\"><dt>" + prev_area_nm + "<span>(</span>" + t_RowCnt + "<span>)</span></dt><dd><ul class=\"lst_theater2\">"; aMakeTheaterHTML.push(rtn + rtn2 + "</ul></dd></dl>") } else { aMakeTheaterHTML.push(rtn2 + "</ul>") } } } else { if (chk_list_t == "1") { if (objTheater != null) { if (ReserveTList.indexOf(obj[i][0]) != -1) { reserve_yn = "1" } } else { reserve_yn = "1" } myRowCnt = myRowCnt + 1; area_nm = obj[i][5]; if (myRowCnt == 1) { idx2 = parseInt(idx2) + 1; if (select_region == obj[i][4]) { area_idx = parseInt(idx2) - 1 } aMakeTheaterHTML.push("<dl id=\"Area" + obj[i][4].replace("-", "") + "\"><dt>" + obj[i][5] + "</dt><dd><ul class=\"lst_theater\">") } if (chk_list_first != 0 && area_nm != prev_area_nm) { idx2 = parseInt(idx2) + 1; if (select_region == obj[i][4]) { area_idx = parseInt(idx2) - 1 } aMakeTheaterHTML.push(rtn + rtn2); aMakeTheaterHTML.push("</ul></dd></dl>"); aMakeTheaterHTML.push("<dl id=\"Area" + obj[i][4].replace("-", "") + "\"><dt>" + obj[i][5] + "</dt><dd><ul class=\"lst_theater\">"); rtn = ""; rtn2 = "" } chk_list_first = chk_list_first + 1; if (reserve_yn == "0") { t_size = 5; rtn2 += "<li id=\"" + obj[i][0] + ":" + obj[i][1] + ":" + obj[i][6] + ":" + obj[i][7] + ":" + obj[i][8] + ":" + obj[i][9] + ":" + obj[i][10] + ":" + obj[i][12] + "\""; rtn2 += " onmouseover=\"javascript:TLiMouseOver(this,'e_over', '" + i + "');\" onmouseout=\"javascript:TLiMouseOut(this, 'end', '" + i + "');\" class=\"end\" style=\"cursor:pointer;cursor:hand\">"; if (obj[i][7] == "1") { t_name = obj[i][1]; t_num = t_name.bytes(); t_num_space = 0; t_num_etc = 0; var regSpecialChar = /^[A-Z]/; for (var t_len = t_name.length - 1; t_len >= 0; t_len--) { if (t_name.charAt(t_len) == " " || t_name.charAt(t_len) == "(") t_num_space = parseInt(t_num_space) + 1; if (regSpecialChar.test(t_name.charAt(t_len)) && t_name.charAt(t_len) != "I") t_num_etc = parseInt(t_num_etc) + 2; if (t_name.charAt(t_len) == "I") { t_num_etc = parseInt(t_num_etc) - 4 } } } rtn2 += "<em onclick=\"javascript:SelTheaterList('" + obj[i][0] + "', '');nclk(this, 'the.list', '" + obj[i][0] + "', '" + myRowCnt + "');\">"; rtn2 += obj[i][1]; if (obj[i][7] == "1") { rtn2 += "<span class=\"seat\" onmouseover=\"javascript:TSeatMouseOver(this, '" + t_size + "', '" + t_num + "', '" + t_name.length + "', '" + t_num_space + "', '" + t_num_etc + "', '0');\" onmouseout=\"javascript:TSeatMouseOut();\">좌석선택가능</span>" } rtn2 += "</em>"; rtn2 += "<a onclick=\"javascript:moreTheaterInfo(this,'" + obj[i][0] + "');nclk(this, 'the.more', '', 1);\" class=\"btn\" onmouseover=\"javascript:TMenuMouseOver(this);\" onmouseout=\"javascript:TMenuMouseOut();\">메뉴 더보기</a>"; rtn2 += "</li>" } else { rtn += "<li id=\"" + obj[i][0] + ":" + obj[i][1] + ":" + obj[i][6] + ":" + obj[i][7] + ":" + obj[i][8] + ":" + obj[i][9] + ":" + obj[i][10] + ":" + obj[i][12] + "\""; onRowCnt = parseInt(onRowCnt) + 1; if ($("#T_ID").val() == obj[i][0]) { idx = myRowCnt - 1; focusListId2 = obj[i][0] + ":" + obj[i][1] + ":" + obj[i][6] + ":" + obj[i][7] + ":" + obj[i][8] + ":" + obj[i][9] + ":" + obj[i][10] + ":" + obj[i][12]; rtn += " onmouseover=\"javascript:TLiMouseOver(this,'over', '" + i + "');\" class=\"on\">" } else { rtn += " onmouseover=\"javascript:TLiMouseOver(this,'over', '" + i + "');\" onmouseout=\"javascript:TLiMouseOut(this, '', '" + i + "');\" style=\"cursor:pointer;cursor:hand\">" } if (obj[i][7] == "1") { t_name = obj[i][1]; t_num = t_name.bytes(); t_num_space = 0; t_num_etc = 0; var regSpecialChar = /^[A-Z]/; for (var t_len = t_name.length - 1; t_len >= 0; t_len--) { if (t_name.charAt(t_len) == " " || t_name.charAt(t_len) == "(") t_num_space = parseInt(t_num_space) + 1; if (regSpecialChar.test(t_name.charAt(t_len)) && t_name.charAt(t_len) != "I") t_num_etc = parseInt(t_num_etc) + 2; if (t_name.charAt(t_len) == "I") { t_num_etc = parseInt(t_num_etc) - 2 } } } rtn += "<em onclick=\"javascript:SelTheaterList('" + obj[i][0] + "', '');nclk(this, 'the.list', '" + obj[i][0] + "', '" + myRowCnt + "');\">"; rtn += obj[i][1]; if (obj[i][7] == "1") { rtn += "<span class=\"seat\" onmouseover=\"javascript:TSeatMouseOver(this, '" + t_size + "', '" + t_num + "', '" + t_name.length + "', '" + t_num_space + "', '" + t_num_etc + "', '0');\" onmouseout=\"javascript:TSeatMouseOut();\">좌석선택가능</span>" } rtn += "</em>"; rtn += "<a onclick=\"javascript:moreTheaterInfo(this,'" + obj[i][0] + "');nclk(this, 'the.more', '', 1);\" class=\"btn\" onmouseover=\"javascript:TMenuMouseOver(this);\" onmouseout=\"javascript:TMenuMouseOut();\">메뉴 더보기</a>"; rtn += "</li>" } prev_area_nm = area_nm } if (i == obj.length - 1) { aMakeTheaterHTML.push(rtn + rtn2); aMakeTheaterHTML.push("</ul></dd></dl>") } } } } $("#area_tlist_no").css("display", "none"); $("#t_tab_menu a").attr("class", ""); $("#t_tab_menu li:eq(" + TListMode + ") a").attr("class", "on"); $("#select_area_nm").html("<a href=\"javascript:moreArea();\" onclick=\"nclk(this, 'the.loc', '', 1);\" class=\"\">" + select_area_nm + "(<strong>" + onRowCnt + "</strong>)</a>"); var scrollchk = "Y"; var scrollchk2 = "N"; if (TListMode == 3) { $("#t_area_tlist").attr("class", "location_area2"); $("#tab_location").css("display", "none"); $("#area_other_lst").css("display", "none"); if (IsLogin != "True") { scrollchk = "N"; $("#scrboxTheater").css("display", "none"); $("#area_tlist").css("display", "none"); $("#t_area_tlist").css("display", "none"); $("#t_area_tlist2").css("display", "none"); $("#t_area_tlist3").css("display", "block"); $("#t_my_msg").html("<p class=\"login\"><strong><em><a href=\"javascript:gotoLoginChk('2')\">로그인</a></em> 해주세요.</strong><br>로그인 후 MY극장 정보를<br>보실 수 있습니다.</p>") } else if (myRowCnt == 0) { scrollchk = "N"; $("#scrboxTheater").css("display", "none"); $("#area_tlist").css("display", "none"); $("#t_area_tlist").css("display", "none"); $("#t_area_tlist2").css("display", "none"); $("#t_area_tlist3").css("display", "block"); $("#t_my_msg").html("<p class=\"login\"><strong>추가된 MY극장이 없습니다.</strong><br>자주가는 극장을 My극장으로 추가해 주세요.</p>") } else { $("#area_tlist").html(aMakeTheaterHTML.join('')); $("#t_area_tlist2").css("display", "none"); $("#t_area_tlist3").css("display", "none"); $("#t_area_tlist").css("display", "block"); $("#area_tlist").css("display", "block") } } else { if (TListMode == 1) { $("#area_other_lst").css("display", "block"); $("#t_area_tlist").attr("class", "location_area") } else if (TListMode == 2) { $("#t_area_tlist").attr("class", "chain_area"); $("#area_other_lst").css("display", "none") } else { $("#t_area_tlist").attr("class", "location_area"); $("#area_other_lst").css("display", "none") } $("#tab_location").css("display", "block"); if (TListMode == 2 && myRowCnt == 0) { scrollchk = "N"; $("#scrboxTheater").css("display", "none"); $("#t_area_tlist").css("display", "none"); $("#t_area_tlist3").css("display", "none"); $("#t_area_tlist2").css("display", "none") } else if (TListMode == 1 && $("#M_ID").val() == "" && $("#PLAY_DT").val() == "") { scrollchk = "N"; $("#area_tlist").html(""); $("#scrboxTheater").css("display", "none"); $("#tab_location").css("display", "none"); $("#area_tlist").css("display", "none"); $("#t_area_tlist").css("display", "none"); $("#t_area_tlist3").css("display", "none"); $("#t_area_tlist2").css("display", "block") } else if (TListMode == 1 && myRowCnt == 0) { scrollchk2 = "Y"; $("#area_tlist").html(""); $("#t_area_tlist3").css("display", "none"); $("#t_area_tlist2").css("display", "none"); $("#area_tlist").css("display", "none"); $("#tab_location").css("display", "block"); $("#t_area_tlist").css("display", "block"); $("#area_tlist_no").html("<p class=\"info\">" + select_area_nm + "지역에 상영극장이 없습니다.</p>"); $("#area_tlist_no").css("display", "block") } else { $("#area_tlist").html(aMakeTheaterHTML.join('')); $("#t_area_tlist").css("display", "block"); $("#t_area_tlist2").css("display", "none"); $("#t_area_tlist3").css("display", "none"); $("#area_tlist").css("display", "block") } } if ((myRowCnt > 0 && scrollchk == "Y") || scrollchk2 == "Y") { $("#scrboxTheater").css("width", "284px"); $("#scrollboxT").css("width", "284px"); $("#scrboxTheater").css("display", "block"); if (TListMode == 2) { $("#scrboxTheater").css("height", "265px"); $("#scrollboxT").css("height", "265px"); $("#scrollcontentT").css("height", $("#t_area_tlist").css("height")) } else if (TListMode == 3) { $("#scrboxTheater").css("height", "331px"); $("#scrollboxT").css("height", "331px"); $("#scrollcontentT").css("height", $("#t_area_tlist").css("height")) } else { $("#scrboxTheater").css("height", "304px"); $("#scrollboxT").css("height", "304px"); $("#scrollcontentT").css("height", $("#t_area_tlist").css("height")) } if (scrboxTheater == null) { scrboxTheater = new jindo.ScrollBox("scrboxTheater", { bAdjustThumbSize: true, sOverflowX: "auto", sOverflowY: "scroll" }); oScrollBarTheater = new jindo.ScrollBar("scrboxTheater", { htCustomEventHandler: { scroll: function (oCustomEvent) { } } }) } else { if (scrboxTheater != null) { var scrollboxT_h = $("#scrollboxT").css("height"); scrollboxT_h = scrollboxT_h.replace("px", ""); var scrollcontentT_h = $("#scrollcontentT").css("height"); scrollcontentT_h = scrollcontentT_h.replace("px", ""); scrboxTheater.setSize(284, scrollboxT_h); scrboxTheater.setContentSize(284, scrollcontentT_h); scrboxTheater.reset(); oScrollBarTheater.reset() } } } if (TT_SelTime_chk == "Y") { if ($("#area_tlist li").length > 0) { if (focusListId2 != null && focusListId2 != "") { objSelTheater = $("#" + focusListId2) } } } TT_SelTime_chk = "N"; var fm_obj = $(); if (idx != 0) { if (SearchSelTheaterYN == "Y") { if (focusListId2 != null && focusListId2 != "") { if (oScrollBarTheater != null) { oScrollBarTheater.setScrollTop(document.getElementById(focusListId2).offsetTop) } } } else { if ($("#M_ID").val() != "" || $("#PLAY_DT").val() != "") { if (focusListId2 != null && focusListId2 != "") { if (oScrollBarTheater != null) { oScrollBarTheater.setScrollTop(document.getElementById(focusListId2).offsetTop) } } } } } else { var area_obj = $("#area_tlist dl:eq(" + area_idx + ")"); if (area_obj != null) { var focusListId = $(area_obj).attr("Id"); if (focusListId != null && focusListId != "") { if (oScrollBarTheater != null) { oScrollBarTheater.setScrollTop(document.getElementById(focusListId).offsetTop) } } } } } function moreTheaterInfo(obj, t_id) { var str = ""; var chk_my_t = "0"; var aMakeTheaterInfoHTML = []; if ($("#t_menu").css("display") == "block") { $("#t_menu").css("display", "none"); if (obj_t_menu != null) { $(obj_t_menu).attr("class", "btn") } $(obj).attr("class", "btn") } else { if (obj_t_menu != obj) { chk_my_t = IsCheckMyTheater(t_id); var pos = $(obj).offset(); var top = pos.top - 64; var m = !window.XMLHttpRequest; if (!!m) { top = parseInt(top) - 4 } if (IsPersonalAgree == "1") { aMakeTheaterInfoHTML.push("<ul>"); if (chk_my_t == "1") { aMakeTheaterInfoHTML.push("<li><a href=\"javascript:DeleteMyTheater('" + t_id + "')\">MY극장 삭제</a></li>") } else { aMakeTheaterInfoHTML.push("<li><a href=\"javascript:AddMyTheater('" + t_id + "')\">MY극장 추가</a></li>") } } else { aMakeTheaterInfoHTML.push("<ul class=\"short\">") } aMakeTheaterInfoHTML.push("<li><a href=\"javascript:GetTheaterSchedule('" + t_id + "');\">극장시간표</a></li>"); aMakeTheaterInfoHTML.push("<li><a href=\"javascript:viewTheaterMap('" + t_id + "');\">극장정보</a></li>"); aMakeTheaterInfoHTML.push("</ul>"); $("#t_menu_layer").html(aMakeTheaterInfoHTML.join('')); $("#t_menu").css("top", top + "px") } $(obj).attr("class", "btn_on"); $("#t_menu").css("display", "block"); obj_t_menu = obj } } function closeTheaterInfo() { $("#t_menu").css("display", "none") } function IsInTheaterList(t_id) { for (var i = 0; i < 6; i++) { for (var j = 0; j < $("#area_" + (i + 1) + " li").length; j++) { if (t_id == $("#area_" + (i + 1) + " li:eq(" + j + ")").attr("id").substring(0, 5)) return true } } return false } function IsCheckMyTheater(t_id) { var chk_my_t = "0"; if (objMyTheaterData != null) { for (var k = 0; k < objMyTheaterData.length; k++) { if (t_id == objMyTheaterData[k][0]) { chk_my_t = "1" } } } if (objAddMyTheater != null && objAddMyTheater != "") { var tmpArray = objAddMyTheater.split("|"); for (var m = 0; m < tmpArray.length; m++) { if (t_id == tmpArray[m]) { chk_my_t = "1"; break } } } if (objDelMyTheater != null && objDelMyTheater != "") { var tmpArray2 = objDelMyTheater.split("|"); for (var n = 0; n < tmpArray2.length; n++) { if (t_id == tmpArray2[n]) { chk_my_t = "0"; break } } } return chk_my_t } function IsCheckTheaterList(nt_id, area_cd, region) { var chk_list_t = "0"; if (TListMode == 2) { if ($("#FILTER_NT_ID").val() != "" && select_area != "") { if ($("#FILTER_NT_ID").val() == nt_id && select_area == area_cd) { chk_list_t = "1" } } else if ($("#FILTER_NT_ID").val() != "") { if ($("#FILTER_NT_ID").val() == nt_id) { chk_list_t = "1" } } else if (select_area != "") { if (select_area == area_cd) { chk_list_t = "1" } } else { chk_list_t = "1" } } else if (TListMode == 1 && select_area_all == "Y") { chk_list_t = "1" } else if (TListMode == 3) { chk_list_t = "1" } else { if (select_area != "") { if (select_area == area_cd) { chk_list_t = "1" } } else { chk_list_t = "1" } } return chk_list_t } function GetPlayDate(m_id, t_id) { $.ajax({ type: "POST", url: "/AsyncRequest/GetPlayDate.aspx", data: "M_ID=" + m_id + "&T_ID=" + t_id, cache: false, success: GetPlayDateCallback, dataType: "text" }) } function GetPlayDateCallback(res) { if (res != "") { playDateObj = JSON.parse(res); $("#calendar").html(DrawCalendar(curYear, curMonth, playDateObj, "0")) } } function GetPlayTime(m_id, t_list, play_dt) { $.ajax({ type: "POST", url: "/AsyncRequest/GetPlayTime.aspx", data: "CMD=PLAYTIME_TLIST&M_ID=" + m_id + "&T_LIST=" + t_list + "&PLAY_DT=" + play_dt, cache: false, success: GetPlayTimeCallback, dataType: "text" }) } function GetPlayTimeCallback(res) { $("#PT_ID").val(""); playTimeObj = null; var obj = JSON.parse(res); playTimeObj = obj; MakeTimeList(playTimeObj, "") } function GetPlayTime2(m_id, t_list, play_dt) { $.ajax({ type: "POST", url: "/AsyncRequest/GetPlayTime.aspx", data: "CMD=PLAYTIME_TLIST&M_ID=" + m_id + "&T_LIST=" + t_list + "&PLAY_DT=" + play_dt, cache: false, success: GetPlayTime2Callback, dataType: "text" }) } function GetPlayTime2Callback(res) { playTimeObj = null; var obj = JSON.parse(res); playTimeObj = obj } function MakeTimeList(obj, pt_id) { if (NBParamSet == "N") { $("#btn_Reserve1").css("visibility", "hidden"); $("#checkout_using").css("display", "none") } sel_playTimeInfoObj = null; var rtn = ""; var cnt = 0; var t_id = ""; var ts_nm = ""; var tmp_ts_nm = ""; var play_time = ""; var runtime = ""; var end_time = ""; var time_class = ""; var active = ""; var chk_my_t = "0"; var nt_id = $("#NT_ID").val(); var photo_url = SelTheaterImg; var sh_t_logo = ""; var sh_t_nm = ""; var sh_t_info = ""; var sh_t_srn_cnt = 0; var sh_t_focus_num = 0; var sh_t_focusListId = ""; var aMakePlayTimeHTML = []; SelPlayDataInit($("#PLAY_DT").val(), str_play_time); if (obj.length > 0) { $("#select_price").attr("class", "ticket off"); $("#select_time").attr("class", ""); for (var i = 0; i < obj.length; i++) { t_id = obj[i][4]; chk_my_t = 0; if (i == 0) { chk_my_t = IsCheckMyTheater(t_id); if (nt_id == "LOTTEC") { photo_url = "http://movie-img.yes24.com/NHN/img/th_lotte_logo_s.png" } else if (nt_id == "MEGABOX") { if (t_id == "T0443" || t_id == "T0442" || t_id == "T0522") { if (photo_url != "") { photo_url = "http://movie-img.yes24.com/NYes24/THEATER/" + photo_url } else { photo_url = "http://movie-img.yes24.com/NHN/img/tmp_theaterImg.PNG" } } else { photo_url = "http://movie-img.yes24.com/NHN/img/th_Nmegabox_logo_s.png" } } else if (nt_id == "PRIMUS") { photo_url = "http://movie-img.yes24.com/NHN/img/th_primus_logo_s.png" } else if (nt_id == "CGV") { photo_url = "http://movie-img.yes24.com/NHN/img/th_cgv_logo.png" } else { if (photo_url != "") { photo_url = "http://movie-img.yes24.com/NYes24/THEATER/" + photo_url } else { photo_url = "http://movie-img.yes24.com/NHN/img/tmp_theaterImg.PNG" } } sh_t_logo = "<a href=\"http://movie.naver.com/movie/api/yes24/theaterLink.nhn?T_CODE=" + t_id + "\" onclick=\"nclk(this, 'tbl.theater', '', 1);\" target=\"_blank\"><img src=\"" + photo_url + "\" width=\"56\" height=\"41\" onclick=\"nclk(this, 'tbl.thumb', '', 1);\" alt=\"\"></a>"; sh_t_nm = "<a href=\"http://movie.naver.com/movie/api/yes24/theaterLink.nhn?T_CODE=" + t_id + "\" onclick=\"nclk(this, 'tbl.theater', '', 1);\" target=\"_blank\"><strong>" + obj[i][5] + "</strong></a>"; if (chk_my_t == "1") { sh_t_nm += "<em class=\"my\" title=\"MY극장\"><span class=\"blind\">MY극장</span></em>" } if (obj[i][6] == "1") { sh_t_nm += "<em class=\"seat\">좌석선택가능</em>" } if (t_id == "T0879") sh_t_nm += "<span style=\"padding-left:7px;color:#fa413c\">* 티켓 시간 " + SelTheaterEnterTime + "분 뒤 상영시작, 상영 후 입장이 제한 됩니다</span>"; else if (t_id == "T0599" || t_id == "T0523" || t_id == "T0568") sh_t_nm += "<span style=\"padding-left:7px;color:#fa413c\">* 정시상영 / 상영 후 " + SelTheaterEnterTime + "분 뒤 입장 제한</span>"; else if (SelTheaterEnterTime != "" && SelTheaterEnterTime != "0") sh_t_nm += "<span style=\"padding-left:7px;color:#fa413c\">* 해당 극장은 상영 " + SelTheaterEnterTime + "분 후 입장 제한됩니다.</span>"; else sh_t_nm += ""; sh_t_info = "<ul>"; if (IsPersonalAgree == "1") { if (chk_my_t == "1") { sh_t_info += "<li><a href=\"javascript:DeleteMyTheater('" + t_id + "')\" onclick=\"nclk(this, 'tbl.my', '', 1);\">MY극장 삭제</a></li>" } else { sh_t_info += "<li><a href=\"javascript:AddMyTheater('" + t_id + "')\" onclick=\"nclk(this, 'tbl.my', '', 1);\">MY극장 추가</a></li>" } } sh_t_info += "<li><a href=\"javascript:GetTheaterSchedule('" + t_id + "');\" onclick=\"nclk(this, 'tbl.layer', '', 1);\">극장시간표</a></li>"; sh_t_info += "<li><a href=\"javascript:viewTheaterMap('" + t_id + "');\" onclick=\"nclk(this, 'tbl.map', '', 1);\">극장정보</a></li>"; sh_t_info += "</ul>"; $("#sh_t_logo").html(sh_t_logo); $("#sh_t_nm").html(sh_t_nm); $("#sh_t_info").html(sh_t_info); aMakePlayTimeHTML.push("<div class=\"time \">") } if (cnt == 12) { aMakePlayTimeHTML.push("</ul></dd></dl>") } if (obj[i][8] != tmp_ts_nm) { if (cnt < 11) { aMakePlayTimeHTML.push("</ul></dd></dl>") } cnt = 0; ts_nm = obj[i][8]; ts_nm = ts_nm.replace("관", ""); sh_t_srn_cnt = parseInt(sh_t_srn_cnt) + 1; aMakePlayTimeHTML.push("<dl id=\"st_time_lst" + sh_t_srn_cnt + "\" class=\"num_time\"><dt>" + ts_nm + " 관</dt><dd><ul class=\"lst_schedule\">") } else { if (cnt == 12) { sh_t_srn_cnt = parseInt(sh_t_srn_cnt) + 1; aMakePlayTimeHTML.push("<dl id=\"st_time_lst" + sh_t_srn_cnt + "\" class=\"num_time\"><dt> </dt><dd><ul class=\"lst_schedule\">"); cnt = 0 } } cnt = cnt + 1; play_time = obj[i][11]; runtime = obj[i][12]; end_time = obj[i][13]; play_time = play_time.substring(0, 2) + ":" + play_time.substring(2, 4); play_time = GetPlayTimeText($("#NT_ID").val(), play_time); if (pt_id == obj[i][0]) { sh_t_focus_num = sh_t_srn_cnt; sh_t_focusListId = "st_time_lst" + sh_t_srn_cnt; sel_playTimeInfoObj = playTimeObj[i][0] + "@" + playTimeObj[i][4] + "@" + playTimeObj[i][5] + "@" + playTimeObj[i][7] + "@" + playTimeObj[i][8] + "@" + playTimeObj[i][11] + "@" + playTimeObj[i][14] + "@" + end_time; time_class = " class=\"on\""; active = play_time } else if (obj[i][15] != "1") { time_class = " class=\"end\""; active = play_time } else { time_class = " class=\"\""; active = "<a href=\"javascript:SelTime('" + obj[i][0] + "');\" onclick=\"nclk(this, 'tbl.time', '', 1);\">" + play_time + "</a>" } if (runtime == "0") { aMakePlayTimeHTML.push("<li id=\"" + obj[i][0] + "\" " + time_class + " onmouseout=\"javascript:EndTimeMouseOut(this, 'off');\">" + active + "</li>") } else { aMakePlayTimeHTML.push("<li id=\"" + obj[i][0] + "\" " + time_class + " onmouseover=\"javascript:EndTimeMouseOver(this, '" + end_time + "','" + (cnt - 1) + "');\" onmouseout=\"javascript:EndTimeMouseOut(this, 'off');\">" + active + "</li>") } tmp_ts_nm = playTimeObj[i][8] } aMakePlayTimeHTML.push("</div>"); $("#timelist").html(aMakePlayTimeHTML.join('')); $("#scrollcontentSH").css("height", $("#timelist").css("height")); if (scrboxSchedule == null) { scrboxSchedule = new jindo.ScrollBox("scrboxSchedule", { bAdjustThumbSize: true, sOverflowX: "auto", sOverflowY: "scroll" }); oScrollBarSchedule = new jindo.ScrollBar("scrboxSchedule", { htCustomEventHandler: { scroll: function (oCustomEvent) { } } }) } else { if (scrboxSchedule != null) { var scrollboxSH_h = $("#scrollcontentSH").css("height"); scrollboxSH_h = scrollboxSH_h.replace("px", ""); if (scrollboxSH_h == "auto") { scrollboxSH_h = Number.POSITIVE_INFINITY } scrboxSchedule.setSize(568, 91); scrboxSchedule.setContentSize(568, scrollboxSH_h); scrboxSchedule.reset(); if (sh_t_focus_num > 2) { oScrollBarSchedule.setScrollTop(document.getElementById(sh_t_focusListId).offsetTop) } else { oScrollBarSchedule.reset() } } } } else { $("#TS_ID").val(""); $("#PLAYTIME").val(""); GetTimeInit(); GetPriceInit() } } function GetPrice(pt_id, m_id, t_id, play_dt) { tot_cnt = 0; tot_price = 0; pay_price = 0; adu_quan = 0; stu_quan = 0; etc_quan = 0; $("#price_lst_area").attr("class", "use"); $.ajax({ type: "POST", url: "/AsyncRequest/GetPrice.aspx", data: "PT_ID=" + pt_id + "&M_ID=" + m_id + "&T_ID=" + t_id + "&PLAY_DT=" + play_dt, cache: false, success: GetPriceCallback, dataType: "text" }) } function GetPriceCallback(res) { var obj; if (res != null && res != "") { obj = JSON.parse(res); objPrice = obj; setTimeCnt = 0; MakePriceList(obj) } } function MakePriceList(obj) { var rtn = ""; var bp_nm = ""; var row_max = 0; var price = 0; var chk_tk_max_price = "0"; $("#select_people").attr("class", "delete"); $("#select_price").attr("class", "ticket"); for (var i = 0; i < obj.length; i++) { var tmpArray = obj[i].split("@"); bp_nm = tmpArray[0]; price = tmpArray[1]; if (parseInt(price) > 9000 && chk_tk_max_price == "0") { chk_tk_max_price = "1" } if (bp_nm.indexOf("청소년") != -1) { bp_nm = "학생" } else if (bp_nm.indexOf("성인") != -1) { bp_nm = "성인" } else if (bp_nm.indexOf("어린이") != -1) { bp_nm = "아동" } rtn += "<dl class=\"ticket\">"; if (i == 2) { $("#price_lst_area").attr("class", "use2") } rtn += "<dt>" + bp_nm + "<em>1매/" + price + "원</em></dt><dd><ul id=\"price_type" + i + "\">"; for (var j = 0; j < 9; j++) { rtn += "<li id=\"" + obj[i] + "@" + j + "\"><a href=\"javascript:SelPrice(" + i + ", " + j + ");\" onclick=\"nclk(this, 'peo.select', '', 1);\">" + j + "</a></li>" } rtn += " </ul></dd></dl>" } if (obj.length == 1) { bp_nm = "학생"; price = 0; rtn += "<dl class=\"ticket p_dim\">"; rtn += "<dt>" + bp_nm + "<em>1매/" + price + "원</em></dt><dd><ul>"; for (var j = 0; j < 9; j++) { rtn += "<li class=\"dimmed\">" + j + "</li>" } rtn += " </ul></dd></dl>" } $("#price_lst").html(rtn); if ($("#M_GRADE").val() == 18) { $("#ticket_grade_info").css("display", "block") } else { $("#ticket_grade_info").css("display", "none") } if (re_tk_kind != null && re_tk_kind != "") { if (re_tk_kind == "1" && chk_tk_max_price == "1" && TicketUseCancelYN == "0") { $("#t_ticket_tool").css("display", "block") } } SetRemainSelSeat() } function SetPayInfo() { var fee = fee_amt * (parseInt(tot_cnt)); $("#FEE_SUM").val(fee.toString()); pay_price = parseInt(tot_price) - parseInt(dis_price) + parseInt(fee); $("#PAY_PRICE").val(pay_price.toString()); $("#select_totalprice_txt").html("<strong>" + changePriceStr(pay_price) + "</strong> <em>(수수료 <span>" + changePriceStr(fee) + "</span>원 포함)</em>"); if (pay_price > 0) { $("#btn_Reserve1").css("visibility", "visible"); $("#btn_area2").css("display", "none") } else { $("#btn_Reserve1").css("visibility", "hidden"); $("#checkout_using").css("display", "none") } } var select_area_check = "0"; function moreArea() { if (select_area_check == "2") { $("#select_area2").css("display", "none"); $("#select_area").css("display", "none"); $("#tab_location li:eq(0) a").attr("class", ""); select_area_check = "0" } else if (select_area_check == "1" || $("#tab_location li:eq(0) a").attr("class") == "on") { $("#select_area2").css("display", "none"); $("#select_area").css("display", "none"); $("#tab_location li:eq(0) a").attr("class", ""); select_area_check = "0" } else { moreAreaView() } } function moreAreaView() { if (TListMode == 2) { $("#select_area").css("top", "120px") } else { $("#select_area").css("top", "80px"); $("#select_area2").css("top", "80px") } if (TListMode == "1") { $("#select_area2").css("display", "block") } else { $("#select_area").css("display", "block") } select_area_check = "1"; $("#tab_location li:eq(0) a").attr("class", "on") } function SelArea(area_cd, area_nm, mode) { areaMode = 0; if (area_nm == "") { area_nm = GetAreaNM(area_cd) } area_t_cnt = GetAreaCNT(area_cd); if (area_nm != "전국") { select_area = area_cd; select_area_all = "N" } else { select_area_all = "Y" } select_area_nm = area_nm; if (TParamSet == "N") { if (TListMode == 1) { GetTheater($("#M_ID").val(), $("#PLAY_DT").val(), "") } else if (TListMode == 3) { MakeTheaterList(objMyTheaterData) } else { MakeTheaterList(objTheaterData) } } $("#select_area_nm").html("<a href=\"javascript:moreArea();\" onclick=\"nclk(this, 'the.loc', '', 1);\" class=\"\">" + select_area_nm + "(<strong>" + area_t_cnt + "</strong>)</a>"); SelectAreaInit() } function GetAreaCNT(area_cd) { var area_t_cnt = ""; switch (area_cd) { case "all": area_t_cnt = area0_t_cnt; break; case "0": area_t_cnt = area1_t_cnt; break; case "1": area_t_cnt = area2_t_cnt; break; case "2": area_t_cnt = area3_t_cnt; break; case "3": area_t_cnt = area4_t_cnt; break; case "4": area_t_cnt = area5_t_cnt; break; case "5": area_t_cnt = area6_t_cnt; break } return area_t_cnt } function GetAreaNM(area_cd) { var area_nm = ""; switch (area_cd) { case "all": area_nm = "전국"; break; case "0": area_nm = "서울"; break; case "1": area_nm = "경기/인천"; break; case "2": area_nm = "부산/경남"; break; case "3": area_nm = "대구/울산/경북"; break; case "4": area_nm = "대전/충청/강원"; break; case "5": area_nm = "광주/전라/제주"; break } return area_nm } function GetAreaTheaterCnt() { area0_t_cnt = 0; area1_t_cnt = 0; area2_t_cnt = 0; area3_t_cnt = 0; area4_t_cnt = 0; area5_t_cnt = 0; area6_t_cnt = 0; var chkCntYN = "1"; if (objTheater == null) { for (var i = 0; i < objTheaterData.length; i++) { if (TListMode == "2") { if ($("#FILTER_NT_ID").val() == objTheaterData[i][8]) { chkCntYN = "1" } else { chkCntYN = "0" } } if (chkCntYN == "1") { switch (objTheaterData[i][10]) { case "0": area1_t_cnt = parseInt(area1_t_cnt) + 1; break; case "1": area2_t_cnt = parseInt(area2_t_cnt) + 1; break; case "2": area3_t_cnt = parseInt(area3_t_cnt) + 1; break; case "3": area4_t_cnt = parseInt(area4_t_cnt) + 1; break; case "4": area5_t_cnt = parseInt(area5_t_cnt) + 1; break; case "5": area6_t_cnt = parseInt(area6_t_cnt) + 1; break } } } area0_t_cnt = objTheaterData.length } else { for (var ii = 0; ii < objTheater.length; ii++) { if (TListMode == "2") { if ($("#FILTER_NT_ID").val() == objTheater[ii][1]) { chkCntYN = "1" } else { chkCntYN = "0" } } if (chkCntYN == "1") { switch (objTheater[ii][2]) { case "0": area1_t_cnt = parseInt(area1_t_cnt) + 1; break; case "1": area2_t_cnt = parseInt(area2_t_cnt) + 1; break; case "2": area3_t_cnt = parseInt(area3_t_cnt) + 1; break; case "3": area4_t_cnt = parseInt(area4_t_cnt) + 1; break; case "4": area5_t_cnt = parseInt(area5_t_cnt) + 1; break; case "5": area6_t_cnt = parseInt(area6_t_cnt) + 1; break } } } area0_t_cnt = objTheater.length } $("#area0_t_cnt").html(area0_t_cnt); $("#area1_t_cnt").html(area1_t_cnt); $("#area2_t_cnt").html(area2_t_cnt); $("#area3_t_cnt").html(area3_t_cnt); $("#area4_t_cnt").html(area4_t_cnt); $("#area5_t_cnt").html(area5_t_cnt); $("#area6_t_cnt").html(area6_t_cnt); $("#s1_area1_cnt").html(area1_t_cnt); $("#s1_area2_cnt").html(area2_t_cnt); $("#s1_area3_cnt").html(area3_t_cnt); $("#s1_area4_cnt").html(area4_t_cnt); $("#s1_area5_cnt").html(area5_t_cnt); $("#s1_area6_cnt").html(area6_t_cnt); $("#s2_area0_cnt").html(area0_t_cnt); $("#s2_area1_cnt").html(area1_t_cnt); $("#s2_area2_cnt").html(area2_t_cnt); $("#s2_area3_cnt").html(area3_t_cnt); $("#s2_area4_cnt").html(area4_t_cnt); $("#s2_area5_cnt").html(area5_t_cnt); $("#s2_area6_cnt").html(area6_t_cnt) } function GetTheaterInfo(t_id) { $.ajax({ type: "POST", url: "/AsyncRequest/GetTheater.aspx", data: "CMD=TINFO&T_ID=" + t_id, cache: false, success: GetTheaterInfoCallback, dataType: "text" }) } function GetTheaterInfoCallback(res) { var obj = JSON.parse(res); MakeTheaterInfo(obj) } function MakeTheaterInfo(obj) { var str = ""; var photo_url = ""; var gen_tel = ""; var t_id = ""; var nt_id = ""; if (obj.length > 0) { t_id = obj[0][0]; nt_id = obj[0][2]; tt_NT_ID = nt_id; photo_url = obj[0][8]; gen_tel = obj[0][5]; MakeTTPlayDate(t_id, tt_paly_dt); if (nt_id == "LOTTEC") { photo_url = "http://movie-img.yes24.com/NHN/img/th_lotte_logo.png" } else if (nt_id == "MEGABOX") { if (t_id == "T0443" || t_id == "T0442" || t_id == "T0522") { if (photo_url != "") { photo_url = "http://movie-img.yes24.com/NYes24/Resize.aspx?IMG=http://movie-img.yes24.com/NYes24/THEATER/" + photo_url + "?W179,H114" } else { photo_url = "http://movie-img.yes24.com/NHN/img/tmp_theaterImg.PNG" } } else { photo_url = "http://movie-img.yes24.com/NHN/img/th_Nmegabox_logo.png" } } else if (nt_id == "PRIMUS") { photo_url = "http://movie-img.yes24.com/NHN/img/th_primus_logo.png" } else if (nt_id == "CGV") { photo_url = "http://movie-img.yes24.com/NHN/img/th_cgv_logo.png" } else { photo_url = "http://movie-img.yes24.com/NYes24/Resize.aspx?IMG=http://movie-img.yes24.com/NYes24/THEATER/" + photo_url + "?W179,H114" } str += "<div class=\"theater_logo\"><img src=\"" + photo_url + "\" onclick=\"javascript:TheaterDetail('" + t_id + "');\" target=\"_blank\" width=\"179\" height=\"114\" alt=\"\" style=\"cursor:pointer;cursor:hand\" /></div>"; str += "<h3><a href=\"http://movie.naver.com/movie/api/yes24/theaterLink.nhn?T_CODE=" + t_id + "\" target=\"_blank\">" + obj[0][1] + "</a></h3>"; str += "<dl class=\"dec_info\">"; str += "<dt><span class=\"address\">주소</span></dt>"; str += "<dd>" + obj[0][3] + "</dd>"; str += "<dt><span class=\"url\">URL</span></dt>"; if (obj[0][4] != "") { str += "<dd><a href=\"" + obj[0][4] + "\" target=\"_blank\">" + obj[0][4] + "</a></dd>" } else { str += "<dd></dd>" } str += "<dt><span class=\"tel\">전화</span></dt>"; str += "<dd>" + gen_tel + "</dd>"; str += "<dt><span class=\"scale\">규모</span></dt>"; str += "<dd>" + obj[0][6] + "관, " + obj[0][7] + "석</dd>"; str += "</dl>"; str += "<div class=\"btn_area\">"; str += " <a href=\"http://movie.naver.com/movie/api/yes24/theaterLink.nhn?T_CODE=" + t_id + "\" title=\"극장정보\" target=\"_blank\" class=\"info\"><span class=\"blind\">극장정보</span></a>"; var chk_my_t = IsCheckMyTheater(t_id); if (IsPersonalAgree == "1") { if (chk_my_t != "1") { str += " <a href=\"javascript:AddMyTheater('" + t_id + "');\" title=\"MY극장 추가\" class=\"my_add\"><span class=\"blind\">MY극장 추가</span></a>" } } str += "</div>" } $("#tt_info").html(str) } function GetPlayDateForTime(t_id, m_id) { $.ajax({ type: "POST", url: "/AsyncRequest/GetPlayDate.aspx", data: "CMD=TT_PLAYDATE&M_ID=" + m_id + "&T_ID=" + t_id, cache: false, success: GetPlayDateForTimeCallback, dataType: "text" }) } function GetPlayDateForTimeCallback(res) { var obj = JSON.parse(res); tt_playDateObj = obj; MakePlayDateList(obj) } function MakePlayDateList(obj) { $("#tt_calendar").html(DrawCalendar(curYear, curMonth, obj, "1")) } function GetPlayTimeByArea(t_id, play_dt) { $.ajax({ type: "POST", url: "/AsyncRequest/GetPlayTime.aspx", data: "CMD=PLAYTIME_T_ID&T_ID=" + t_id + "&PLAY_DT=" + play_dt, cache: false, success: GetPlayTimeByAreaCallback, dataType: "text" }) } function GetPlayTimeByAreaCallback(res) { var obj = JSON.parse(res); tt_playtimeObj = obj; MakeTimeTableArea(obj, "") } function MakeTimeTableArea(obj, pt_id) { var rtn = ""; var active = ""; var time_class = ""; var cnt = 0; var ts_nm = ""; var play_time = ""; var end_time = ""; var m_grade = ""; var m_grade_str = ""; var tmp_m_id = ""; var tmp_ts_nm = ""; var aMakeTTPlayTimeHTML = []; if (obj.length > 0) { for (var i = 0; i < obj.length; i++) { if (obj[i][1] != tmp_m_id) { cnt = 0; if (i != 0) { aMakeTTPlayTimeHTML.push("</ul></dd></dl></div>") } m_grade = GetMovieGrade(obj[i][3]); m_grade_str = GetMovieGradeNM(obj[i][3]); aMakeTTPlayTimeHTML.push("<div class=\"lst_time2\">"); aMakeTTPlayTimeHTML.push("<h4><em class=\"" + m_grade + "\"><span>" + m_grade_str + "</span></em><strong onclick=\"javascript:MovieDetail('" + obj[i][1] + "');\" style=\"cursor:pointer;cursor:hand\">" + obj[i][2] + "</strong></h4>"); aMakeTTPlayTimeHTML.push("<dl>") } if (cnt == 10) { aMakeTTPlayTimeHTML.push("</ul></dd>") } if (obj[i][8] != tmp_ts_nm) { if (i != 0 && cnt < 10) { aMakeTTPlayTimeHTML.push("</ul></dd>") } cnt = 0; ts_nm = obj[i][8]; ts_nm = ts_nm.replace("관", ""); aMakeTTPlayTimeHTML.push(" <dt><em>" + ts_nm + "</em> 관</dt><dd><ul class=\"lst_schedule\">") } else { if (obj[i][1] != tmp_m_id) { cnt = 0; aMakeTTPlayTimeHTML.push("</ul></dd>"); ts_nm = obj[i][8]; ts_nm = ts_nm.replace("관", ""); aMakeTTPlayTimeHTML.push(" <dt><em>" + ts_nm + "</em> 관</dt><dd><ul class=\"lst_schedule\">") } else if (cnt == 10) { cnt = 0; aMakeTTPlayTimeHTML.push("</ul></dd>"); ts_nm = obj[i][8]; ts_nm = ts_nm.replace("관", ""); aMakeTTPlayTimeHTML.push(" <dt><em>" + ts_nm + "</em> 관</dt><dd><ul class=\"lst_schedule\">") } } cnt = cnt + 1; play_time = obj[i][11]; runtime = obj[i][12]; end_time = obj[i][13]; play_time = play_time.substring(0, 2) + ":" + play_time.substring(2, 4); play_time = GetPlayTimeText(tt_NT_ID, play_time); if (pt_id == obj[i][0]) { sel_tt_playTimeInfoObj = obj[i][0] + "@" + obj[i][4] + "@" + obj[i][5] + "@" + obj[i][7] + "@" + obj[i][8] + "@" + obj[i][11] + "@" + obj[i][14] + "@" + obj[i][9] + "@" + obj[i][1] + "@" + obj[i][2] + "@" + obj[i][3] + "@" + end_time + "@" + obj[i][16]; time_class = "on"; active = "" + play_time + "" } else if (obj[i][15] != "1") { time_class = "end"; active = "" + play_time + "" } else { time_class = ""; active = "<a href=\"javascript:TT_SelTimeChk('" + obj[i][0] + "');\">" + play_time + "</a>" } aMakeTTPlayTimeHTML.push("<li id=\"" + obj[i][0] + "\" class=\"" + time_class + "\" onmouseover=\"javascript:TT_EndTimeMouseOver(this, '" + end_time + "', '" + (cnt - 1) + "');\" onmouseout=\"javascript:TT_EndTimeMouseOut(this, 'off');\">"); aMakeTTPlayTimeHTML.push(active + "</li>"); tmp_m_id = obj[i][1]; tmp_ts_nm = obj[i][8] } aMakeTTPlayTimeHTML.push("</ul></dd></dl></div>") } else { aMakeTTPlayTimeHTML.push("<div class=\"lst_time2\"><p class=\"txt\"><strong>해당 날짜에 상영 스케줄이 없습니다.</strong><br>이전 또는 다음 날짜로 이동해 주세요.</p></div>") } $("#tt_timelist").html(aMakeTTPlayTimeHTML.join('')) } function GetPlayTimeText(nt_id, play_time) { var rtn = ""; var play_time_chk = ""; var play_time_hour = ""; if (play_time.substring(0, 1) == "0") { play_time_chk = play_time.substring(1, 2) } else { play_time_chk = play_time.substring(0, 2) } if (nt_id != "MMC" && parseInt(play_time_chk) >= 0 && parseInt(play_time_chk) < 4) { play_time_hour = parseInt(play_time_chk) + 24; play_time = play_time_hour + ":" + play_time.substring(3, 5) } rtn = play_time; return rtn } function GetPlayTimeText2(nt_id, play_time) { var rtn = ""; var play_time_chk = ""; var play_time_hour = ""; play_time_chk = play_time.substring(0, 2); if (nt_id == "MEGABOX" && play_time_chk.substring(0, 1) != "0") { if (parseInt(play_time_chk) > 23) { play_time_hour = parseInt(play_time_chk) - 24; if (parseInt(play_time_hour) > 9) { play_time = play_time_hour + play_time.substring(2, 4) } else { play_time = "0" + play_time_hour + play_time.substring(2, 4) } } } rtn = play_time; return rtn } function closeTTCalendar() { $("#tt_calendar").html(""); $("#tt_playdate").css("display", "none") } function gotoLoginChk(mode) { if (TListMode == 1 && select_area_all == "Y") { select_area = "all" } var url = RootUrl + "/Ticket/Reserve.aspx?m_id=" + $("#M_ID").val() + "&t_id=" + $("#T_ID").val() + "&playdate=" + $("#PLAY_DT").val() + "&playtime=" + $("#PLAYTIME").val() + "&ts_id=" + $("#TS_ID").val() + "&m_tab=" + MListMode + "&t_tab=" + TListMode + "&nt_id=" + $("#FILTER_NT_ID").val() + "&cnt=" + selPrice_ + "&select_area=" + select_t_area; if (urlType == "pcweb") { url = url + "&pcweb" } if (mode == "1") { if (confirm("로그인이 필요합니다. 로그인 하시겠습니까?")) { location.href = "https://nid.naver.com/nidlogin.login?mode=form&url=" + encodeURIComponent(url) } } else { location.href = "https://nid.naver.com/nidlogin.login?mode=form&url=" + encodeURIComponent(url) } } function TheaterDetail(t_id) { window.open("http://movie.naver.com/movie/api/yes24/theaterLink.nhn?T_CODE=" + t_id, "theaterinfo") } function MovieDetail(m_id) { window.open("http://movie.naver.com/movie/api/yes24/movieLink.nhn?M_CODE=" + m_id, "movieinfo") } function viewTheaterMap(t_id) { window.open(MovieRootUrl + "/movie/bi/ti/basic.nhn?cpgcode=" + t_id, "theaterInfo") } function closeTheaterMap() { $("#ly_map").css("display", "none") } function TheaterMapInfo() { window.open(RootUrl + "/Theater/Popup/Theater_Detail.aspx?T_ID=" + $("#T_ID").val() + "&ViewType=M", "cashInfo", "toolbars=no, scrollbars=yes, width=787, height=640") } function HideTheaterAC() { $("#TheaterSearchHintList").css("display", "none"); $("#TheaterSearchHintList").html(""); $("#txtTheater").attr("value", "") } function TxtTheaterKeyUp(event) { $("#PRE_T_ID").val(""); if (event.keyCode == 27) { HideTheaterAC(); return } if ($.trim($("#txtTheater").attr("value")) != "") { if (event.keyCode == 40) { SearchACUpDownTheater(true); return } if (event.keyCode == 38) { SearchACUpDownTheater(false); return } if (event.keyCode == 13) { SearchTheaterList(); SearchSelTheaterList($("#PRE_T_ID").attr("value")); return } SearchTheater($.trim($("#txtTheater").attr("value"))) } else { $("#TheaterSearchHintList").css("display", "none") } } function TheaterSearchBtnClick() { if ($.trim($("#txtTheater").attr("value")) != "") { SearchTheaterList(); SearchSelTheaterList($("#PRE_T_ID").attr("value")) } else { alert("극장명을 입력하세요."); $("#txtTheater").focus() } } function RegSC(str) { var searchWordTmp = str; var regSpecialChar = /\*|\\|\(|\)|\{|\}|\[|\]|\<|\+|\?|\>+/g; while ((regWord = regSpecialChar.exec(str)) != null) { searchWordTmp = searchWordTmp.replace(regWord, "") } str = searchWordTmp; return str } function SortByTHEATERRANK(x, y) { return x[11] - y[11] } function SearchTheater(searchWord) { var li_cnt = 0; var ul_str = ""; var li_str = ""; searchWord = searchWord.toUpperCase(); if (searchWord.indexOf("CGV") != -1) { ul_str = "<ul id=\"t_hint_lst\" class=\"keword\"><li class=\"cgv\"><em>CGV</em> 체인은 영화예매를<br>지원하지 않습니다.</li></ul>"; $("#TheaterSearchHintList").html(ul_str); $("#TheaterSearchHintList").css("display", "block") } else { searchWord = searchWord.replace("*", ""); searchWord = RegSC(searchWord); if (searchWord.length == 0) { $("#TheaterSearchHintList").css("display", "none"); return false } $("#TheaterSearchHintList").html(""); searchWord = searchWord.replace("-", ""); searchWord = searchWord.replaceAll(" ", ""); var tarObjElement = objTheaterData; tarObjElement = tarObjElement.sort(SortByTHEATERRANK); for (var j = 0; j < tarObjElement.length; j++) { var tlistWord = tarObjElement[j][1].replace("-", ""); tlistWord = tlistWord.replaceAll(" ", ""); var searchIndex = tlistWord.toUpperCase().search(searchWord); if (searchIndex >= 0) { var t_id = tarObjElement[j][0]; var t_nm = tarObjElement[j][1]; var tmp_t_nm = t_nm; if (t_nm.length > 14) { tmp_t_nm = t_nm.cut(24); if (tmp_t_nm == "") { tmp_t_nm = t_nm } } tmp_t_nm = tmp_t_nm.replace(searchWord, "<em>" + searchWord + "</em>"); if (li_cnt < 10) li_str += "<li id=\"" + t_id + "\" title=\"" + t_nm + "\" onmouseover=\"javascript:SearchTheaterLiMouseOver('on');\"><a href=\"javascript:SearchSelTheaterList('" + t_id + "');\">" + tmp_t_nm + "</a></li>"; li_cnt++; theaterSearchHintListCnt = li_cnt } } if (li_str.length > 0) { ul_str = "<ul id=\"t_hint_lst\" class=\"keword\">" + li_str + "</ul>"; $("#TheaterSearchHintList").html(ul_str); $("#TheaterSearchHintList").css("display", "block") } if ($("#TheaterSearchHintList ul").length == 0) { theaterSearchHintListCnt = 0; $("#TheaterSearchHintList").html("<ul class=\"keword\"><li>검색된 극장이 없습니다.</li></ul>"); $("#TheaterSearchHintList").css("display", "none") } } } function SearchTheaterList() { var rtn = ""; var searchWord_txt = $("#txtTheater").attr("value"); if (searchWord_txt.chkCharCodeAt() == "1") { if (searchWord_txt.length > 9) { searchWord_txt = searchWord_txt.cut(18) } } else { if (searchWord_txt.length > 12) { searchWord_txt = searchWord_txt.cut(12) } } $("#txtSearchTheater").html("" + searchWord_txt + ""); if (theaterSearchHintListCnt == 0) { var searchWord = $.trim($("#txtTheater").attr("value")).toLowerCase(); if (searchWord.indexOf("cgv") != -1) { rtn += "<p class=\"notice\">CGV 체인은 영화예매를 지원하지 않습니다.</p>" } else { rtn += "<p class=\"notice\"><strong>검색된 극장이 없습니다.</strong><br/>"; rtn += "<span class=\"ico\">극장명이 정확한지 확인해 주세요.</span><br/>"; rtn += "<span class=\"ico\">다른 극장으로 검색해 보세요.</span></p>" } $("#TheaterSearchResultList").html(rtn) } $("#SearchResult").css("display", "block"); $("#TheaterSearchResultList").css("display", "block") } function SearchACUpDownTheater(KeyDown) { var selectedIdx = -1; var Idx = -1; var obj; var i = 0; var bFind = false; if (theaterSearchHintListCnt > 0) { if (KeyDown) { for (i = 0; i < $("#TheaterSearchHintList li").length; i++) { if ($("#TheaterSearchHintList li:eq(" + i + ")").attr("class") == "on") { selectedIdx = i; bFind = true } } if (!bFind) Idx = 0; if (selectedIdx == ($("#TheaterSearchHintList li").length - 1)) Idx = $("#TheaterSearchHintList li").length - 1; else Idx = selectedIdx + 1 } else { for (i = 0; i < $("#TheaterSearchHintList li").length; i++) { if ($("#TheaterSearchHintList li:eq(" + i + ")").attr("class") == "on") { selectedIdx = i; bFind = true } } if (selectedIdx == 0) Idx = 0; else Idx = selectedIdx - 1 } if (KeyDown) { if (Idx > 0) $("#TheaterSearchHintList li:eq(" + (Idx - 1) + ")").attr("class", "") } else { $("#TheaterSearchHintList li:eq(" + (Idx + 1) + ")").attr("class", "") } obj = $("#t_hint_lst li:eq(" + Idx + ")"); obj.attr("class", "on"); $("#txtTheater").val($("#TheaterSearchHintList li:eq(" + Idx + ")").attr("title")); $("#PRE_T_ID").val($("#TheaterSearchHintList li:eq(" + Idx + ")").attr("Id")) } } function closeSearchReseult() { $("#txtSearchTheater").html(""); $("#TheaterSearchResultList").html(""); $("#SearchResult").css("display", "none"); $("#TheaterSearchResultList").css("display", "none") } var CalenderMode = "0"; function ViewPrevMonth(mode) { if (curMonth != dt.getMonth() + 1) { curMonth--; if (curMonth == 0) { curYear--; curMonth = 12 } CalenderMode = "1"; if (mode == "0") { $("#calendar").html(DrawCalendar(curYear, curMonth, playDateObj, mode)) } else { $("#tt_calendar").html(DrawCalendar(curYear, curMonth, tt_playDateObj, mode)) } } } function ViewNextMonth(mode) { curMonth++; if (curMonth == 13) { curYear++; curMonth = 1 } CalenderMode = "1"; if (mode == "0") { $("#calendar").html(DrawCalendar(curYear, curMonth, playDateObj, mode)) } else { $("#tt_calendar").html(DrawCalendar(curYear, curMonth, tt_playDateObj, mode)) } } function ViewToday() { curYear = dt.getFullYear(); curMonth = dt.getMonth() + 1; curDate = dt.getDate(); if (curMonth.length > 1) { if (curMonth.substring(0, 1) == "0") { curMonth = curMonth.substring(1, 2) } } if (curDate.length > 1) { if (curDate.substring(0, 1) == "0") { curDate = curDate.substring(1, 2) } } if (todayDate != playDateObj[0]) { $("#M_ID").val(""); $("#M_NM").val(""); $("#M_GRADE").val(""); $("#GRPM_ID").val(""); $("#M_POINT").val(""); $("#area_tlist li").attr("class", ""); $("#T_ID").val(""); $("#NT_ID").val(""); $("#T_NM").val(""); $("#select_place_txt").html("-"); $("#calendar").html(DrawCalendar(curYear, curMonth, playDateObj, "0")); SelPlayDate(todayDate, 0, 0); GetPlayDate($("#M_ID").val(), $("#T_ID").val()); $("#select_m_thumb").html("<span class=\"thumb_tail\"></span>"); $("#select_m_nm").html("영화를 선택하세요."); SetMovieGrade("none", "", ""); $("#select_price_txt").html("-"); $("#select_seat_txt").html("-"); if (chk_seat_yn == "0") { $("#select_seat_txt").html("해당 극장 자동 배정") } $("#select_totalprice_txt").html("<strong>0</strong>"); $("#section_info_result").attr("class", ""); SetTimeView("0"); HideTheaterAC(); closeTheaterInfo(); TheaterListFocusTop(); MovieListFocusTop() } else { $("#calendar").html(DrawCalendar(curYear, curMonth, playDateObj, "0")); SelPlayDate(todayDate, 0, 0) } } function SetMovieGrade(type, val1, val2) { if (type == "none") { $("#select_m_grade_dt").text("별점"); $("#select_m_grade").html("<div class=\"point\"><span style=\"width:0\"></span></div><em>0.00</em>"); $("#select_movie_grade").css("display", "block"); $("#select_m_grade_css").css("display", "block") } else if (type == "pointBefore") { $("#select_m_grade_dt").text(""); $("#select_m_grade").html(""); $("#select_movie_grade").css("display", "none"); $("#select_m_grade_css").css("display", "none") } else { $("#select_m_grade_dt").text("별점"); $("#select_m_grade").html("<div class=\"point on\"><span style=\"width:" + val1 + "%\"></span></div><em class=\"on\">" + val2 + "</em>"); $("#select_movie_grade").css("display", "block"); $("#select_m_grade_css").css("display", "block") } } function DrawCalendar(year, month, obj, mode) { if (mode == "0" && CalenderMode == "0") { if (NBParamSet == "N") { $("#btn_Reserve1").css("visibility", "hidden"); $("#checkout_using").css("display", "none") } } CalenderMode = "0"; var i = 0; var k = 1; var rowCnt = 0; var strTemp = ""; var aDays = [31, 0, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31]; var classVNm = ""; var classNm = ""; var classToday = ""; var eventStr = ""; var nCntPrevDay = 0; var nPrevMonth = 0; var nPrevYear = 0; var nNextMonth = 0; var nNextYear = 0; var nDate = 0; var sMonth = ""; var sDay = ""; var sDate = ""; var sCurDate = curYear + "-" + ((curMonth < 10) ? ("0" + curMonth) : curMonth) + "-" + (((curDate) < 10) ? ("0" + (curDate)) : (curDate)); var oDt = new Date(year, month - 1, 1); var nVDay = oDt.getDay(); aDays[1] = ((year % 4 == 0 && year % 100 != 0) || year % 400 == 0) ? 29 : 28; if (mode == "0") { $("#year_txt").html(year + "년") } strTemp += "<table border=\"1\" cellspacing=\"0\" summary=\"상영날짜를 선택해주세요\" class=\"tbl_calendar\">"; strTemp += "<thead><tr>"; strTemp += "<th scope=\"col\"><span class=\"blind\">일</span></th>"; strTemp += "<th scope=\"col\"><span class=\"blind\">월</span></th>"; strTemp += "<th scope=\"col\"><span class=\"blind\">화</span></th>"; strTemp += "<th scope=\"col\"><span class=\"blind\">수</span></th>"; strTemp += "<th scope=\"col\"><span class=\"blind\">목</span></th>"; strTemp += "<th scope=\"col\"><span class=\"blind\">금</span></th>"; strTemp += "<th scope=\"col\"><span class=\"blind\">토</span></th>"; strTemp += "</tr></thead>"; strTemp += "<tbody><tr>"; nCntPrevDay = nVDay % 7; nPrevMonth = month - 1; nPrevYear = year; if (nPrevMonth == 0) { nPrevMonth = 12; nPrevYear-- } for (i = 0; i < nCntPrevDay; i++) { nDate = (aDays[nPrevMonth - 1] - nVDay + i + 1); sMonth = ("" + nPrevMonth).length == 1 ? "0" + nPrevMonth : "" + nPrevMonth; sDay = ("" + nDate).length == 1 ? "0" + nDate : "" + nDate; sDate = nPrevYear + "-" + sMonth + "-" + sDay; if (obj != null) { if ($.inArray(sDate, obj) != -1) { if (mode == "0") { eventStr = "<a href=\"javascript:SelPlayDate('" + sDate + "'," + i + ", '0');\" onclick=\"nclk(this, 'dat.date', '', 1);\">" + nDate + "</a>" } else { eventStr = "<a href=\"javascript:TT_SelPlayDate('" + sDate + "'," + i + ");\">" + nDate + "</a>" } if ($("#PLAY_DT").val() == sDate) classNm = "enable on"; else classNm = "enable" } else { eventStr = nDate; classNm = "" } } strTemp += "<td class=\"" + classNm + "\">" + eventStr + "</td>" } for (i = 0; i < aDays[month - 1]; i++) { if (i != 0 && nVDay == 0) strTemp += "<tr>"; classVNm = ""; classToday = ""; if (nVDay == 0) { classVNm = "sun" } if (nVDay == 6) { classVNm = "sat" } nDate = i + 1; sMonth = ("" + month).length == 1 ? "0" + month : "" + month; sDay = ("" + nDate).length == 1 ? "0" + nDate : "" + nDate; sDate = year + "-" + sMonth + "-" + sDay; if (obj != null) { if ($.inArray(sDate, obj) != -1) { if ($("#PLAY_DT").val() == sDate) classNm = "enable on"; else classNm = "enable"; if (sCurDate == sDate && $("#PLAY_DT").val() == sDate) { classToday = "today on"; classNm = "enable" } else if (sCurDate == sDate && classNm == "enable") classToday = "today"; if (mode == "0") { eventStr = "<a href=\"javascript:SelPlayDate('" + sDate + "'," + nVDay + ", '0');\" onclick=\"nclk(this, 'dat.date', '', 1);\" class=\"" + classToday + "\">" + nDate + "</a>" } else { eventStr = "<a href=\"javascript:TT_SelPlayDate('" + sDate + "'," + nVDay + ");\" class=\"" + classToday + "\">" + nDate + "</a>" } } else { eventStr = nDate; classVNm = ""; classNm = "" } } strTemp += "<td class=\"" + classNm + " " + classVNm + "\">" + eventStr + "</td>"; nVDay++; if (nVDay == 7) { strTemp += "</tr>"; nVDay = 0; rowCnt++ } } nNextMonth = month + 1; nNextYear = year; if (nNextMonth == 13) { nNextMonth = 1; nNextYear++ } for (i = 0; i < 7 - rowCnt; i++) { for (var j = nVDay; j < 7; j++) { if (i > 0 && nVDay == 0) strTemp += "<tr>"; nDate = k; sMonth = ("" + nNextMonth).length == 1 ? "0" + nNextMonth : "" + nNextMonth; sDay = ("" + nDate).length == 1 ? "0" + nDate : "" + nDate; sDate = nNextYear + "-" + sMonth + "-" + sDay; if (obj != null) { if ($.inArray(sDate, obj) != -1) { if (mode == "0") { eventStr = "<a href=\"javascript:SelPlayDate('" + sDate + "'," + nVDay + ", '0');\" onclick=\"nclk(this, 'dat.date', '', 1);\">" + nDate + "</a>" } else { eventStr = "<a href=\"javascript:TT_SelPlayDate('" + sDate + "'," + nVDay + ");\">" + nDate + "</a>" } if ($("#PLAY_DT").val() == sDate) classNm = "enable on"; else classNm = "enable" } else { eventStr = nDate; classNm = "" } } strTemp += "<td class=\"" + classNm + "\">" + eventStr + "</td>"; nVDay++; if (nVDay == 7) { strTemp += "</tr>"; nVDay = 0; rowCnt++ } k++ } } strTemp += "</tbody></table>"; var strTemp2 = ""; if (mode == "0") { strTemp2 = "<div class=\"month_area\">"; if (month == dt.getMonth() + 1) { strTemp2 += "<span class=\"pre\"><span class=\"blind\">이전</span></span>" } else { strTemp2 += "<a href=\"javascript:ViewPrevMonth('0');\" onclick=\"nclk(this, 'dat.prev', '', 1);\" title=\"이전\" class=\"pre\"><span class=\"blind\">이전</span></a>" } strTemp2 += "<span class=\"m" + month + "\"><em class=\"blind\">" + month + "</em></span>"; strTemp2 += "<a href=\"javascript:ViewNextMonth('0');\" onclick=\"nclk(this, 'dat.next', '', 1);\" title=\"다음\" class=\"next\"><span class=\"blind\"> 다음</span></a>"; strTemp2 += "<a href=\"javascript:ViewToday();\" onclick=\"nclk(this, 'dat.today', '', 1);\" class=\"today\"><span class=\"blind\">오늘</span></a>"; strTemp2 += "</div>" } else { strTemp2 = "<div class=\"month_area\">"; strTemp2 + "<strong class=\"year\">" + year + "<span><span class=\"blind\">년</span></span></strong>"; if (month == dt.getMonth() + 1) { strTemp2 += "<span class=\"pre\"><span class=\"blind\">이전</span></span>" } else { strTemp2 += "<a href=\"javascript:ViewPrevMonth('1');\" title=\"이전\" class=\"pre\"><span class=\"blind\">이전</span></a>" } strTemp2 += "<span class=\"m" + month + "\"><em class=\"blind\">" + month + "월</em></span>"; strTemp2 += "<a href=\"javascript:ViewNextMonth('1');\" title=\"다음\" class=\"next\"><span class=\"blind\"> 다음</span></a>"; strTemp2 += "</div>" } return strTemp2 + strTemp } function NumberForm(n) { var reg = /(^[+-]?\d+)(\d{3})/; n += ''; while (reg.test(n)) n = n.replace(reg, '$1' + ',' + '$2'); return n } function GetWeekDay(dayOfWeek) { var wday = ""; switch (dayOfWeek) { case 0: wday = "일"; break; case 1: wday = "월"; break; case 2: wday = "화"; break; case 3: wday = "수"; break; case 4: wday = "목"; break; case 5: wday = "금"; break; case 6: wday = "토"; break } return wday } function GetDomainRoot() { var Domain; Domain = location.href; var arrTemp = Domain.split("//"); Domain = "http://" + arrTemp[1].substr(0, arrTemp[1].indexOf("/")); return Domain } var Request = function () { this.getParameter = function (name) { var rtnval = ''; var nowAddress = unescape(location.href); var parameters = (nowAddress.slice(nowAddress.indexOf('?') + 1, nowAddress.length)).split('&'); for (var i = 0; i < parameters.length; i++) { var varName = parameters[i].split('=')[0]; if (varName.toUpperCase() == name.toUpperCase()) { rtnval = parameters[i].split('=')[1]; break } } return rtnval } }; var request = new Request(); function formData2QueryString(docForm) { var strSubmitContent = ''; var formElem; var strLastElemName = ''; for (i = 0; i < docForm.elements.length; i++) { formElem = docForm.elements[i]; switch (formElem.type) { case 'text': case 'hidden': case 'password': case 'textarea': case 'select-one': strSubmitContent += formElem.id + '=' + escape(formElem.value) + '&'; break; case 'radio': if (formElem.checked) { strSubmitContent += formElem.id + '=' + escape(formElem.value) + '&' } break; case 'checkbox': if (formElem.checked) { if (formElem.id == strLastElemName) { if (strSubmitContent.lastIndexOf('&') == strSubmitContent.length - 1) { strSubmitContent = strSubmitContent.substr(0, strSubmitContent.length - 1) } strSubmitContent += ',' + escape(formElem.value) } else { strSubmitContent += formElem.id + '=' + escape(formElem.value) } strSubmitContent += '&'; strLastElemName = formElem.id } break } } strSubmitContent = strSubmitContent.substr(0, strSubmitContent.length - 1); return strSubmitContent } String.prototype.cut = function (len) { var str = this; var l = 0; for (var i = 0; i < str.length; i++) { l += (str.charCodeAt(i) > 128) ? 2 : 1; if (l > len) return str.substring(0, i) + ".." } return str }; String.prototype.chkCharCodeAt = function () { var str = this; var rtn = ""; for (var i = 0; i < str.length; i++) { if (str.charCodeAt(i) > 128) { rtn = "1"; break } } return rtn }; String.prototype.bytes = function () { var str = this; var i, tmp = escape(str); var bytes = 0; for (i = 0; i < tmp.length; i++) { if (tmp.charAt(i) == "%") { if (tmp.charAt(i + 1) == "u") { bytes += 2; i += 5 } else { bytes += 1; i += 2 } } else { bytes += 1 } } return bytes }; String.prototype.replaceAll = function (searchStr, replaceStr) { return this.split(searchStr).join(replaceStr) }; function openCopyUrl() { var copy_url = ""; copy_url = RootUrl + "/Ticket/Reserve.aspx?m_id=" + $("#M_ID").val() + "&t_id=" + $("#T_ID").val() + "&playdate=" + $("#PLAY_DT").val() + "&playtime=" + $("#PLAYTIME").val() + "&ts_id=" + $("#TS_ID").val() + "&m_tab=" + MListMode + "&t_tab=" + TListMode + "&nt_id=" + $("#FILTER_NT_ID").val() + "&cnt=" + selPrice_ + "&select_area=" + select_t_area + "&btype=re"; if (urlType == "pcweb") { copy_url = copy_url + "&pcweb" } $("#copy_url_txt").html("<a href=\"" + copy_url + "\">" + copy_url + "</a>"); $("#copy_reserve_url").css("display", "block") } function my_mouse_over(client) { var copy_url = ""; copy_url = RootUrl + "/Ticket/Reserve.aspx?m_id=" + $("#M_ID").val() + "&t_id=" + $("#T_ID").val() + "&playdate=" + $("#PLAY_DT").val() + "&playtime=" + $("#PLAYTIME").val() + "&ts_id=" + $("#TS_ID").val() + "&m_tab=" + MListMode + "&t_tab=" + TListMode + "&nt_id=" + $("#FILTER_NT_ID").val() + "&cnt=" + selPrice_ + "&select_area=" + select_t_area + "&btype=re"; clip.setText(copy_url); $("#d_clip_button").attr("class", "copy_on") } function my_mouse_out(client) { $("#d_clip_button").attr("class", "") } function closeCopyUrl() { $("#copy_reserve_url").css("display", "none") } function TicketInitReserve() { InitReserve(); $("#t_ticket_tool").css("display", "none") } var TicketUseCancelYN = "0"; function TicketUseCancel() { $("#t_ticket_tool").css("display", "none"); $("#tk_using").css("display", "none"); TicketUseCancelYN = "1" } function closeReserveLayer() { if (select_area_check == "1" && $("#tab_location li:eq(0) a").attr("class") == "on") { $("#select_area2").css("display", "none"); $("#select_area").css("display", "none"); $("#tab_location li:eq(0) a").attr("class", ""); select_area_check = "2" } else { $("#select_area2").css("display", "none"); $("#select_area").css("display", "none"); $("#tab_location li:eq(0) a").attr("class", ""); select_area_check = "0" } } function changePriceStr(mny) { var rtn = "0"; var str_mny = mny + ""; if (str_mny.length > 3) { rtn = ""; var rowcnt = 1; for (var i = str_mny.length - 1; i >= 0; i--) { if (rowcnt % 4 == 0) { rtn = str_mny.substring(i, i + 1) + "," + rtn } else { rtn = str_mny.substring(i, i + 1) + rtn } rowcnt = rowcnt + 1 } } else { rtn = mny } return rtn }