var DetailBusinessPartnerAnswer=$Class({_oOption:null,_oElement:null,_wEvent:null,_wTemplate:null,_bIsLandscapeMode:null,
_aBusinessPartnerArea:null,_BUSINESS_PARTNER_INFO_AJAX_URL:"/mobile/ajax/getBusinessPartnerInfoAjax.nhn",
$init:function(htOption){this._oOption=htOption||{};this.setElement();this._initialize();document.addEventListener("initializeBusinessPartnerArea",
$Fn(this._initialize,this).bind(),false)},
setElement:function(){this._oElement={};this._oElement["endContentsArea"]=$$.getSingle("#section_group1 div._contentsArea");
this._wTemplate={};this._wTemplate["businessPartnerInfoTpl"]=$Template("businessPartnerInfoTpl")},
_initialize:function(){this._oElement["businessPartnerArea"]=$$("div._businessPartnerArea");if(!this._oElement["businessPartnerArea"]||
this._oElement["businessPartnerArea"].length<1){this._aBusinessPartnerArea=null;this._detachScrollAndResizeEvent();
return}this._setBusinessPartnerAreaInfo();this._attachResizeEvent();this._onResizeWindow(true)},
_attachResizeEvent:function(){if(!this._wEvent)this._wEvent={};if(nhn.Kin.OS.ios||nhn.Kin.OS.android){var sResizeEventType=
"onorientationchange"in window?"orientationchange":"resize";if(!this._wEvent[sResizeEventType])this._wEvent[sResizeEventType]=
$Fn(this._onResizeWindow,this).attach(window,sResizeEventType)}else if(!this._wEvent["resize"])this._wEvent["resize"]=
$Fn(this._onResizeWindow,this).attach(window,"resize");if(!this._wEvent["pageshow"])this._wEvent["pageshow"]=
$Fn(this._onResizeWindow,this).attach(window,"pageshow")},
_setBusinessPartnerAreaInfo:function(){var aBusinessPartnerArea=[];for(var i=0,len=this._oElement["businessPartnerArea"].length;i<
len;i++){var wCurrentElement=$Element(this._oElement["businessPartnerArea"][i]);var wParentAnswerElement=
wCurrentElement.parent(function(v){return v.hasClass("_answer")},2);
var oBusinessPartnerAreaInfo={wElement:wCurrentElement,oAnswerElement:wParentAnswerElement&&wParentAnswerElement.length>
0?wParentAnswerElement[0]._element:null,oAjax:null,bIsInitialized:false};aBusinessPartnerArea.push(oBusinessPartnerAreaInfo)}this._aBusinessPartnerArea=
aBusinessPartnerArea},
_onResizeWindow:function(bIsInitialize){var bIsLandscapeMode=nhn.Kin.getScreenType()==="TABLET_LANDSCAPE";
if(!bIsInitialize&&this._bIsLandscapeMode===bIsLandscapeMode)return;this._bIsLandscapeMode=bIsLandscapeMode;
if(bIsLandscapeMode){if(this._wEvent["scroll"]){this._wEvent["scroll"].detach(window,"scroll");this._wEvent["scroll"]=
null}if(!this._wEvent["contentsScroll"])this._wEvent["contentsScroll"]=$Fn(this._onScroll,this).attach(this._oElement["endContentsArea"],
"scroll")}else{if(this._wEvent["contentsScroll"]){this._wEvent["contentsScroll"].detach(this._oElement["endContentsArea"],
"scroll");this._wEvent["contentsScroll"]=null}if(!this._wEvent["scroll"])this._wEvent["scroll"]=$Fn(this._onScroll,
this).attach(window,"scroll")}if(bIsInitialize)this._onScroll()},
_onScroll:function(we){if(!this._aBusinessPartnerArea)return;var oScrollTargetElement=this._bIsLandscapeMode?
this._oElement["endContentsArea"]:null;for(var i=0,len=this._aBusinessPartnerArea.length;i<len;i++){if(this._aBusinessPartnerArea[i].bIsInitialized===
true)continue;if(nhn.Kin.isIntoScreen(this._aBusinessPartnerArea[i].oAnswerElement,oScrollTargetElement))this._loadBusinessPartnerInfo(this._aBusinessPartnerArea[i])}},
_loadBusinessPartnerInfo:function(oElAnswer){if(!oElAnswer||!oElAnswer.wElement||(oElAnswer.wElement.html()||
"").length>0)return;if(oElAnswer.oAjax&&!oElAnswer.oAjax.isIdle())return;var nAnswerNo=parseInt(oElAnswer.wElement.attr("data-answer-no"),
10);if(!nAnswerNo&&nAnswerNo!==0){oElAnswer.bIsInitialized=true;oElAnswer.wElement.leave();return}var sUserKey=
oElAnswer.wElement.attr("data-u");if(!sUserKey){oElAnswer.bIsInitialized=true;oElAnswer.wElement.leave();
return}var oAjaxParams={"dirId":this._oOption.dirId||0,"docId":this._oOption.docId||0,"answerNo":nAnswerNo,
"u":sUserKey};var oAjaxOptions={method:"get",timeout:3,onload:$Fn(this._succeedInLoadBusinessPartnerInfoAjax,
this).bind(oElAnswer),ontimeout:$Fn(this._failedInLoadBusinessPartnerInfoAjax,this).bind(oElAnswer),onerror:$Fn(this._failedInLoadBusinessPartnerInfoAjax,
this).bind(oElAnswer)};oElAnswer.oAjax=new $Ajax(this._BUSINESS_PARTNER_INFO_AJAX_URL,oAjaxOptions);oElAnswer.oAjax.request(oAjaxParams)},
_succeedInLoadBusinessPartnerInfoAjax:function(oElAnswer,oResponse){oElAnswer.bIsInitialized=true;var oResponseJson=
oResponse?oResponse.json():null;if(!oResponseJson||!oResponseJson.isSuccess||!oResponseJson.businessPartnerInfo)return;
oElAnswer.wElement.replace(this._wTemplate["businessPartnerInfoTpl"].process(this._getProcessedBusinessPartnerInfo(oResponseJson.businessPartnerInfo)))},
_getProcessedBusinessPartnerInfo:function(oBusinessPartnerInfo){if(!oBusinessPartnerInfo)return null;
var sDirectoryPath=oBusinessPartnerInfo.directoryPath;if(sDirectoryPath){var nLastIndexOfBracket=sDirectoryPath.lastIndexOf("\x3e");
if(nLastIndexOfBracket>=0&&nLastIndexOfBracket<sDirectoryPath.length-1)oBusinessPartnerInfo["directoryName"]=
sDirectoryPath.slice(nLastIndexOfBracket+1);else oBusinessPartnerInfo["directoryName"]=sDirectoryPath}var sImageUrl=
oBusinessPartnerInfo.imageUrl;if(sImageUrl){var nIndexOfQuestionMark=sImageUrl.indexOf("?");if(nIndexOfQuestionMark>
0)sImageUrl=sImageUrl.slice(0,nIndexOfQuestionMark);oBusinessPartnerInfo["imageUrl"]=sImageUrl+"?type\x3dm500_500"}var sMapUrl=
oBusinessPartnerInfo.mapUrl;if(sMapUrl)oBusinessPartnerInfo["mapUrl"]=sMapUrl.replace(/^http:\/\/map\.naver\.com\/(?:.*?)?(.*?)$/i,
"https://m.map.naver.com/map.nhn?$1");return oBusinessPartnerInfo},
_failedInLoadBusinessPartnerInfoAjax:function(oElAnswer){if(!oElAnswer)return;if(!oElAnswer.oAjax.isIdle())oElAnswer.oAjax.abort();
oElAnswer.bIsInitialized=true;oElAnswer.wElement.leave()},
_detachScrollAndResizeEvent:function(){if(!this._wEvent)return;if(this._wEvent["onorientationchange"]){this._wEvent["onorientationchange"].detach(window,
"resize");this._wEvent["onorientationchange"]=null}if(this._wEvent["resize"]){this._wEvent["resize"].detach(window,
"resize");this._wEvent["resize"]=null}if(this._wEvent["pageshow"]){this._wEvent["pageshow"].detach(window,
"pageshow");this._wEvent["pageshow"]=null}if(this._wEvent["scroll"]){this._wEvent["scroll"].detach(window,
"scroll");this._wEvent["scroll"]=null}if(this._wEvent["contentsScroll"]){this._wEvent["contentsScroll"].detach(this._oElement["endContentsArea"],
"scroll");this._wEvent["contentsScroll"]=null}},
destroy:function(){this._detachScrollAndResizeEvent();document.removeEventListener("initializeBusinessPartnerArea",
$Fn(this._initialize,this).bind(),false);this._oOption=this._oElement=this._wEvent=this._wTemplate=null;
this._bIsLandscapeMode=this._aBusinessPartnerArea=this._BUSINESS_PARTNER_INFO_AJAX_URL=null}});