var MetooWonder=$Class({_oElement:null,_wElement:null,_wTemplate:null,_wEvent:null,_bIsDetail:false,_bIsSupportSessionStorage:false,
_bIsMetooWonderProcessing:false,_METOO_WONDER_STATE:{DISABLED:0,ALREADY:1,ENABLED:2},_METOO_WONDER_AJAX_URL:"/mobile/ajax/metooWonderAjax.nhn",
_MESSAGE:{NEED_TO_LOGIN:"\ub85c\uadf8\uc778 \ud6c4 \uc774\uc6a9\ud574\uc8fc\uc2dc\uae30 \ubc14\ub78d\ub2c8\ub2e4.",
CANCEL_METOO_WONDER:"\uc774 \uc9c8\ubb38\uc5d0 \ub300\ud55c \uc18c\uc2dd\uc744 \ubc1b\uc9c0 \uc54a\uc2b5\ub2c8\ub2e4.",
DISABLED_METOO_WONDER:"\ub098\ub3c4 \uad81\uae08\ud574\uc694\uac00 \uac00\ub2a5\ud55c \uc9c8\ubb38\uc774 \uc544\ub2d9\ub2c8\ub2e4.\n\uc9c8\ubb38\uc744 \ud655\uc778\ud574\uc8fc\uc138\uc694."},
$init:function(htOption){if(htOption&&typeof htOption.isDetail!=="undefined")this._bIsDetail=htOption.isDetail;
this._bIsSupportSessionStorage=nhn.Kin.SessionStorage.isSupportSessionStorage();this._setElement();this._setEvent()},
_setElement:function(){this._oElement={};this._wElement={};this._wTemplate={};this._oElement["metooWonderBtn"]=
$$("._metoo_wonder_btn");this._oElement["metooWonderLayerArea"]=$("metoo_wonder_layer_area");if(this._oElement["metooWonderLayerArea"])this._wElement["metooWonderLayerArea"]=
$Element(this._oElement["metooWonderLayerArea"]);this._wTemplate["metooWonderLayerTpl"]=$Template("metoo_wonder_layer_tpl")},
_setEvent:function(){this._wEvent={};this._wEvent["clickMetooWonderBtn"]=[];this._attachClickMetooWonderEvent(this._oElement["metooWonderBtn"]);
if(this._oElement["metooWonderLayerArea"])this._wEvent["clickMetooWonderLayer"]=$Fn(this._onClickMetooWonderLayer,
this).attach(this._oElement["metooWonderLayerArea"],"click");document.addEventListener("addMetooWonderBtn",
$Fn(this._addMetooWonderBtnCallback,this).bind(),false)},
_addMetooWonderBtnCallback:function(oCustomEvent){this._attachClickMetooWonderEvent(oCustomEvent.addedMetooWonderBtnList)},
_attachClickMetooWonderEvent:function(aElAddedMetooWonderBtnList){if(aElAddedMetooWonderBtnList&&aElAddedMetooWonderBtnList.length>
0)for(var i in aElAddedMetooWonderBtnList){var elAddedMetooWonderBtn=aElAddedMetooWonderBtnList[i];if(elAddedMetooWonderBtn)this._wEvent["clickMetooWonderBtn"][this._wEvent["clickMetooWonderBtn"].length]=
$Fn(this._onClickMetooWonderBtn,this).attach(elAddedMetooWonderBtn,"click")}},
_onClickMetooWonderBtn:function(we){if(this._bIsMetooWonderProcessing){we.stop();return}if(nhn.Kin.checkRos()){we.stop();
return}if(!nhn.isLogin){alert(this._MESSAGE.NEED_TO_LOGIN);we.stop();return}var el=we.element;if(!el){we.stop();
return}var wel=$Element(el);var nDirId=wel.attr("data-dirId");var nDocId=wel.attr("data-docId");if(nDirId>
0&&nDocId>0)if(this._bIsDetail){var nMetooWonderState=this._getMetooWonderState(wel);if(nMetooWonderState===
this._METOO_WONDER_STATE.ALREADY){if(confirm(this._MESSAGE.CANCEL_METOO_WONDER))this._cancelMetooWonder(nDirId,
nDocId,wel)}else if(nMetooWonderState===this._METOO_WONDER_STATE.ENABLED)this._registerMetooWonder(nDirId,
nDocId,wel)}else this._checkAndUpdateMetooWonder(nDirId,nDocId,wel);we.stop()},
_checkAndUpdateMetooWonder:function(nDirId,nDocId,welMetooWonderBtn){this._bIsMetooWonderProcessing=true;
var oParam={m:"checkAndUpdateMetooWonder",dirId:nDirId,docId:nDocId,inputDevice:"MOBILE_WEB",ts:(new Date).getTime()};
var oOption={method:"post",timeout:5,onload:$Fn(this._onCheckAndUpdateMetooWonder,this).bind(welMetooWonderBtn),
ontimeout:$Fn(function(welMetooWonderBtn){alert(nhn.Kin.oMessage.TIMEOUT);this._bIsMetooWonderProcessing=
false},this).bind(welMetooWonderBtn),
onerror:$Fn(function(welMetooWonderBtn){alert(nhn.Kin.oMessage.ERROR);this._bIsMetooWonderProcessing=
false},this).bind(welMetooWonderBtn)};
var oAjax=new $Ajax(this._METOO_WONDER_AJAX_URL,oOption);oAjax.request(oParam)},
_onCheckAndUpdateMetooWonder:function(welMetooWonderBtn,oResponse){var oJson=oResponse.json();if(oJson&&
oJson.isSuccess&&oJson.result&&oJson.result[0]){var bIsEnableMetooWonder=oJson.result[0].isEnableMetooWonder||
false;var bIsMetooWonderUser=oJson.result[0].isMetooWonderUser||false;if(bIsEnableMetooWonder)if(bIsMetooWonderUser)this._onCancelMetooWonder(welMetooWonderBtn,
oResponse);else this._onRegisterMetooWonder(welMetooWonderBtn,oResponse);else{alert(this._MESSAGE.DISABLED_METOO_WONDER);
this._bIsMetooWonderProcessing=false}}else{alert(oJson.errorMsg||nhn.Kin.oMessage.ERROR);this._bIsMetooWonderProcessing=
false}},
_registerMetooWonder:function(nDirId,nDocId,welMetooWonderBtn){this._bIsMetooWonderProcessing=true;var oParam=
{m:"registerMetooWonder",dirId:nDirId,docId:nDocId,inputDevice:"MOBILE_WEB",ts:(new Date).getTime()};
var oOption={method:"post",timeout:5,onload:$Fn(this._onRegisterMetooWonder,this).bind(welMetooWonderBtn),
ontimeout:$Fn(function(welMetooWonderBtn){alert(nhn.Kin.oMessage.TIMEOUT);this._bIsMetooWonderProcessing=
false},this).bind(welMetooWonderBtn),
onerror:$Fn(function(welMetooWonderBtn){alert(nhn.Kin.oMessage.ERROR);this._bIsMetooWonderProcessing=
false},this).bind(welMetooWonderBtn)};
var oAjax=new $Ajax(this._METOO_WONDER_AJAX_URL,oOption);oAjax.request(oParam)},
_onRegisterMetooWonder:function(welMetooWonderBtn,oResponse){var oJson=oResponse.json();if(oJson&&oJson.isSuccess&&
oJson.result&&oJson.result[0]){if(welMetooWonderBtn){if(!welMetooWonderBtn.hasClass("me"))welMetooWonderBtn.addClass("me");
var welMetooWonderCount=$Element($$.getSingle("._metoo_wonder_count",welMetooWonderBtn.$value()));if(welMetooWonderCount){var nMetooWonderCount=
oJson.result[0].metooWonderCount||0;if(nMetooWonderCount>0)welMetooWonderCount.html(nMetooWonderCount<
100?nMetooWonderCount:"99+");else welMetooWonderCount.html(this._bIsDetail?"":"0")}}this._showMetooWonderLayer()}else alert(oJson.errorMsg||
nhn.Kin.oMessage.ERROR);this._bIsMetooWonderProcessing=false},
_cancelMetooWonder:function(nDirId,nDocId,welMetooWonderBtn){this._bIsMetooWonderProcessing=true;var oParam=
{m:"cancelMetooWonder",dirId:nDirId,docId:nDocId,inputDevice:"MOBILE_WEB",ts:(new Date).getTime()};var oOption=
{method:"post",timeout:5,onload:$Fn(this._onCancelMetooWonder,this).bind(welMetooWonderBtn),ontimeout:$Fn(function(){alert(nhn.Kin.oMessage.TIMEOUT);
this._bIsMetooWonderProcessing=false},this).bind(),
onerror:$Fn(function(){alert(nhn.Kin.oMessage.ERROR);this._bIsMetooWonderProcessing=false},this).bind()};
var oAjax=new $Ajax(this._METOO_WONDER_AJAX_URL,oOption);oAjax.request(oParam)},
_onCancelMetooWonder:function(welMetooWonderBtn,oResponse){var oJson=oResponse.json();if(oJson&&oJson.isSuccess&&
oJson.result&&oJson.result[0]){if(welMetooWonderBtn){if(welMetooWonderBtn.hasClass("me"))welMetooWonderBtn.removeClass("me");
var welMetooWonderCount=$Element($$.getSingle("._metoo_wonder_count",welMetooWonderBtn.$value()));if(welMetooWonderCount){var nMetooWonderCount=
oJson.result[0].metooWonderCount||0;if(nMetooWonderCount>0)welMetooWonderCount.html(nMetooWonderCount<
100?nMetooWonderCount:"99+");else welMetooWonderCount.html(this._bIsDetail?"":"0")}}}else alert(oJson.errorMsg||
nhn.Kin.oMessage.ERROR);this._bIsMetooWonderProcessing=false},
_getMetooWonderState:function(welMetooWonderBtn){if(welMetooWonderBtn.hasClass("disb"))return this._METOO_WONDER_STATE.DISABLED;
else if(welMetooWonderBtn.hasClass("me"))return this._METOO_WONDER_STATE.ALREADY;else return this._METOO_WONDER_STATE.ENABLED},
_onClickMetooWonderLayer:function(we){var el=we.element;if(!el||!/(?:a|button)/i.test(el.tagName.toLowerCase())){we.stop();
return}if($Element(el).hasClass("_close"))this._hideMetooWonderLayer()},
_showMetooWonderLayer:function(){if(this._bIsDetail)return;if(this._bIsSupportSessionStorage){var sMetooWonderDisplayFlag=
nhn.Kin.SessionStorage.getItem(nhn.Kin.SessionStorage.KEY.MOBILEWEB_METOO_WONDER_LAYER_DISPLAY_FLAG);
if(sMetooWonderDisplayFlag=="N")return}if(this._wElement["metooWonderLayerArea"]&&this._wTemplate["metooWonderLayerTpl"]){this._wElement["metooWonderLayerArea"].html(this._wTemplate["metooWonderLayerTpl"].process());
if(!this._wElement["metooWonderLayerArea"].visible())this._wElement["metooWonderLayerArea"].show();this._adjustPositionOfMetooWonderLayer()}},
_hideMetooWonderLayer:function(){if(this._wElement["metooWonderLayerArea"]){this._wElement["metooWonderLayerArea"].html("");
if(this._wElement["metooWonderLayerArea"].visible())this._wElement["metooWonderLayerArea"].hide();if(this._bIsSupportSessionStorage)nhn.Kin.SessionStorage.setItem(nhn.Kin.SessionStorage.KEY.MOBILEWEB_METOO_WONDER_LAYER_DISPLAY_FLAG,
"N")}},
_adjustPositionOfMetooWonderLayer:function(){var welMetooWonderLayer=$Element("metoo_wonder_layer");if(welMetooWonderLayer){var nLayerTop=
($Document(document).clientSize().height-welMetooWonderLayer.height())/2;welMetooWonderLayer.css({"top":nLayerTop,
"position":"fixed"})}}});