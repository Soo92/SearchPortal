nhn=window.nhn||{},nhn.mobile=nhn.mobile||{},nhn.mobile.common=nhn.mobile.common||{},nhn.mobile.common.likeIt=nhn.mobile.common.likeIt||{},nhn.mobile.common.likeIt.Controller=jindo.$Class({_UIO_CLASSNAME:"_uio_likeButton",_TOAST_MESSAGE:{errorLikeIt:"잠시 후에 다시 시도해주세요."},$init:function(t){this._initVars(),this._initComponents(t),this._attachEventToComponent(),this._attachEvent(),this.update()},_initVars:function(){this._bLinkedWithLine=!1;var t=jindo.$Cookie();this._bLogin=!!t.get("NID_SES")},_initComponents:function(t){var e=nhn.mobile.common.likeIt;this._oLikeButton=new e.LikeButton(t),this._oLineFriendListLayer=new e.LineFriendListLayer(t),this._oToastLayer=new e.ToastLayer},_attachEventToComponent:function(){this._oLikeButton.attach({completeUpdate:jindo.$Fn(function(t){this._bLinkedWithLine=t.bLinkedWithLine},this).bind(),successLikeIt:jindo.$Fn(function(t){this._oLineFriendListLayer.hide(t.welBase)},this).bind(),successCancelLikeIt:jindo.$Fn(function(t){this._oLineFriendListLayer.hide(t.welBase)},this).bind(),errorLikeIt:jindo.$Fn(function(){this._oToastLayer.show(this._TOAST_MESSAGE.errorLikeIt)},this).bind(),errorCancelLikeIt:jindo.$Fn(function(){this._oToastLayer.show(this._TOAST_MESSAGE.errorLikeIt)},this).bind()}),this._oLineFriendListLayer.attach({openRegistry:jindo.$Fn(function(t){this._fireCRLog(t.welBase,"likefriend")},this).bind(),openProfile:jindo.$Fn(function(t){this._fireCRLog(t.welBase,"linethumb")},this).bind()})},_fireCRLog:function(t,e){var i=t.attr("data-log"),n=window[i]||i;!!n&&window.tCR("a="+n+"."+e)},_attachEvent:function(){jindo.$Element(document).delegate("click","."+this._UIO_CLASSNAME,jindo.$Fn(function(t){var e=jindo.$Element(t.delegatedElement),i=jindo.$Element(t.srcElement),n=this._oLikeButton.getLikeButton(e),o=e.query("._line"),s=i.isEqual(n)||i.isChildOf(n),a=i.isEqual(o)||i.isChildOf(o);t.stopDefault(),this._bLogin?s?this._oLikeButton.isAlreadyLikeIt(e)?this._oLikeButton.decrease(e):this._oLikeButton.increase(e):a&&(this._oLineFriendListLayer.visible(e)?(this._oLineFriendListLayer.hide(e),this._fireCRLog(e,"likefclose")):(this._oLineFriendListLayer.show(e,this._bLinkedWithLine),this._fireCRLog(e,"likefopen"))):(s||a)&&window.confirm("로그인이 필요한 서비스 입니다.\n로그인 하시겠습니까?")&&(window.location.href="https://nid.naver.com/nidlogin.login?svctype=262144")},this).bind())},update:function(t,e){this._oLikeButton.update(t,e)}}),nhn.mobile.common.likeIt.LikeButton=jindo.$Class({_UIO_CLASSNAME:"_uio_likeButton",$init:function(t){var e={sAPIDomain:"https://search.like.naver.com",sAPIGetLikeIt:"/likeIt/v1/likeItServiceContentList.jsonp",sAPIAddLikeIt:"/likeIt/v1/doLikeIt.jsonp",sAPICancelLikeIt:"/likeIt/v1/cancelLikeIt.jsonp",nMaxCount:99999};this.option(e),this.option(t||{}),this._sTimestamp="",this._sLikeItToken=""},_likeIt:function(t,e){var i=t.attr("data-domain")||this.option("sAPIDomain"),n=t.attr("data-sid")||"",o=t.attr("data-cid")||"",s=t.attr("data-did")||n,a=t.attr("data-catgid")||"",r={welBase:t,welLikeButton:e,sServiceId:n,sContentId:o};jindo.$Ajax(i+this.option("sAPIAddLikeIt"),{type:"jsonp",timeout:5,ontimeout:jindo.$Fn(function(){this.fireEvent("errorLikeIt",r)},this).bind(),onerror:jindo.$Fn(function(){this.fireEvent("errorLikeIt",r)},this).bind(),onload:jindo.$Fn(function(t){var e=t.json();e&&e.success&&e.result&&0===e.result.resultStatusCode?(jindo.$A(jindo.$Element(document).queryAll("."+this._UIO_CLASSNAME)).filter(function(t){return t.attr("data-sid")===n&&t.attr("data-cid")===o},this).forEach(function(t){this._paintIconBGColor(t),this._updateCount(t,e.result.likeItCount)},this),this.fireEvent("successLikeIt",r)):1007===e.result.resultStatusCode||1008===e.result.resultStatusCode||1009===e.result.resultStatusCode||1010===e.result.resultStatusCode?alert(e.result.resultMessage):this.fireEvent("errorLikeIt",r)},this).bind()}).request({serviceId:n,contentsId:o,displayId:s,categoryId:a,timeLineShare:"N",timestamp:this._sTimestamp,likeItToken:this._sLikeItToken})},_cancelLikeIt:function(t,e){var i=t.attr("data-domain")||this.option("sAPIDomain"),n=t.attr("data-sid")||"",o=t.attr("data-cid")||"",s=t.attr("data-did")||n,a=t.attr("data-catgid")||"",r={welBase:t,welLikeButton:e,sServiceId:n,sContentId:o};jindo.$Ajax(i+this.option("sAPICancelLikeIt"),{type:"jsonp",timeout:5,ontimeout:function(){this.fireEvent("errorCancelLikeIt",r)},onerror:jindo.$Fn(function(){this.fireEvent("errorCancelLikeIt",r)},this).bind(),onload:jindo.$Fn(function(t){var e=t.json();e&&e.success&&e.result&&2003===e.result.resultStatusCode?(jindo.$A(jindo.$Element(document).queryAll("."+this._UIO_CLASSNAME)).filter(function(t){return t.attr("data-sid")===n&&t.attr("data-cid")===o},this).forEach(function(t){this._eraseIconBGColor(t),this._updateCount(t,e.result.contents.likeItCount)},this),this.fireEvent("successCancelLikeIt",r)):this.fireEvent("errorCancelLikeIt",r)},this).bind()}).request({serviceId:n,contentsId:o,displayId:s,categoryId:a,timestamp:this._sTimestamp,likeItToken:this._sLikeItToken})},_paintIconBGColor:function(t){var e=this.getLikeButton(t);!!e&&e.addClass("f_heart")},_eraseIconBGColor:function(t){var e=this.getLikeButton(t);!!e&&e.removeClass("f_heart")},_updateCount:function(t,e){var i=t.query("._count"),n=0,o=t.attr("data-maxcount")||this.option("nMaxCount"),s=Math.max(n,Math.min(e,o)).toString(),a=s.replace(/(\d)(?=(\d{3})+$)/gim,"$1,"),r=e>o?"+":"";i&&i.html(a+r)},_getRequestQueue:function(t){for(var e,i,n,o,s=[],a=[],r=[],l=-1,d=-1,h=0,c=t.length;c>h;h++)e=jindo.$Element(t[h]),i=e.attr("data-domain")||this.option("sAPIDomain"),n=e.attr("data-sid"),o=e.attr("data-cid"),l=jindo.$A(a).indexOf(i),0>l&&(a.push(i),l=a.length-1,s[l]={sDomain:i,aServiceQueue:[],aService:[]}),r=s[l].aServiceQueue,d=jindo.$A(r).indexOf(n),0>d&&(r.push(n),d=r.length-1,s[l].aService[d]={sServiceId:n,aContentId:[]}),s[l].aService[d].aContentId.push(o);return s},_convertToParamString:function(t){for(var e=[],i="",n=0,o=t.length;o>n;n++)e.push(t[n].sServiceId+"["+t[n].aContentId.join(",")+"]");return i=e.join("|")},_requestLikeCount:function(t){for(var e=this,i=this._getRequestQueue(t),n=function(){},o=function(i){var n=i.json(),o={};n&&n.success&&n.result&&(e._sTimestamp=n.result.timestamp,e._sLikeItToken=n.result.likeItToken,jindo.$A(n.result.contents).forEach(function(t){o[t.serviceId+"_"+t.contentsId]={nCount:t.likeItCount,bAlreadyLikeIt:"Y"===t.likeItYn}}),jindo.$A(t).forEach(function(t){var i=jindo.$Element(t),n=o[i.attr("data-sid")+"_"+i.attr("data-cid")];n&&(n.bAlreadyLikeIt?e._paintIconBGColor(i):e._eraseIconBGColor(i),e._updateCount(i,n.nCount),i.attr("data-likeit",1))}),o=null,e.fireEvent("completeUpdate",{bLinkedWithLine:n.result.isLinkedWithLine}))},s=0,a=i.length;a>s;s++)jindo.$Ajax(i[s].sDomain+this.option("sAPIGetLikeIt"),{type:"jsonp",timeout:5,ontimeout:n,onerror:n,onload:o}).request({params:this._convertToParamString(i[s].aService)})},getLikeButton:function(t){return t.test("a")?t:t.query("a")},isAlreadyLikeIt:function(t){var e=this.getLikeButton(t);return e.hasClass("f_heart")},update:function(t,e){var i=[];i=jindo.$Jindo.isArray(t)?t:jindo.$Jindo.isElement(t)?jindo.$Element(t).hasClass(this._UIO_CLASSNAME)?[t]:jindo.$$("."+this._UIO_CLASSNAME,t):jindo.$Jindo.isString(t)?jindo.$$("."+this._UIO_CLASSNAME,jindo.$$.getSingle(t)):jindo.$$("."+this._UIO_CLASSNAME),e||(i=jindo.$A(i).filter(function(t){var e=jindo.$Element(t);return 1!==e.attr("data-likeit")}).$value()),i&&i.length&&i.length>0&&this._requestLikeCount(i)},increase:function(t){this._likeIt(t)},decrease:function(t){this._cancelLikeIt(t)}}).extend(jindo.m.Component),nhn.mobile.common.likeIt.LineFriendListLayer=jindo.$Class({_COMMAND_RUN:"run/",_COMMAND_PROFILE:"nv/profilePopup/mid=",_LINE_NAVER_LOGIN_URL:"https://nid.naver.com/oauth/front.nhn?servicekey=like&type=line_naver_login&viewtype=2&svcurl=",$init:function(t){var e={sAPIDomain:"https://search.like.naver.com",sAPIGetFriendList:"/likeIt/v1/likeItContentFriendList.jsonp",sAPIRedirectProxyOnRegistry:"/likeIt/v1/likeItRedirectService.nhn?type=search&oneTimePassYn=U",sTemplateForLineFriendListLayer:nhn.mobile.common.likeIt.LineFriendListLayer._template};this.option(e),this.option(t||{}),this._initVars()},_initVars:function(){this._htOS=jindo.$Agent().os(),this._htFriendListLayerMap={}},_showLineIdConnection:function(t,e){!!t&&t.addClass("selected noarrow"),e.className("api_time_line").html(this.option("sTemplateForLineFriendListLayer").setting).show()},_showLineFriendList:function(t,e){var i=t.attr("data-domain")||this.option("sAPIDomain"),n=t.attr("data-sid")||"",o=t.attr("data-cid")||"";!!t&&t.addClass("selected").removeClass("noarrow"),e.className("api_like_box").html(this.option("sTemplateForLineFriendListLayer").loading).show(),jindo.$Ajax(i+this.option("sAPIGetFriendList"),{type:"jsonp",timeout:5,ontimeout:jindo.$Fn(function(){this._showErrorMessage(e)},this).bind(),onerror:jindo.$Fn(function(){this._showErrorMessage(e)},this).bind(),onload:jindo.$Fn(function(i){var n=i.json();n&&n.success&&n.result?0===n.result.resultStatusCode?(n.result.myName="LIKEITFRIENDS"!==n.result.likeItUserStatus?n.result.likeItContentFriendList[0].displayName:"",e.html(jindo.$Template(this.option("sTemplateForLineFriendListLayer").list).process(n.result)),this._initScrollComponent(e,"LIKEITWITHFRIENDS"!==n.result.likeItUserStatus?n.result.totalCount:n.result.totalCount+1)):1003===n.result.resultStatusCode?e.html(this.option("sTemplateForLineFriendListLayer").none):1002===n.result.resultStatusCode?this._showLineIdConnection(t,e):this._showErrorMessage(e):this._showErrorMessage(e)},this).bind()}).request({serviceId:n,contentsId:o})},_showErrorMessage:function(t){t.html(this.option("sTemplateForLineFriendListLayer").error).show()},_initScrollComponent:function(t,e){var i,n,o,s,a,r;t&&(i=t.attr("id"),n=jindo.$Element(jindo.$$.getSingle("._scrollView",t)),n&&(o=jindo.$Element(jindo.$$.getSingle("._scrollItem",n.$value())),s=o.width()+parseInt(o.css("margin-left"),10)+parseInt(o.css("margin-right"),10),a=jindo.$Fn(function(){jindo.$Element(jindo.$$.getSingle("._scroller",n.$value())).css("width",Math.max(n.width(),e*s)+"px")},this).bind(),jindo.m.bindRotate(a),a(),r=new jindo.m.Scroll(n,{bUseHScroll:!0,bUseVScroll:!1,bAutoResize:!0,bUseScrollbar:!1}),this._htFriendListLayerMap[i]||(this._htFriendListLayerMap[i]={}),this._htFriendListLayerMap[i].fRotate=a,this._htFriendListLayerMap[i].oScroll=r))},_attachEvent:function(t,e){var i,n,o,s={welBase:t,welLineFriendListLayer:e},a=t.attr("data-line")||"";i=jindo.$Fn(function(e){var i,n,o,a;e.stopDefault(),this.fireEvent("openRegistry",s),i=t.attr("data-domain")||this.option("sAPIDomain"),n=t.attr("data-sid")||"",o=t.attr("data-cid")||"",a=i+this.option("sAPIRedirectProxyOnRegistry")+"&serviceId="+n+"&contentsId="+o+"&loc=",this._openRegistry(a)},this).bind(),n=jindo.$Fn(function(t){t.stopDefault(),this.fireEvent("openProfile",s),this._openLine()},this).bind(),o=jindo.$Fn(function(t){t.stopDefault(),this.fireEvent("openProfile",s),this._openProfile(jindo.$Element(t.element).attr("data-mid"))},this).bind(),e.preventTapHighlight(!0).delegate("click","._openRegistry",i).delegate("click","._openLine",n).delegate("click","._openProfile",o),this._htFriendListLayerMap[a]||(this._htFriendListLayerMap[a]={}),this._htFriendListLayerMap[a].fClickByOpenRegistry=i,this._htFriendListLayerMap[a].fClickByOpenLine=n,this._htFriendListLayerMap[a].fClickByOpenProfile=o},_destroy:function(t,e){var i=t.attr("data-line")||"",n=this._htFriendListLayerMap[i];n&&(!!n.oScroll&&n.oScroll.destroy(),!!n.fRotate&&jindo.m.unbindRotate(n.fRotate),!!n.fClickByOpenRegistry&&e.undelegate("click","._openRegistry",n.fClickByOpenRegistry),!!n.fClickByOpenLine&&e.undelegate("click","._openLine",n.fClickByOpenLine),!!n.fClickByOpenProfile&&e.undelegate("click","._openProfile",n.fClickByOpenProfile),delete n.oScroll,delete n.fRotate,delete n.fClickByOpenRegistry,delete n.fClickByOpenLine,delete n.fClickByOpenProfile,delete this._htFriendListLayerMap[i])},_openRegistry:function(t){location.href=this._LINE_NAVER_LOGIN_URL+encodeURIComponent(t+encodeURIComponent(location.href))},_openLine:function(){this._runLineApp(this._COMMAND_RUN)},_openProfile:function(t){this._runLineApp(this._COMMAND_PROFILE+t)},_runLineApp:function(t){nhn.mobile.oAppLauncher&&nhn.mobile.oAppLauncher.launch({ios:{scheme:"line",query:t,installId:"443904275"},android:{scheme:"line",query:t,action:"android.intent.action.VIEW",category:"android.intent.category.BROWSABLE","package":"jp.naver.line.android"}})},visible:function(t){return t.hasClass("selected")},show:function(t,e){var i=jindo.$Element(t.attr("data-line"));i&&(e?this._showLineFriendList(t,i):this._showLineIdConnection(t,i),this._attachEvent(t,i))},hide:function(t){var e=jindo.$Element(t.attr("data-line"));e&&(!!t&&t.removeClass("selected noarrow"),!!e&&e.hide(),this._destroy(t,e))}}).extend(jindo.m.Component),nhn.mobile.common.likeIt.LineFriendListLayer._template={error:'<p class="api_err">잠시 후에 다시 시도해주세요.</p>',loading:'<p class="api_rd_txt"><span class="api_ico_rd">로딩중</span> 좋아요한 친구 정보를 불러오는 중입니다.</p>',none:'<p class="api_err">좋아요한 친구가 없습니다.</p>',list:["<div>",'<div class="api_like_bg _scrollView">','<ul class="_scroller">',"{for i:htFriend in likeItContentFriendList}",'<li class="_scrollItem"><a href="#" data-mid="{=htFriend.mid}" class="{if i===0 && myName}_openLine{else}_openProfile{/if}"><img src="{=htFriend.smallPictureUrl}" width="35" height="35" alt="{=htFriend.displayName}"></a></li>',"{/for}","</ul>","</div>","</div>",'<p class="api_like_txt">','{if likeItUserStatus=="LIKEITALONE"}',"{=myName}님이 좋아합니다.",'{elseif likeItUserStatus=="LIKEITWITHFRIENDS"}',"{=myName}님외 라인친구 {=totalCount}명이 좋아합니다.","{else}","라인친구 {=totalCount}명이 좋아합니다.","{/if}","</p>"].join(""),setting:['<p class="api_line_txt v2">네이버와 라인을 연결하면,<br><span class="api_spim_bf">좋아요</span>한 친구를 확인할 수 있어요.</p>','<a href="#" class="api_spim_bf api_btn_share _openRegistry">친구확인</a>'].join("")},nhn.mobile.common.likeIt.ToastLayer=jindo.$Class({_DISPLAY_DURATION:2e3,$init:function(){this._nTimer=-1,this._oToastLayer=null},_createToastLayer:function(){var t=jindo.$Element(nhn.mobile.common.likeIt.ToastLayer._template).prependTo(document.body).$value();return new jindo.m.LayerPosition(t,{sPosition:"bottom",bUseFixed:!0}),new jindo.m.LayerEffect(t)},_setMessage:function(t){jindo.$Element(jindo.$$.getSingle("p",this._oToastLayer.getLayer())).html(t)},_hide:function(){this._oToastLayer.fade({sDirection:"out",nDuration:1e3})},_show:function(){this._nTimer=window.clearTimeout(this._nTimer),this._oToastLayer.clearEffect(),this._oToastLayer.fade({sDirection:"in",nDuration:100}),this._nTimer=window.setTimeout(jindo.$Fn(this._hide,this).bind(),this._DISPLAY_DURATION)},show:function(t){t&&(this._oToastLayer||(this._oToastLayer=this._createToastLayer()),this._setMessage(t),this._show())}}),nhn.mobile.common.likeIt.ToastLayer._template='<div style="left:0; bottom:0; z-index:2005; display:none;" class="api_like_ly"><p></p></div>';