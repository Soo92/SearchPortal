var KinAutoComplete=$Class({_wEvent:null,_oInputElement:null,_sAutoCompleteUrl:null,_oAutoCompleteParam:null,
_sQueryParamName:null,_fnAutoCompleteCallback:null,_sLastInputValue:null,_oInputCheckTimer:null,INPUT_WATCH_PERIOD:200,
$init:function(htOption){if(!htOption)return;this._oInputElement=htOption.inputElement;this._sAutoCompleteUrl=
htOption.autoCompleteUrl;this._oAutoCompleteParam=htOption.autoCompleteParam;this._sQueryParamName=htOption.queryParamName||
"q";this._fnAutoCompleteCallback=htOption.fnAutoCompleteCallback;if(!this._oInputElement||!this._sAutoCompleteUrl||
!this._oAutoCompleteParam||typeof this._fnAutoCompleteCallback!=="function")return;this._setEvent()},
_setEvent:function(){this._wEvent={};this._wEvent["focusInputElment"]=$Fn(this._onFocusInputElement,this).attach(this._oInputElement,
"focus");this._wEvent["blurInputElment"]=$Fn(this._onBlurInputElement,this).attach(this._oInputElement,
"blur")},
_onFocusInputElement:function(oEvent){if(this._oInputCheckTimer)clearInterval(this._oInputCheckTimer);
this._oInputCheckTimer=setInterval($Fn(this._watchInputChange,this).bind(),this.INPUT_WATCH_PERIOD)},
_watchInputChange:function(){var sCurrentInputValue=this._oInputElement.value||null;if(sCurrentInputValue===
this._sLastInputValue)return;this._sLastInputValue=sCurrentInputValue;if(sCurrentInputValue)this._requestAutoComplete(sCurrentInputValue);
else this._fnAutoCompleteCallback(null)},
_onBlurInputElement:function(oEvent){if(!this._oInputCheckTimer)return null;clearInterval(this._oInputCheckTimer);
this._oInputCheckTimer=null},
_requestAutoComplete:function(sInputValue){this._oAutoCompleteParam[this._sQueryParamName]=sInputValue;
var oOption={type:"jsonp",jsonp_charset:"UTF-8",method:"get",timeout:3,onload:$Fn(this._onAutoCompleteResponse,
this).bind(),ontimeout:$Fn(function(){},this).bind(),
onerror:$Fn(function(){},this).bind()};
var oAjax=new $Ajax(this._sAutoCompleteUrl,oOption);oAjax.request(this._oAutoCompleteParam)},
_onAutoCompleteResponse:function(oResponse){var oResponseJson=oResponse.json();if(!oResponseJson)return;
this._fnAutoCompleteCallback(oResponseJson)},
destroy:function(){if(this._wEvent){if(this._wEvent["focusInputElment"])this._wEvent["focusInputElment"].detach(this._oInputElement,
"focus");if(this._wEvent["blurInputElment"])this._wEvent["blurInputElment"].detach(this._oInputElement,
"blur")}this._wEvent=this._oInputElement=this._sAutoCompleteUrl=this._oAutoCompleteParam=this._sQueryParamName=
null;this._sLastInputValue=this._oInputCheckTimer=this.INPUT_WATCH_PERIOD=null}});